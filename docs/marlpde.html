<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="generator" content="pdoc 14.7.0"/>
    <title>marlpde API documentation</title>

    <style>/*! * Bootstrap Reboot v5.0.0 (https://getbootstrap.com/) * Copyright 2011-2021 The Bootstrap Authors * Copyright 2011-2021 Twitter, Inc. * Licensed under MIT (https://github.com/twbs/bootstrap/blob/main/LICENSE) * Forked from Normalize.css, licensed MIT (https://github.com/necolas/normalize.css/blob/master/LICENSE.md) */*,::after,::before{box-sizing:border-box}@media (prefers-reduced-motion:no-preference){:root{scroll-behavior:smooth}}body{margin:0;font-family:system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans","Liberation Sans",sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji";font-size:1rem;font-weight:400;line-height:1.5;color:#212529;background-color:#fff;-webkit-text-size-adjust:100%;-webkit-tap-highlight-color:transparent}hr{margin:1rem 0;color:inherit;background-color:currentColor;border:0;opacity:.25}hr:not([size]){height:1px}h1,h2,h3,h4,h5,h6{margin-top:0;margin-bottom:.5rem;font-weight:500;line-height:1.2}h1{font-size:calc(1.375rem + 1.5vw)}@media (min-width:1200px){h1{font-size:2.5rem}}h2{font-size:calc(1.325rem + .9vw)}@media (min-width:1200px){h2{font-size:2rem}}h3{font-size:calc(1.3rem + .6vw)}@media (min-width:1200px){h3{font-size:1.75rem}}h4{font-size:calc(1.275rem + .3vw)}@media (min-width:1200px){h4{font-size:1.5rem}}h5{font-size:1.25rem}h6{font-size:1rem}p{margin-top:0;margin-bottom:1rem}abbr[data-bs-original-title],abbr[title]{-webkit-text-decoration:underline dotted;text-decoration:underline dotted;cursor:help;-webkit-text-decoration-skip-ink:none;text-decoration-skip-ink:none}address{margin-bottom:1rem;font-style:normal;line-height:inherit}ol,ul{padding-left:2rem}dl,ol,ul{margin-top:0;margin-bottom:1rem}ol ol,ol ul,ul ol,ul ul{margin-bottom:0}dt{font-weight:700}dd{margin-bottom:.5rem;margin-left:0}blockquote{margin:0 0 1rem}b,strong{font-weight:bolder}small{font-size:.875em}mark{padding:.2em;background-color:#fcf8e3}sub,sup{position:relative;font-size:.75em;line-height:0;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}a{color:#0d6efd;text-decoration:underline}a:hover{color:#0a58ca}a:not([href]):not([class]),a:not([href]):not([class]):hover{color:inherit;text-decoration:none}code,kbd,pre,samp{font-family:SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace;font-size:1em;direction:ltr;unicode-bidi:bidi-override}pre{display:block;margin-top:0;margin-bottom:1rem;overflow:auto;font-size:.875em}pre code{font-size:inherit;color:inherit;word-break:normal}code{font-size:.875em;color:#d63384;word-wrap:break-word}a>code{color:inherit}kbd{padding:.2rem .4rem;font-size:.875em;color:#fff;background-color:#212529;border-radius:.2rem}kbd kbd{padding:0;font-size:1em;font-weight:700}figure{margin:0 0 1rem}img,svg{vertical-align:middle}table{caption-side:bottom;border-collapse:collapse}caption{padding-top:.5rem;padding-bottom:.5rem;color:#6c757d;text-align:left}th{text-align:inherit;text-align:-webkit-match-parent}tbody,td,tfoot,th,thead,tr{border-color:inherit;border-style:solid;border-width:0}label{display:inline-block}button{border-radius:0}button:focus:not(:focus-visible){outline:0}button,input,optgroup,select,textarea{margin:0;font-family:inherit;font-size:inherit;line-height:inherit}button,select{text-transform:none}[role=button]{cursor:pointer}select{word-wrap:normal}select:disabled{opacity:1}[list]::-webkit-calendar-picker-indicator{display:none}[type=button],[type=reset],[type=submit],button{-webkit-appearance:button}[type=button]:not(:disabled),[type=reset]:not(:disabled),[type=submit]:not(:disabled),button:not(:disabled){cursor:pointer}::-moz-focus-inner{padding:0;border-style:none}textarea{resize:vertical}fieldset{min-width:0;padding:0;margin:0;border:0}legend{float:left;width:100%;padding:0;margin-bottom:.5rem;font-size:calc(1.275rem + .3vw);line-height:inherit}@media (min-width:1200px){legend{font-size:1.5rem}}legend+*{clear:left}::-webkit-datetime-edit-day-field,::-webkit-datetime-edit-fields-wrapper,::-webkit-datetime-edit-hour-field,::-webkit-datetime-edit-minute,::-webkit-datetime-edit-month-field,::-webkit-datetime-edit-text,::-webkit-datetime-edit-year-field{padding:0}::-webkit-inner-spin-button{height:auto}[type=search]{outline-offset:-2px;-webkit-appearance:textfield}::-webkit-search-decoration{-webkit-appearance:none}::-webkit-color-swatch-wrapper{padding:0}::file-selector-button{font:inherit}::-webkit-file-upload-button{font:inherit;-webkit-appearance:button}output{display:inline-block}iframe{border:0}summary{display:list-item;cursor:pointer}progress{vertical-align:baseline}[hidden]{display:none!important}</style>
    <style>/*! syntax-highlighting.css */pre{line-height:125%;}span.linenos{color:inherit; background-color:transparent; padding-left:5px; padding-right:20px;}.pdoc-code .hll{background-color:#ffffcc}.pdoc-code{background:#f8f8f8;}.pdoc-code .c{color:#3D7B7B; font-style:italic}.pdoc-code .err{border:1px solid #FF0000}.pdoc-code .k{color:#008000; font-weight:bold}.pdoc-code .o{color:#666666}.pdoc-code .ch{color:#3D7B7B; font-style:italic}.pdoc-code .cm{color:#3D7B7B; font-style:italic}.pdoc-code .cp{color:#9C6500}.pdoc-code .cpf{color:#3D7B7B; font-style:italic}.pdoc-code .c1{color:#3D7B7B; font-style:italic}.pdoc-code .cs{color:#3D7B7B; font-style:italic}.pdoc-code .gd{color:#A00000}.pdoc-code .ge{font-style:italic}.pdoc-code .gr{color:#E40000}.pdoc-code .gh{color:#000080; font-weight:bold}.pdoc-code .gi{color:#008400}.pdoc-code .go{color:#717171}.pdoc-code .gp{color:#000080; font-weight:bold}.pdoc-code .gs{font-weight:bold}.pdoc-code .gu{color:#800080; font-weight:bold}.pdoc-code .gt{color:#0044DD}.pdoc-code .kc{color:#008000; font-weight:bold}.pdoc-code .kd{color:#008000; font-weight:bold}.pdoc-code .kn{color:#008000; font-weight:bold}.pdoc-code .kp{color:#008000}.pdoc-code .kr{color:#008000; font-weight:bold}.pdoc-code .kt{color:#B00040}.pdoc-code .m{color:#666666}.pdoc-code .s{color:#BA2121}.pdoc-code .na{color:#687822}.pdoc-code .nb{color:#008000}.pdoc-code .nc{color:#0000FF; font-weight:bold}.pdoc-code .no{color:#880000}.pdoc-code .nd{color:#AA22FF}.pdoc-code .ni{color:#717171; font-weight:bold}.pdoc-code .ne{color:#CB3F38; font-weight:bold}.pdoc-code .nf{color:#0000FF}.pdoc-code .nl{color:#767600}.pdoc-code .nn{color:#0000FF; font-weight:bold}.pdoc-code .nt{color:#008000; font-weight:bold}.pdoc-code .nv{color:#19177C}.pdoc-code .ow{color:#AA22FF; font-weight:bold}.pdoc-code .w{color:#bbbbbb}.pdoc-code .mb{color:#666666}.pdoc-code .mf{color:#666666}.pdoc-code .mh{color:#666666}.pdoc-code .mi{color:#666666}.pdoc-code .mo{color:#666666}.pdoc-code .sa{color:#BA2121}.pdoc-code .sb{color:#BA2121}.pdoc-code .sc{color:#BA2121}.pdoc-code .dl{color:#BA2121}.pdoc-code .sd{color:#BA2121; font-style:italic}.pdoc-code .s2{color:#BA2121}.pdoc-code .se{color:#AA5D1F; font-weight:bold}.pdoc-code .sh{color:#BA2121}.pdoc-code .si{color:#A45A77; font-weight:bold}.pdoc-code .sx{color:#008000}.pdoc-code .sr{color:#A45A77}.pdoc-code .s1{color:#BA2121}.pdoc-code .ss{color:#19177C}.pdoc-code .bp{color:#008000}.pdoc-code .fm{color:#0000FF}.pdoc-code .vc{color:#19177C}.pdoc-code .vg{color:#19177C}.pdoc-code .vi{color:#19177C}.pdoc-code .vm{color:#19177C}.pdoc-code .il{color:#666666}</style>
    <style>/*! theme.css */:root{--pdoc-background:#fff;}.pdoc{--text:#212529;--muted:#6c757d;--link:#3660a5;--link-hover:#1659c5;--code:#f8f8f8;--active:#fff598;--accent:#eee;--accent2:#c1c1c1;--nav-hover:rgba(255, 255, 255, 0.5);--name:#0066BB;--def:#008800;--annotation:#007020;}</style>
    <style>/*! layout.css */html, body{width:100%;height:100%;}html, main{scroll-behavior:smooth;}body{background-color:var(--pdoc-background);}@media (max-width:769px){#navtoggle{cursor:pointer;position:absolute;width:50px;height:40px;top:1rem;right:1rem;border-color:var(--text);color:var(--text);display:flex;opacity:0.8;z-index:999;}#navtoggle:hover{opacity:1;}#togglestate + div{display:none;}#togglestate:checked + div{display:inherit;}main, header{padding:2rem 3vw;}header + main{margin-top:-3rem;}.git-button{display:none !important;}nav input[type="search"]{max-width:77%;}nav input[type="search"]:first-child{margin-top:-6px;}nav input[type="search"]:valid ~ *{display:none !important;}}@media (min-width:770px){:root{--sidebar-width:clamp(12.5rem, 28vw, 22rem);}nav{position:fixed;overflow:auto;height:100vh;width:var(--sidebar-width);}main, header{padding:3rem 2rem 3rem calc(var(--sidebar-width) + 3rem);width:calc(54rem + var(--sidebar-width));max-width:100%;}header + main{margin-top:-4rem;}#navtoggle{display:none;}}#togglestate{position:absolute;height:0;opacity:0;}nav.pdoc{--pad:clamp(0.5rem, 2vw, 1.75rem);--indent:1.5rem;background-color:var(--accent);border-right:1px solid var(--accent2);box-shadow:0 0 20px rgba(50, 50, 50, .2) inset;padding:0 0 0 var(--pad);overflow-wrap:anywhere;scrollbar-width:thin; scrollbar-color:var(--accent2) transparent; z-index:1}nav.pdoc::-webkit-scrollbar{width:.4rem; }nav.pdoc::-webkit-scrollbar-thumb{background-color:var(--accent2); }nav.pdoc > div{padding:var(--pad) 0;}nav.pdoc .module-list-button{display:inline-flex;align-items:center;color:var(--text);border-color:var(--muted);margin-bottom:1rem;}nav.pdoc .module-list-button:hover{border-color:var(--text);}nav.pdoc input[type=search]{display:block;outline-offset:0;width:calc(100% - var(--pad));}nav.pdoc .logo{max-width:calc(100% - var(--pad));max-height:35vh;display:block;margin:0 auto 1rem;transform:translate(calc(-.5 * var(--pad)), 0);}nav.pdoc ul{list-style:none;padding-left:0;}nav.pdoc > div > ul{margin-left:calc(0px - var(--pad));}nav.pdoc li a{padding:.2rem 0 .2rem calc(var(--pad) + var(--indent));}nav.pdoc > div > ul > li > a{padding-left:var(--pad);}nav.pdoc li{transition:all 100ms;}nav.pdoc li:hover{background-color:var(--nav-hover);}nav.pdoc a, nav.pdoc a:hover{color:var(--text);}nav.pdoc a{display:block;}nav.pdoc > h2:first-of-type{margin-top:1.5rem;}nav.pdoc .class:before{content:"class ";color:var(--muted);}nav.pdoc .function:after{content:"()";color:var(--muted);}nav.pdoc footer:before{content:"";display:block;width:calc(100% - var(--pad));border-top:solid var(--accent2) 1px;margin-top:1.5rem;padding-top:.5rem;}nav.pdoc footer{font-size:small;}</style>
    <style>/*! content.css */.pdoc{color:var(--text);box-sizing:border-box;line-height:1.5;background:none;}.pdoc .pdoc-button{cursor:pointer;display:inline-block;border:solid black 1px;border-radius:2px;font-size:.75rem;padding:calc(0.5em - 1px) 1em;transition:100ms all;}.pdoc .alert{padding:1rem 1rem 1rem calc(1.5rem + 24px);border:1px solid transparent;border-radius:.25rem;background-repeat:no-repeat;background-position:.75rem center;margin-bottom:1rem;}.pdoc .alert > em{display:none;}.pdoc .alert > *:last-child{margin-bottom:0;}.pdoc .alert.note {color:#084298;background-color:#cfe2ff;border-color:#b6d4fe;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23084298%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M8%2016A8%208%200%201%200%208%200a8%208%200%200%200%200%2016zm.93-9.412-1%204.705c-.07.34.029.533.304.533.194%200%20.487-.07.686-.246l-.088.416c-.287.346-.92.598-1.465.598-.703%200-1.002-.422-.808-1.319l.738-3.468c.064-.293.006-.399-.287-.47l-.451-.081.082-.381%202.29-.287zM8%205.5a1%201%200%201%201%200-2%201%201%200%200%201%200%202z%22/%3E%3C/svg%3E");}.pdoc .alert.warning{color:#664d03;background-color:#fff3cd;border-color:#ffecb5;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23664d03%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M8.982%201.566a1.13%201.13%200%200%200-1.96%200L.165%2013.233c-.457.778.091%201.767.98%201.767h13.713c.889%200%201.438-.99.98-1.767L8.982%201.566zM8%205c.535%200%20.954.462.9.995l-.35%203.507a.552.552%200%200%201-1.1%200L7.1%205.995A.905.905%200%200%201%208%205zm.002%206a1%201%200%201%201%200%202%201%201%200%200%201%200-2z%22/%3E%3C/svg%3E");}.pdoc .alert.danger{color:#842029;background-color:#f8d7da;border-color:#f5c2c7;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23842029%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M5.52.359A.5.5%200%200%201%206%200h4a.5.5%200%200%201%20.474.658L8.694%206H12.5a.5.5%200%200%201%20.395.807l-7%209a.5.5%200%200%201-.873-.454L6.823%209.5H3.5a.5.5%200%200%201-.48-.641l2.5-8.5z%22/%3E%3C/svg%3E");}.pdoc .visually-hidden{position:absolute !important;width:1px !important;height:1px !important;padding:0 !important;margin:-1px !important;overflow:hidden !important;clip:rect(0, 0, 0, 0) !important;white-space:nowrap !important;border:0 !important;}.pdoc h1, .pdoc h2, .pdoc h3{font-weight:300;margin:.3em 0;padding:.2em 0;}.pdoc > section:not(.module-info) h1{font-size:1.5rem;font-weight:500;}.pdoc > section:not(.module-info) h2{font-size:1.4rem;font-weight:500;}.pdoc > section:not(.module-info) h3{font-size:1.3rem;font-weight:500;}.pdoc > section:not(.module-info) h4{font-size:1.2rem;}.pdoc > section:not(.module-info) h5{font-size:1.1rem;}.pdoc a{text-decoration:none;color:var(--link);}.pdoc a:hover{color:var(--link-hover);}.pdoc blockquote{margin-left:2rem;}.pdoc pre{border-top:1px solid var(--accent2);border-bottom:1px solid var(--accent2);margin-top:0;margin-bottom:1em;padding:.5rem 0 .5rem .5rem;overflow-x:auto;background-color:var(--code);}.pdoc code{color:var(--text);padding:.2em .4em;margin:0;font-size:85%;background-color:var(--accent);border-radius:6px;}.pdoc a > code{color:inherit;}.pdoc pre > code{display:inline-block;font-size:inherit;background:none;border:none;padding:0;}.pdoc > section:not(.module-info){margin-bottom:1.5rem;}.pdoc .modulename{margin-top:0;font-weight:bold;}.pdoc .modulename a{color:var(--link);transition:100ms all;}.pdoc .git-button{float:right;border:solid var(--link) 1px;}.pdoc .git-button:hover{background-color:var(--link);color:var(--pdoc-background);}.view-source-toggle-state,.view-source-toggle-state ~ .pdoc-code{display:none;}.view-source-toggle-state:checked ~ .pdoc-code{display:block;}.view-source-button{display:inline-block;float:right;font-size:.75rem;line-height:1.5rem;color:var(--muted);padding:0 .4rem 0 1.3rem;cursor:pointer;text-indent:-2px;}.view-source-button > span{visibility:hidden;}.module-info .view-source-button{float:none;display:flex;justify-content:flex-end;margin:-1.2rem .4rem -.2rem 0;}.view-source-button::before{position:absolute;content:"View Source";display:list-item;list-style-type:disclosure-closed;}.view-source-toggle-state:checked ~ .attr .view-source-button::before,.view-source-toggle-state:checked ~ .view-source-button::before{list-style-type:disclosure-open;}.pdoc .docstring{margin-bottom:1.5rem;}.pdoc section:not(.module-info) .docstring{margin-left:clamp(0rem, 5vw - 2rem, 1rem);}.pdoc .docstring .pdoc-code{margin-left:1em;margin-right:1em;}.pdoc h1:target,.pdoc h2:target,.pdoc h3:target,.pdoc h4:target,.pdoc h5:target,.pdoc h6:target,.pdoc .pdoc-code > pre > span:target{background-color:var(--active);box-shadow:-1rem 0 0 0 var(--active);}.pdoc .pdoc-code > pre > span:target{display:block;}.pdoc div:target > .attr,.pdoc section:target > .attr,.pdoc dd:target > a{background-color:var(--active);}.pdoc *{scroll-margin:2rem;}.pdoc .pdoc-code .linenos{user-select:none;}.pdoc .attr:hover{filter:contrast(0.95);}.pdoc section, .pdoc .classattr{position:relative;}.pdoc .headerlink{--width:clamp(1rem, 3vw, 2rem);position:absolute;top:0;left:calc(0rem - var(--width));transition:all 100ms ease-in-out;opacity:0;}.pdoc .headerlink::before{content:"#";display:block;text-align:center;width:var(--width);height:2.3rem;line-height:2.3rem;font-size:1.5rem;}.pdoc .attr:hover ~ .headerlink,.pdoc *:target > .headerlink,.pdoc .headerlink:hover{opacity:1;}.pdoc .attr{display:block;margin:.5rem 0 .5rem;padding:.4rem .4rem .4rem 1rem;background-color:var(--accent);overflow-x:auto;}.pdoc .classattr{margin-left:2rem;}.pdoc .name{color:var(--name);font-weight:bold;}.pdoc .def{color:var(--def);font-weight:bold;}.pdoc .signature{background-color:transparent;}.pdoc .param, .pdoc .return-annotation{white-space:pre;}.pdoc .signature.multiline .param{display:block;}.pdoc .signature.condensed .param{display:inline-block;}.pdoc .annotation{color:var(--annotation);}.pdoc .view-value-toggle-state,.pdoc .view-value-toggle-state ~ .default_value{display:none;}.pdoc .view-value-toggle-state:checked ~ .default_value{display:inherit;}.pdoc .view-value-button{font-size:.5rem;vertical-align:middle;border-style:dashed;margin-top:-0.1rem;}.pdoc .view-value-button:hover{background:white;}.pdoc .view-value-button::before{content:"show";text-align:center;width:2.2em;display:inline-block;}.pdoc .view-value-toggle-state:checked ~ .view-value-button::before{content:"hide";}.pdoc .inherited{margin-left:2rem;}.pdoc .inherited dt{font-weight:700;}.pdoc .inherited dt, .pdoc .inherited dd{display:inline;margin-left:0;margin-bottom:.5rem;}.pdoc .inherited dd:not(:last-child):after{content:", ";}.pdoc .inherited .class:before{content:"class ";}.pdoc .inherited .function a:after{content:"()";}.pdoc .search-result .docstring{overflow:auto;max-height:25vh;}.pdoc .search-result.focused > .attr{background-color:var(--active);}.pdoc .attribution{margin-top:2rem;display:block;opacity:0.5;transition:all 200ms;filter:grayscale(100%);}.pdoc .attribution:hover{opacity:1;filter:grayscale(0%);}.pdoc .attribution img{margin-left:5px;height:35px;vertical-align:middle;width:70px;transition:all 200ms;}.pdoc table{display:block;width:max-content;max-width:100%;overflow:auto;margin-bottom:1rem;}.pdoc table th{font-weight:600;}.pdoc table th, .pdoc table td{padding:6px 13px;border:1px solid var(--accent2);}</style>
    <style>/*! custom.css */</style></head>
<body>
    <nav class="pdoc">
        <label id="navtoggle" for="togglestate" class="pdoc-button"><svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 30 30'><path stroke-linecap='round' stroke="currentColor" stroke-miterlimit='10' stroke-width='2' d='M4 7h22M4 15h22M4 23h22'/></svg></label>
        <input id="togglestate" type="checkbox" aria-hidden="true" tabindex="-1">
        <div>


            <h2>Contents</h2>
            <ul>
  <li><a href="#integrating-diagenetic-equations-using-python">Integrating diagenetic equations using Python</a>
  <ul>
    <li><a href="#installing-and-using">Installing and using</a></li>
    <li><a href="#running-tests">Running tests</a></li>
    <li><a href="#copyright">Copyright</a></li>
    <li><a href="#funding-information">Funding information</a></li>
  </ul></li>
</ul>



            <h2>API Documentation</h2>
                <ul class="memberlist">
            <li>
                    <a class="class" href="#LMAHeureuxPorosityDiff">LMAHeureuxPorosityDiff</a>
                            <ul class="memberlist">
                        <li>
                                <a class="variable" href="#LMAHeureuxPorosityDiff.AragoniteSurface">AragoniteSurface</a>
                        </li>
                        <li>
                                <a class="variable" href="#LMAHeureuxPorosityDiff.CalciteSurface">CalciteSurface</a>
                        </li>
                        <li>
                                <a class="variable" href="#LMAHeureuxPorosityDiff.CaSurface">CaSurface</a>
                        </li>
                        <li>
                                <a class="variable" href="#LMAHeureuxPorosityDiff.CO3Surface">CO3Surface</a>
                        </li>
                        <li>
                                <a class="variable" href="#LMAHeureuxPorosityDiff.PorSurface">PorSurface</a>
                        </li>
                        <li>
                                <a class="variable" href="#LMAHeureuxPorosityDiff.bc_CA">bc_CA</a>
                        </li>
                        <li>
                                <a class="variable" href="#LMAHeureuxPorosityDiff.bc_CC">bc_CC</a>
                        </li>
                        <li>
                                <a class="variable" href="#LMAHeureuxPorosityDiff.bc_cCa">bc_cCa</a>
                        </li>
                        <li>
                                <a class="variable" href="#LMAHeureuxPorosityDiff.bc_cCO3">bc_cCO3</a>
                        </li>
                        <li>
                                <a class="variable" href="#LMAHeureuxPorosityDiff.bc_Phi">bc_Phi</a>
                        </li>
                        <li>
                                <a class="variable" href="#LMAHeureuxPorosityDiff.sedimentationrate">sedimentationrate</a>
                        </li>
                        <li>
                                <a class="variable" href="#LMAHeureuxPorosityDiff.Xstar">Xstar</a>
                        </li>
                        <li>
                                <a class="variable" href="#LMAHeureuxPorosityDiff.Tstar">Tstar</a>
                        </li>
                        <li>
                                <a class="variable" href="#LMAHeureuxPorosityDiff.k1">k1</a>
                        </li>
                        <li>
                                <a class="variable" href="#LMAHeureuxPorosityDiff.k2">k2</a>
                        </li>
                        <li>
                                <a class="variable" href="#LMAHeureuxPorosityDiff.k3">k3</a>
                        </li>
                        <li>
                                <a class="variable" href="#LMAHeureuxPorosityDiff.k4">k4</a>
                        </li>
                        <li>
                                <a class="variable" href="#LMAHeureuxPorosityDiff.m1">m1</a>
                        </li>
                        <li>
                                <a class="variable" href="#LMAHeureuxPorosityDiff.m2">m2</a>
                        </li>
                        <li>
                                <a class="variable" href="#LMAHeureuxPorosityDiff.n1">n1</a>
                        </li>
                        <li>
                                <a class="variable" href="#LMAHeureuxPorosityDiff.n2">n2</a>
                        </li>
                        <li>
                                <a class="variable" href="#LMAHeureuxPorosityDiff.b">b</a>
                        </li>
                        <li>
                                <a class="variable" href="#LMAHeureuxPorosityDiff.beta">beta</a>
                        </li>
                        <li>
                                <a class="variable" href="#LMAHeureuxPorosityDiff.rhos">rhos</a>
                        </li>
                        <li>
                                <a class="variable" href="#LMAHeureuxPorosityDiff.rhow">rhow</a>
                        </li>
                        <li>
                                <a class="variable" href="#LMAHeureuxPorosityDiff.rhos0">rhos0</a>
                        </li>
                        <li>
                                <a class="variable" href="#LMAHeureuxPorosityDiff.KA">KA</a>
                        </li>
                        <li>
                                <a class="variable" href="#LMAHeureuxPorosityDiff.KC">KC</a>
                        </li>
                        <li>
                                <a class="variable" href="#LMAHeureuxPorosityDiff.muA">muA</a>
                        </li>
                        <li>
                                <a class="variable" href="#LMAHeureuxPorosityDiff.D0Ca">D0Ca</a>
                        </li>
                        <li>
                                <a class="variable" href="#LMAHeureuxPorosityDiff.PhiNR">PhiNR</a>
                        </li>
                        <li>
                                <a class="variable" href="#LMAHeureuxPorosityDiff.PhiInfty">PhiInfty</a>
                        </li>
                        <li>
                                <a class="variable" href="#LMAHeureuxPorosityDiff.DCa">DCa</a>
                        </li>
                        <li>
                                <a class="variable" href="#LMAHeureuxPorosityDiff.DCO3">DCO3</a>
                        </li>
                        <li>
                                <a class="variable" href="#LMAHeureuxPorosityDiff.not_too_shallow">not_too_shallow</a>
                        </li>
                        <li>
                                <a class="variable" href="#LMAHeureuxPorosityDiff.not_too_deep">not_too_deep</a>
                        </li>
                        <li>
                                <a class="variable" href="#LMAHeureuxPorosityDiff.PhiIni">PhiIni</a>
                        </li>
                        <li>
                                <a class="function" href="#LMAHeureuxPorosityDiff.track_U_at_bottom">track_U_at_bottom</a>
                        </li>
                        <li>
                                <a class="function" href="#LMAHeureuxPorosityDiff.calculate_sigma">calculate_sigma</a>
                        </li>
                        <li>
                                <a class="function" href="#LMAHeureuxPorosityDiff.evolution_rate">evolution_rate</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#Scenario">Scenario</a>
                            <ul class="memberlist">
                        <li>
                                <a class="variable" href="#Scenario.mua">mua</a>
                        </li>
                        <li>
                                <a class="variable" href="#Scenario.rhoa">rhoa</a>
                        </li>
                        <li>
                                <a class="variable" href="#Scenario.rhoc">rhoc</a>
                        </li>
                        <li>
                                <a class="variable" href="#Scenario.rhot">rhot</a>
                        </li>
                        <li>
                                <a class="variable" href="#Scenario.rhow">rhow</a>
                        </li>
                        <li>
                                <a class="variable" href="#Scenario.D0ca">D0ca</a>
                        </li>
                        <li>
                                <a class="variable" href="#Scenario.D0co3">D0co3</a>
                        </li>
                        <li>
                                <a class="variable" href="#Scenario.Ka">Ka</a>
                        </li>
                        <li>
                                <a class="variable" href="#Scenario.Kc">Kc</a>
                        </li>
                        <li>
                                <a class="variable" href="#Scenario.beta">beta</a>
                        </li>
                        <li>
                                <a class="variable" href="#Scenario.b">b</a>
                        </li>
                        <li>
                                <a class="variable" href="#Scenario.k1">k1</a>
                        </li>
                        <li>
                                <a class="variable" href="#Scenario.k2">k2</a>
                        </li>
                        <li>
                                <a class="variable" href="#Scenario.k3">k3</a>
                        </li>
                        <li>
                                <a class="variable" href="#Scenario.k4">k4</a>
                        </li>
                        <li>
                                <a class="variable" href="#Scenario.nn">nn</a>
                        </li>
                        <li>
                                <a class="variable" href="#Scenario.m">m</a>
                        </li>
                        <li>
                                <a class="variable" href="#Scenario.S">S</a>
                        </li>
                        <li>
                                <a class="variable" href="#Scenario.phiinf">phiinf</a>
                        </li>
                        <li>
                                <a class="variable" href="#Scenario.phi0">phi0</a>
                        </li>
                        <li>
                                <a class="variable" href="#Scenario.ca0">ca0</a>
                        </li>
                        <li>
                                <a class="variable" href="#Scenario.co30">co30</a>
                        </li>
                        <li>
                                <a class="variable" href="#Scenario.ccal0">ccal0</a>
                        </li>
                        <li>
                                <a class="variable" href="#Scenario.cara0">cara0</a>
                        </li>
                        <li>
                                <a class="variable" href="#Scenario.xdis">xdis</a>
                        </li>
                        <li>
                                <a class="variable" href="#Scenario.length">length</a>
                        </li>
                        <li>
                                <a class="variable" href="#Scenario.Th">Th</a>
                        </li>
                        <li>
                                <a class="variable" href="#Scenario.phi00">phi00</a>
                        </li>
                        <li>
                                <a class="variable" href="#Scenario.ca00">ca00</a>
                        </li>
                        <li>
                                <a class="variable" href="#Scenario.co300">co300</a>
                        </li>
                        <li>
                                <a class="variable" href="#Scenario.ccal00">ccal00</a>
                        </li>
                        <li>
                                <a class="variable" href="#Scenario.cara00">cara00</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="function" href="#Map_Scenario">Map_Scenario</a>
            </li>
            <li>
                    <a class="function" href="#jacobian_sparsity">jacobian_sparsity</a>
            </li>
            <li>
                    <a class="class" href="#Solver">Solver</a>
                            <ul class="memberlist">
                        <li>
                                <a class="variable" href="#Solver.dt">dt</a>
                        </li>
                        <li>
                                <a class="variable" href="#Solver.t_range">t_range</a>
                        </li>
                        <li>
                                <a class="variable" href="#Solver.solver">solver</a>
                        </li>
                        <li>
                                <a class="variable" href="#Solver.scheme">scheme</a>
                        </li>
                        <li>
                                <a class="variable" href="#Solver.adaptive">adaptive</a>
                        </li>
                        <li>
                                <a class="variable" href="#Solver.method">method</a>
                        </li>
                        <li>
                                <a class="variable" href="#Solver.lband">lband</a>
                        </li>
                        <li>
                                <a class="variable" href="#Solver.uband">uband</a>
                        </li>
                        <li>
                                <a class="variable" href="#Solver.backend">backend</a>
                        </li>
                        <li>
                                <a class="variable" href="#Solver.ret_info">ret_info</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#Tracker">Tracker</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#Tracker.__init__">Tracker</a>
                        </li>
                        <li>
                                <a class="variable" href="#Tracker.progress_tracker_interval">progress_tracker_interval</a>
                        </li>
                        <li>
                                <a class="variable" href="#Tracker.live_plotting">live_plotting</a>
                        </li>
                        <li>
                                <a class="variable" href="#Tracker.plotting_interval">plotting_interval</a>
                        </li>
                        <li>
                                <a class="variable" href="#Tracker.data_tracker_interval">data_tracker_interval</a>
                        </li>
                        <li>
                                <a class="variable" href="#Tracker.track_U_at_bottom">track_U_at_bottom</a>
                        </li>
                </ul>

            </li>
    </ul>



        <a class="attribution" title="pdoc: Python API documentation generator" href="https://pdoc.dev" target="_blank">
            built with <span class="visually-hidden">pdoc</span><img
                alt="pdoc logo"
                src="data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20role%3D%22img%22%20aria-label%3D%22pdoc%20logo%22%20width%3D%22300%22%20height%3D%22150%22%20viewBox%3D%22-1%200%2060%2030%22%3E%3Ctitle%3Epdoc%3C/title%3E%3Cpath%20d%3D%22M29.621%2021.293c-.011-.273-.214-.475-.511-.481a.5.5%200%200%200-.489.503l-.044%201.393c-.097.551-.695%201.215-1.566%201.704-.577.428-1.306.486-2.193.182-1.426-.617-2.467-1.654-3.304-2.487l-.173-.172a3.43%203.43%200%200%200-.365-.306.49.49%200%200%200-.286-.196c-1.718-1.06-4.931-1.47-7.353.191l-.219.15c-1.707%201.187-3.413%202.131-4.328%201.03-.02-.027-.49-.685-.141-1.763.233-.721.546-2.408.772-4.076.042-.09.067-.187.046-.288.166-1.347.277-2.625.241-3.351%201.378-1.008%202.271-2.586%202.271-4.362%200-.976-.272-1.935-.788-2.774-.057-.094-.122-.18-.184-.268.033-.167.052-.339.052-.516%200-1.477-1.202-2.679-2.679-2.679-.791%200-1.496.352-1.987.9a6.3%206.3%200%200%200-1.001.029c-.492-.564-1.207-.929-2.012-.929-1.477%200-2.679%201.202-2.679%202.679A2.65%202.65%200%200%200%20.97%206.554c-.383.747-.595%201.572-.595%202.41%200%202.311%201.507%204.29%203.635%205.107-.037.699-.147%202.27-.423%203.294l-.137.461c-.622%202.042-2.515%208.257%201.727%2010.643%201.614.908%203.06%201.248%204.317%201.248%202.665%200%204.492-1.524%205.322-2.401%201.476-1.559%202.886-1.854%206.491.82%201.877%201.393%203.514%201.753%204.861%201.068%202.223-1.713%202.811-3.867%203.399-6.374.077-.846.056-1.469.054-1.537zm-4.835%204.313c-.054.305-.156.586-.242.629-.034-.007-.131-.022-.307-.157-.145-.111-.314-.478-.456-.908.221.121.432.25.675.355.115.039.219.051.33.081zm-2.251-1.238c-.05.33-.158.648-.252.694-.022.001-.125-.018-.307-.157-.217-.166-.488-.906-.639-1.573.358.344.754.693%201.198%201.036zm-3.887-2.337c-.006-.116-.018-.231-.041-.342.635.145%201.189.368%201.599.625.097.231.166.481.174.642-.03.049-.055.101-.067.158-.046.013-.128.026-.298.004-.278-.037-.901-.57-1.367-1.087zm-1.127-.497c.116.306.176.625.12.71-.019.014-.117.045-.345.016-.206-.027-.604-.332-.986-.695.41-.051.816-.056%201.211-.031zm-4.535%201.535c.209.22.379.47.358.598-.006.041-.088.138-.351.234-.144.055-.539-.063-.979-.259a11.66%2011.66%200%200%200%20.972-.573zm.983-.664c.359-.237.738-.418%201.126-.554.25.237.479.548.457.694-.006.042-.087.138-.351.235-.174.064-.694-.105-1.232-.375zm-3.381%201.794c-.022.145-.061.29-.149.401-.133.166-.358.248-.69.251h-.002c-.133%200-.306-.26-.45-.621.417.091.854.07%201.291-.031zm-2.066-8.077a4.78%204.78%200%200%201-.775-.584c.172-.115.505-.254.88-.378l-.105.962zm-.331%202.302a10.32%2010.32%200%200%201-.828-.502c.202-.143.576-.328.984-.49l-.156.992zm-.45%202.157l-.701-.403c.214-.115.536-.249.891-.376a11.57%2011.57%200%200%201-.19.779zm-.181%201.716c.064.398.194.702.298.893-.194-.051-.435-.162-.736-.398.061-.119.224-.3.438-.495zM8.87%204.141c0%20.152-.123.276-.276.276s-.275-.124-.275-.276.123-.276.276-.276.275.124.275.276zm-.735-.389a1.15%201.15%200%200%200-.314.783%201.16%201.16%200%200%200%201.162%201.162c.457%200%20.842-.27%201.032-.653.026.117.042.238.042.362a1.68%201.68%200%200%201-1.679%201.679%201.68%201.68%200%200%201-1.679-1.679c0-.843.626-1.535%201.436-1.654zM5.059%205.406A1.68%201.68%200%200%201%203.38%207.085a1.68%201.68%200%200%201-1.679-1.679c0-.037.009-.072.011-.109.21.3.541.508.935.508a1.16%201.16%200%200%200%201.162-1.162%201.14%201.14%200%200%200-.474-.912c.015%200%20.03-.005.045-.005.926.001%201.679.754%201.679%201.68zM3.198%204.141c0%20.152-.123.276-.276.276s-.275-.124-.275-.276.123-.276.276-.276.275.124.275.276zM1.375%208.964c0-.52.103-1.035.288-1.52.466.394%201.06.64%201.717.64%201.144%200%202.116-.725%202.499-1.738.383%201.012%201.355%201.738%202.499%201.738.867%200%201.631-.421%202.121-1.062.307.605.478%201.267.478%201.942%200%202.486-2.153%204.51-4.801%204.51s-4.801-2.023-4.801-4.51zm24.342%2019.349c-.985.498-2.267.168-3.813-.979-3.073-2.281-5.453-3.199-7.813-.705-1.315%201.391-4.163%203.365-8.423.97-3.174-1.786-2.239-6.266-1.261-9.479l.146-.492c.276-1.02.395-2.457.444-3.268a6.11%206.11%200%200%200%201.18.115%206.01%206.01%200%200%200%202.536-.562l-.006.175c-.802.215-1.848.612-2.021%201.25-.079.295.021.601.274.837.219.203.415.364.598.501-.667.304-1.243.698-1.311%201.179-.02.144-.022.507.393.787.213.144.395.26.564.365-1.285.521-1.361.96-1.381%201.126-.018.142-.011.496.427.746l.854.489c-.473.389-.971.914-.999%201.429-.018.278.095.532.316.713.675.556%201.231.721%201.653.721.059%200%20.104-.014.158-.02.207.707.641%201.64%201.513%201.64h.013c.8-.008%201.236-.345%201.462-.626.173-.216.268-.457.325-.692.424.195.93.374%201.372.374.151%200%20.294-.021.423-.068.732-.27.944-.704.993-1.021.009-.061.003-.119.002-.179.266.086.538.147.789.147.15%200%20.294-.021.423-.069.542-.2.797-.489.914-.754.237.147.478.258.704.288.106.014.205.021.296.021.356%200%20.595-.101.767-.229.438.435%201.094.992%201.656%201.067.106.014.205.021.296.021a1.56%201.56%200%200%200%20.323-.035c.17.575.453%201.289.866%201.605.358.273.665.362.914.362a.99.99%200%200%200%20.421-.093%201.03%201.03%200%200%200%20.245-.164c.168.428.39.846.68%201.068.358.273.665.362.913.362a.99.99%200%200%200%20.421-.093c.317-.148.512-.448.639-.762.251.157.495.257.726.257.127%200%20.25-.024.37-.071.427-.17.706-.617.841-1.314.022-.015.047-.022.068-.038.067-.051.133-.104.196-.159-.443%201.486-1.107%202.761-2.086%203.257zM8.66%209.925a.5.5%200%201%200-1%200c0%20.653-.818%201.205-1.787%201.205s-1.787-.552-1.787-1.205a.5.5%200%201%200-1%200c0%201.216%201.25%202.205%202.787%202.205s2.787-.989%202.787-2.205zm4.4%2015.965l-.208.097c-2.661%201.258-4.708%201.436-6.086.527-1.542-1.017-1.88-3.19-1.844-4.198a.4.4%200%200%200-.385-.414c-.242-.029-.406.164-.414.385-.046%201.249.367%203.686%202.202%204.896.708.467%201.547.7%202.51.7%201.248%200%202.706-.392%204.362-1.174l.185-.086a.4.4%200%200%200%20.205-.527c-.089-.204-.326-.291-.527-.206zM9.547%202.292c.093.077.205.114.317.114a.5.5%200%200%200%20.318-.886L8.817.397a.5.5%200%200%200-.703.068.5.5%200%200%200%20.069.703l1.364%201.124zm-7.661-.065c.086%200%20.173-.022.253-.068l1.523-.893a.5.5%200%200%200-.506-.863l-1.523.892a.5.5%200%200%200-.179.685c.094.158.261.247.432.247z%22%20transform%3D%22matrix%28-1%200%200%201%2058%200%29%22%20fill%3D%22%233bb300%22/%3E%3Cpath%20d%3D%22M.3%2021.86V10.18q0-.46.02-.68.04-.22.18-.5.28-.54%201.34-.54%201.06%200%201.42.28.38.26.44.78.76-1.04%202.38-1.04%201.64%200%203.1%201.54%201.46%201.54%201.46%203.58%200%202.04-1.46%203.58-1.44%201.54-3.08%201.54-1.64%200-2.38-.92v4.04q0%20.46-.04.68-.02.22-.18.5-.14.3-.5.42-.36.12-.98.12-.62%200-1-.12-.36-.12-.52-.4-.14-.28-.18-.5-.02-.22-.02-.68zm3.96-9.42q-.46.54-.46%201.18%200%20.64.46%201.18.48.52%201.2.52.74%200%201.24-.52.52-.52.52-1.18%200-.66-.48-1.18-.48-.54-1.26-.54-.76%200-1.22.54zm14.741-8.36q.16-.3.54-.42.38-.12%201-.12.64%200%201.02.12.38.12.52.42.16.3.18.54.04.22.04.68v11.94q0%20.46-.04.7-.02.22-.18.5-.3.54-1.7.54-1.38%200-1.54-.98-.84.96-2.34.96-1.8%200-3.28-1.56-1.48-1.58-1.48-3.66%200-2.1%201.48-3.68%201.5-1.58%203.28-1.58%201.48%200%202.3%201v-4.2q0-.46.02-.68.04-.24.18-.52zm-3.24%2010.86q.52.54%201.26.54.74%200%201.22-.54.5-.54.5-1.18%200-.66-.48-1.22-.46-.56-1.26-.56-.8%200-1.28.56-.48.54-.48%201.2%200%20.66.52%201.2zm7.833-1.2q0-2.4%201.68-3.96%201.68-1.56%203.84-1.56%202.16%200%203.82%201.56%201.66%201.54%201.66%203.94%200%201.66-.86%202.96-.86%201.28-2.1%201.9-1.22.6-2.54.6-1.32%200-2.56-.64-1.24-.66-2.1-1.92-.84-1.28-.84-2.88zm4.18%201.44q.64.48%201.3.48.66%200%201.32-.5.66-.5.66-1.48%200-.98-.62-1.46-.62-.48-1.34-.48-.72%200-1.34.5-.62.5-.62%201.48%200%20.96.64%201.46zm11.412-1.44q0%20.84.56%201.32.56.46%201.18.46.64%200%201.18-.36.56-.38.9-.38.6%200%201.46%201.06.46.58.46%201.04%200%20.76-1.1%201.42-1.14.8-2.8.8-1.86%200-3.58-1.34-.82-.64-1.34-1.7-.52-1.08-.52-2.36%200-1.3.52-2.34.52-1.06%201.34-1.7%201.66-1.32%203.54-1.32.76%200%201.48.22.72.2%201.06.4l.32.2q.36.24.56.38.52.4.52.92%200%20.5-.42%201.14-.72%201.1-1.38%201.1-.38%200-1.08-.44-.36-.34-1.04-.34-.66%200-1.24.48-.58.48-.58%201.34z%22%20fill%3D%22green%22/%3E%3C/svg%3E"/>
        </a>
</div>
    </nav>
    <main class="pdoc">
            <section class="module-info">
                    <h1 class="modulename">
marlpde    </h1>

                        <div class="docstring"><h1 id="integrating-diagenetic-equations-using-python">Integrating diagenetic equations using Python</h1>

<p>This repo was created as an attempt to reproduce the plots shown at the kickoff of the AstroTOM ("Turing or Milankovitch") project by Niklas Hohmann, from his Matlab scripts (available at <a href="https://github.com/MindTheGap-ERC/LMA-Matlab">github.com/MindTheGap-ERC/LMA-Matlab</a>). </p>

<p>AstroTOM is an OpenSSI 2021b project from the Netherlands eScience Center and Utrecht University (UU).</p>

<p>Dr. Emilia Jarochowska (UU) is the lead applicant of this project.</p>

<p>After replacing central differencing for the gradients in the five diagenetic equations 40-43 from <a href="https://www.hindawi.com/journals/geofluids/2018/4968315/">L'Heureux (2018)</a> by forward and backward differencing depending on the sign of U and W as a first step and a Fiadeiro-Veronis spatial difference scheme as a second step, it turns out that these equations can be integrated for more than 13.190 years (the full T*) with an implicit or explicit (in time) solver, but not with a simple Eulerian scheme. A Runge-Kutta solver, with an adaptive timestep will, however, suffice.
After correcting the value of b (5-->5e-4) it turned out that a stable integration is also possible without a Fiadeiro-Veronis scheme. The <code>main</code> branch makes use of a constant porosity diffusion coefficient.</p>

<p>Implicit (in time) solvers with use of Jacobians (in functional forms, so without numerical approximations) are available in the <code>Use_solve_ivp_without_py-pde_wrapper</code> branch.</p>

<p>Wide use is made of the <a href="https://py-pde.readthedocs.io/en/latest/">py-pde</a> package, especially in the <code>main</code> branch.</p>

<h2 id="installing-and-using">Installing and using</h2>

<p>To run this code, you need <code>git</code> and <code>conda</code> or <code>pip</code> to install .</p>

<pre><code>git clone git@github.com:astro-turing/Integrating-diagenetic-equations-using-Python.git
</code></pre>

<p>or </p>

<pre><code>git clone https://github.com/astro-turing/Integrating-diagenetic-equations-using-Python.git
</code></pre>

<p>Next,</p>

<pre><code>cd Integrating-diagenetic-equations-using-Python
pipenv install
</code></pre>

<p>For the latter command you need <code>pipenv</code> which you can install
using either
<code>pip install pipenv</code>
or
<code>conda install -c conda-forge pipenv</code>.</p>

<p>Now you may be running into certain Python version requirements, i.e. the Pipfile requires a Python version that you do not have installed. For this conda can help, e.g.:
<code>conda create -n py311 python=3.11 anaconda</code> to create a Conda Python 3.11 environment. </p>

<p>You can use that freshly installed Python version and possibly any additionally installed libraries - using the <code>--site-packages</code> argument - by executing <code>pipenv install --python=$(conda run -n py311 which python) --site-packages --skip-lock</code>. The latter argument - <code>--skip-lock</code> - may be redundant, but if your previous <code>pipenv install</code> failed, <code>pipenv --rm</code> may be needed. </p>

<p>After a succesful pipenv installation you should be able to execute</p>

<pre><code>pipenv run python marlpde/Evolve_scenario.py
</code></pre>

<p>or</p>

<pre><code>pipenv shell
python marlpde/Evolve_scenario.py
</code></pre>

<p>Results in the form of an .hdf5 file will be stored in a subdirectory of a <code>Results</code> directory, which will be in the root folder of the cloned repo.</p>

<h3 id="alternative-poetry">Alternative: poetry</h3>

<p>If you prefer <a href="https://python-poetry.org/"><code>poetry</code></a> over <code>pipenv</code>, you may install all the dependencies and activate the environment using the command <code>poetry install</code>. Next, either:</p>

<pre><code>poetry run python marlpde/Evolve_scenario.py
</code></pre>

<p>or</p>

<pre><code>poetry shell
python marlpde/Evolve_scenario.py
</code></pre>

<h2 id="running-tests">Running tests</h2>

<p>From the root folder, i.e. the folder you enter after <code>cd Integrating-diagenetic-equations-using-Python</code>, either run</p>

<pre><code>pipenv run python -m pytest
</code></pre>

<p>or</p>

<pre><code>poetry run python -m pytest
</code></pre>

<h2 id="copyright">Copyright</h2>

<p>Copyright 2023 Netherlands eScience Center and Utrecht University</p>

<h2 id="funding-information">Funding information</h2>

<p>Funded by the European Union (ERC, MindTheGap, StG project no 101041077). Views and opinions expressed are however those of the author(s) only and do not necessarily reflect those of the European Union or the European Research Council. Neither the European Union nor the granting authority can be held responsible for them.
<img src="https://erc.europa.eu/sites/default/files/2023-06/LOGO_ERC-FLAG_FP.png" alt="European Union and European Research Council logos" /></p>
</div>

                        <input id="mod-marlpde-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">

                        <label class="view-source-button" for="mod-marlpde-view-source"><span>View Source</span></label>

                        <div class="pdoc-code codehilite"><pre><span></span><span id="L-1"><a href="#L-1"><span class="linenos"> 1</span></a><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-2"><a href="#L-2"><span class="linenos"> 2</span></a><span class="sd">.. include:: ../README.md</span>
</span><span id="L-3"><a href="#L-3"><span class="linenos"> 3</span></a><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-4"><a href="#L-4"><span class="linenos"> 4</span></a><span class="kn">import</span> <span class="nn">pathlib</span>
</span><span id="L-5"><a href="#L-5"><span class="linenos"> 5</span></a><span class="kn">import</span> <span class="nn">sys</span>
</span><span id="L-6"><a href="#L-6"><span class="linenos"> 6</span></a><span class="kn">from</span> <span class="nn">.LHeureux_model</span> <span class="kn">import</span> <span class="n">LMAHeureuxPorosityDiff</span>
</span><span id="L-7"><a href="#L-7"><span class="linenos"> 7</span></a><span class="kn">from</span> <span class="nn">.parameters</span> <span class="kn">import</span> <span class="n">Map_Scenario</span><span class="p">,</span> <span class="n">Solver</span><span class="p">,</span> <span class="n">Tracker</span>
</span><span id="L-8"><a href="#L-8"><span class="linenos"> 8</span></a><span class="kn">from</span> <span class="nn">.parameters</span> <span class="kn">import</span> <span class="n">Scenario</span><span class="p">,</span> <span class="n">jacobian_sparsity</span>
</span><span id="L-9"><a href="#L-9"><span class="linenos"> 9</span></a>
</span><span id="L-10"><a href="#L-10"><span class="linenos">10</span></a><span class="c1"># Control what pdoc will document, i.e. output to .html.</span>
</span><span id="L-11"><a href="#L-11"><span class="linenos">11</span></a><span class="n">__all__</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;LMAHeureuxPorosityDiff&#39;</span><span class="p">,</span> <span class="s1">&#39;Scenario&#39;</span><span class="p">,</span> <span class="s1">&#39;Map_Scenario&#39;</span><span class="p">,</span> 
</span><span id="L-12"><a href="#L-12"><span class="linenos">12</span></a>           <span class="s1">&#39;jacobian_sparsity&#39;</span><span class="p">,</span> <span class="s1">&#39;Solver&#39;</span><span class="p">,</span> <span class="s1">&#39;Tracker&#39;</span><span class="p">]</span>
</span><span id="L-13"><a href="#L-13"><span class="linenos">13</span></a>
</span><span id="L-14"><a href="#L-14"><span class="linenos">14</span></a><span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)</span><span class="o">.</span><span class="n">parent</span><span class="p">))</span>
</span></pre></div>


            </section>
                <section id="LMAHeureuxPorosityDiff">
                            <input id="LMAHeureuxPorosityDiff-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">LMAHeureuxPorosityDiff</span><wbr>(<span class="base">pde.pdes.base.PDEBase</span>):

                <label class="view-source-button" for="LMAHeureuxPorosityDiff-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#LMAHeureuxPorosityDiff"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="LMAHeureuxPorosityDiff-12"><a href="#LMAHeureuxPorosityDiff-12"><span class="linenos"> 12</span></a><span class="k">class</span> <span class="nc">LMAHeureuxPorosityDiff</span><span class="p">(</span><span class="n">PDEBase</span><span class="p">):</span>
</span><span id="LMAHeureuxPorosityDiff-13"><a href="#LMAHeureuxPorosityDiff-13"><span class="linenos"> 13</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Sets all the physical parameters that define the model.&quot;&quot;&quot;</span>
</span><span id="LMAHeureuxPorosityDiff-14"><a href="#LMAHeureuxPorosityDiff-14"><span class="linenos"> 14</span></a>
</span><span id="LMAHeureuxPorosityDiff-15"><a href="#LMAHeureuxPorosityDiff-15"><span class="linenos"> 15</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">AragoniteSurface</span><span class="p">,</span> <span class="n">CalciteSurface</span><span class="p">,</span> <span class="n">CaSurface</span><span class="p">,</span>
</span><span id="LMAHeureuxPorosityDiff-16"><a href="#LMAHeureuxPorosityDiff-16"><span class="linenos"> 16</span></a>                <span class="n">CO3Surface</span><span class="p">,</span> <span class="n">PorSurface</span><span class="p">,</span> <span class="n">not_too_shallow</span><span class="p">,</span> <span class="n">not_too_deep</span><span class="p">,</span> <span class="n">CA0</span><span class="p">,</span> <span class="n">CC0</span><span class="p">,</span>
</span><span id="LMAHeureuxPorosityDiff-17"><a href="#LMAHeureuxPorosityDiff-17"><span class="linenos"> 17</span></a>                <span class="n">cCa0</span><span class="p">,</span> <span class="n">cCO30</span><span class="p">,</span> <span class="n">Phi0</span><span class="p">,</span> <span class="n">sedimentationrate</span><span class="p">,</span> <span class="n">Xstar</span><span class="p">,</span> <span class="n">Tstar</span><span class="p">,</span> <span class="n">k1</span><span class="p">,</span> <span class="n">k2</span><span class="p">,</span> <span class="n">k3</span><span class="p">,</span>
</span><span id="LMAHeureuxPorosityDiff-18"><a href="#LMAHeureuxPorosityDiff-18"><span class="linenos"> 18</span></a>                <span class="n">k4</span><span class="p">,</span> <span class="n">m1</span><span class="p">,</span> <span class="n">m2</span><span class="p">,</span> <span class="n">n1</span><span class="p">,</span> <span class="n">n2</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">beta</span><span class="p">,</span> <span class="n">rhos</span><span class="p">,</span> <span class="n">rhow</span><span class="p">,</span> <span class="n">rhos0</span><span class="p">,</span> <span class="n">KA</span><span class="p">,</span> <span class="n">KC</span><span class="p">,</span> <span class="n">muA</span><span class="p">,</span>
</span><span id="LMAHeureuxPorosityDiff-19"><a href="#LMAHeureuxPorosityDiff-19"><span class="linenos"> 19</span></a>                <span class="n">D0Ca</span><span class="p">,</span> <span class="n">PhiNR</span><span class="p">,</span> <span class="n">PhiInfty</span><span class="p">,</span> <span class="n">PhiIni</span><span class="p">,</span> <span class="n">DCa</span><span class="p">,</span> <span class="n">DCO3</span><span class="p">):</span>
</span><span id="LMAHeureuxPorosityDiff-20"><a href="#LMAHeureuxPorosityDiff-20"><span class="linenos"> 20</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;@private&quot;&quot;&quot;</span>
</span><span id="LMAHeureuxPorosityDiff-21"><a href="#LMAHeureuxPorosityDiff-21"><span class="linenos"> 21</span></a>
</span><span id="LMAHeureuxPorosityDiff-22"><a href="#LMAHeureuxPorosityDiff-22"><span class="linenos"> 22</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">AragoniteSurface</span> <span class="o">=</span> <span class="n">AragoniteSurface</span>
</span><span id="LMAHeureuxPorosityDiff-23"><a href="#LMAHeureuxPorosityDiff-23"><span class="linenos"> 23</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;  (*pde.ScalarField*):   </span>
</span><span id="LMAHeureuxPorosityDiff-24"><a href="#LMAHeureuxPorosityDiff-24"><span class="linenos"> 24</span></a><span class="sd">        Initial distribution of aragonite composition along all depths</span>
</span><span id="LMAHeureuxPorosityDiff-25"><a href="#LMAHeureuxPorosityDiff-25"><span class="linenos"> 25</span></a><span class="sd">        (dimensionless).&quot;&quot;&quot;</span>
</span><span id="LMAHeureuxPorosityDiff-26"><a href="#LMAHeureuxPorosityDiff-26"><span class="linenos"> 26</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">CalciteSurface</span> <span class="o">=</span> <span class="n">CalciteSurface</span>
</span><span id="LMAHeureuxPorosityDiff-27"><a href="#LMAHeureuxPorosityDiff-27"><span class="linenos"> 27</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;(*pde.ScalarField*):   </span>
</span><span id="LMAHeureuxPorosityDiff-28"><a href="#LMAHeureuxPorosityDiff-28"><span class="linenos"> 28</span></a><span class="sd">        Initial distribution of calcite composition along all depths</span>
</span><span id="LMAHeureuxPorosityDiff-29"><a href="#LMAHeureuxPorosityDiff-29"><span class="linenos"> 29</span></a><span class="sd">        (dimensionless).&quot;&quot;&quot;</span>
</span><span id="LMAHeureuxPorosityDiff-30"><a href="#LMAHeureuxPorosityDiff-30"><span class="linenos"> 30</span></a>        
</span><span id="LMAHeureuxPorosityDiff-31"><a href="#LMAHeureuxPorosityDiff-31"><span class="linenos"> 31</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">CaSurface</span> <span class="o">=</span> <span class="n">CaSurface</span>
</span><span id="LMAHeureuxPorosityDiff-32"><a href="#LMAHeureuxPorosityDiff-32"><span class="linenos"> 32</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;(*pde.Scalarfield*):   </span>
</span><span id="LMAHeureuxPorosityDiff-33"><a href="#LMAHeureuxPorosityDiff-33"><span class="linenos"> 33</span></a><span class="sd">        Initial distribution of calcium ions concentration along all depths</span>
</span><span id="LMAHeureuxPorosityDiff-34"><a href="#LMAHeureuxPorosityDiff-34"><span class="linenos"> 34</span></a><span class="sd">        (dimensionless).&quot;&quot;&quot;</span>
</span><span id="LMAHeureuxPorosityDiff-35"><a href="#LMAHeureuxPorosityDiff-35"><span class="linenos"> 35</span></a>        
</span><span id="LMAHeureuxPorosityDiff-36"><a href="#LMAHeureuxPorosityDiff-36"><span class="linenos"> 36</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">CO3Surface</span> <span class="o">=</span> <span class="n">CO3Surface</span>
</span><span id="LMAHeureuxPorosityDiff-37"><a href="#LMAHeureuxPorosityDiff-37"><span class="linenos"> 37</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;(*pde.ScalarField*):   </span>
</span><span id="LMAHeureuxPorosityDiff-38"><a href="#LMAHeureuxPorosityDiff-38"><span class="linenos"> 38</span></a><span class="sd">        Initial distribution of carbonate ions concentration along all depths</span>
</span><span id="LMAHeureuxPorosityDiff-39"><a href="#LMAHeureuxPorosityDiff-39"><span class="linenos"> 39</span></a><span class="sd">        (dimensionless).&quot;&quot;&quot;</span>
</span><span id="LMAHeureuxPorosityDiff-40"><a href="#LMAHeureuxPorosityDiff-40"><span class="linenos"> 40</span></a>        
</span><span id="LMAHeureuxPorosityDiff-41"><a href="#LMAHeureuxPorosityDiff-41"><span class="linenos"> 41</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">PorSurface</span> <span class="o">=</span> <span class="n">PorSurface</span>
</span><span id="LMAHeureuxPorosityDiff-42"><a href="#LMAHeureuxPorosityDiff-42"><span class="linenos"> 42</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;(*pde.ScalarField*):   </span>
</span><span id="LMAHeureuxPorosityDiff-43"><a href="#LMAHeureuxPorosityDiff-43"><span class="linenos"> 43</span></a><span class="sd">        Initial distribution of porosity along all depths (dimensionless).&quot;&quot;&quot;</span>
</span><span id="LMAHeureuxPorosityDiff-44"><a href="#LMAHeureuxPorosityDiff-44"><span class="linenos"> 44</span></a>        
</span><span id="LMAHeureuxPorosityDiff-45"><a href="#LMAHeureuxPorosityDiff-45"><span class="linenos"> 45</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">bc_CA</span> <span class="o">=</span> <span class="p">[{</span><span class="s2">&quot;value&quot;</span><span class="p">:</span> <span class="n">CA0</span><span class="p">},</span> <span class="p">{</span><span class="s2">&quot;curvature&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">}]</span>
</span><span id="LMAHeureuxPorosityDiff-46"><a href="#LMAHeureuxPorosityDiff-46"><span class="linenos"> 46</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Top and bottom  boundary condition for aragonite.  </span>
</span><span id="LMAHeureuxPorosityDiff-47"><a href="#LMAHeureuxPorosityDiff-47"><span class="linenos"> 47</span></a><span class="sd">        **CA0** (*float*):   </span>
</span><span id="LMAHeureuxPorosityDiff-48"><a href="#LMAHeureuxPorosityDiff-48"><span class="linenos"> 48</span></a><span class="sd">        Aragonite composition at the top of the system, i.e. at the </span>
</span><span id="LMAHeureuxPorosityDiff-49"><a href="#LMAHeureuxPorosityDiff-49"><span class="linenos"> 49</span></a><span class="sd">        water-sediment interface (dimensionless).&quot;&quot;&quot;</span>
</span><span id="LMAHeureuxPorosityDiff-50"><a href="#LMAHeureuxPorosityDiff-50"><span class="linenos"> 50</span></a>        
</span><span id="LMAHeureuxPorosityDiff-51"><a href="#LMAHeureuxPorosityDiff-51"><span class="linenos"> 51</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">bc_CC</span> <span class="o">=</span> <span class="p">[{</span><span class="s2">&quot;value&quot;</span><span class="p">:</span> <span class="n">CC0</span><span class="p">},</span> <span class="p">{</span><span class="s2">&quot;curvature&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">}]</span>        
</span><span id="LMAHeureuxPorosityDiff-52"><a href="#LMAHeureuxPorosityDiff-52"><span class="linenos"> 52</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Top and bottom  boundary condition for calcite.  </span>
</span><span id="LMAHeureuxPorosityDiff-53"><a href="#LMAHeureuxPorosityDiff-53"><span class="linenos"> 53</span></a><span class="sd">        **CC0** (*float*):   </span>
</span><span id="LMAHeureuxPorosityDiff-54"><a href="#LMAHeureuxPorosityDiff-54"><span class="linenos"> 54</span></a><span class="sd">        Calcite composition at the top of the system, i.e. at the </span>
</span><span id="LMAHeureuxPorosityDiff-55"><a href="#LMAHeureuxPorosityDiff-55"><span class="linenos"> 55</span></a><span class="sd">        water-sediment interface (dimensionless).&quot;&quot;&quot;</span>
</span><span id="LMAHeureuxPorosityDiff-56"><a href="#LMAHeureuxPorosityDiff-56"><span class="linenos"> 56</span></a>
</span><span id="LMAHeureuxPorosityDiff-57"><a href="#LMAHeureuxPorosityDiff-57"><span class="linenos"> 57</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">bc_cCa</span> <span class="o">=</span> <span class="p">[{</span><span class="s2">&quot;value&quot;</span><span class="p">:</span> <span class="n">cCa0</span><span class="p">},</span> <span class="p">{</span><span class="s2">&quot;derivative&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">}]</span>
</span><span id="LMAHeureuxPorosityDiff-58"><a href="#LMAHeureuxPorosityDiff-58"><span class="linenos"> 58</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Top and bottom  boundary condition for the concentration of</span>
</span><span id="LMAHeureuxPorosityDiff-59"><a href="#LMAHeureuxPorosityDiff-59"><span class="linenos"> 59</span></a><span class="sd">        calcium ions.  </span>
</span><span id="LMAHeureuxPorosityDiff-60"><a href="#LMAHeureuxPorosityDiff-60"><span class="linenos"> 60</span></a><span class="sd">        **cCa0** (*float*):   </span>
</span><span id="LMAHeureuxPorosityDiff-61"><a href="#LMAHeureuxPorosityDiff-61"><span class="linenos"> 61</span></a><span class="sd">        Calcium ion concentration at the top of the system, i.e. at the </span>
</span><span id="LMAHeureuxPorosityDiff-62"><a href="#LMAHeureuxPorosityDiff-62"><span class="linenos"> 62</span></a><span class="sd">        water-sediment interface (dimensionless).&quot;&quot;&quot;</span>
</span><span id="LMAHeureuxPorosityDiff-63"><a href="#LMAHeureuxPorosityDiff-63"><span class="linenos"> 63</span></a>
</span><span id="LMAHeureuxPorosityDiff-64"><a href="#LMAHeureuxPorosityDiff-64"><span class="linenos"> 64</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">bc_cCO3</span> <span class="o">=</span> <span class="p">[{</span><span class="s2">&quot;value&quot;</span><span class="p">:</span> <span class="n">cCO30</span><span class="p">},</span> <span class="p">{</span><span class="s2">&quot;derivative&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">}]</span>
</span><span id="LMAHeureuxPorosityDiff-65"><a href="#LMAHeureuxPorosityDiff-65"><span class="linenos"> 65</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Top and bottom  boundary condition for the concentration of</span>
</span><span id="LMAHeureuxPorosityDiff-66"><a href="#LMAHeureuxPorosityDiff-66"><span class="linenos"> 66</span></a><span class="sd">        carbonate ions.  </span>
</span><span id="LMAHeureuxPorosityDiff-67"><a href="#LMAHeureuxPorosityDiff-67"><span class="linenos"> 67</span></a><span class="sd">        **cCO30** (*float*):   </span>
</span><span id="LMAHeureuxPorosityDiff-68"><a href="#LMAHeureuxPorosityDiff-68"><span class="linenos"> 68</span></a><span class="sd">        Carbonate ion concentration at the top of the system, i.e. at the</span>
</span><span id="LMAHeureuxPorosityDiff-69"><a href="#LMAHeureuxPorosityDiff-69"><span class="linenos"> 69</span></a><span class="sd">        water-sediment interface (dimensionless).&quot;&quot;&quot;</span>
</span><span id="LMAHeureuxPorosityDiff-70"><a href="#LMAHeureuxPorosityDiff-70"><span class="linenos"> 70</span></a>        
</span><span id="LMAHeureuxPorosityDiff-71"><a href="#LMAHeureuxPorosityDiff-71"><span class="linenos"> 71</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">bc_Phi</span> <span class="o">=</span> <span class="p">[{</span><span class="s2">&quot;value&quot;</span><span class="p">:</span> <span class="n">Phi0</span><span class="p">},</span> <span class="p">{</span><span class="s2">&quot;derivative&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">}]</span>
</span><span id="LMAHeureuxPorosityDiff-72"><a href="#LMAHeureuxPorosityDiff-72"><span class="linenos"> 72</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Top and bottom  boundary condition for the porosity.  </span>
</span><span id="LMAHeureuxPorosityDiff-73"><a href="#LMAHeureuxPorosityDiff-73"><span class="linenos"> 73</span></a><span class="sd">        **Phi0** (*float*):   </span>
</span><span id="LMAHeureuxPorosityDiff-74"><a href="#LMAHeureuxPorosityDiff-74"><span class="linenos"> 74</span></a><span class="sd">        Porosity at the top of the system, i.e. at the water-sediment </span>
</span><span id="LMAHeureuxPorosityDiff-75"><a href="#LMAHeureuxPorosityDiff-75"><span class="linenos"> 75</span></a><span class="sd">        interface (dimensionless).&quot;&quot;&quot;</span>
</span><span id="LMAHeureuxPorosityDiff-76"><a href="#LMAHeureuxPorosityDiff-76"><span class="linenos"> 76</span></a>        
</span><span id="LMAHeureuxPorosityDiff-77"><a href="#LMAHeureuxPorosityDiff-77"><span class="linenos"> 77</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">sedimentationrate</span> <span class="o">=</span> <span class="n">sedimentationrate</span>
</span><span id="LMAHeureuxPorosityDiff-78"><a href="#LMAHeureuxPorosityDiff-78"><span class="linenos"> 78</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;(*float*):   </span>
</span><span id="LMAHeureuxPorosityDiff-79"><a href="#LMAHeureuxPorosityDiff-79"><span class="linenos"> 79</span></a><span class="sd">        Sedimentation rate (cm/a).&quot;&quot;&quot;</span>
</span><span id="LMAHeureuxPorosityDiff-80"><a href="#LMAHeureuxPorosityDiff-80"><span class="linenos"> 80</span></a>        
</span><span id="LMAHeureuxPorosityDiff-81"><a href="#LMAHeureuxPorosityDiff-81"><span class="linenos"> 81</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">Xstar</span> <span class="o">=</span> <span class="n">Xstar</span>
</span><span id="LMAHeureuxPorosityDiff-82"><a href="#LMAHeureuxPorosityDiff-82"><span class="linenos"> 82</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;(*float*):   </span>
</span><span id="LMAHeureuxPorosityDiff-83"><a href="#LMAHeureuxPorosityDiff-83"><span class="linenos"> 83</span></a><span class="sd">        Scaling factor between physical depths and dimensionless depths as</span>
</span><span id="LMAHeureuxPorosityDiff-84"><a href="#LMAHeureuxPorosityDiff-84"><span class="linenos"> 84</span></a><span class="sd">        used in the differential equations, in cm.&quot;&quot;&quot;</span>
</span><span id="LMAHeureuxPorosityDiff-85"><a href="#LMAHeureuxPorosityDiff-85"><span class="linenos"> 85</span></a>        
</span><span id="LMAHeureuxPorosityDiff-86"><a href="#LMAHeureuxPorosityDiff-86"><span class="linenos"> 86</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">Tstar</span> <span class="o">=</span> <span class="n">Tstar</span>
</span><span id="LMAHeureuxPorosityDiff-87"><a href="#LMAHeureuxPorosityDiff-87"><span class="linenos"> 87</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;(*float*):   </span>
</span><span id="LMAHeureuxPorosityDiff-88"><a href="#LMAHeureuxPorosityDiff-88"><span class="linenos"> 88</span></a><span class="sd">        Scaling factor between physical time and dimensionless time as</span>
</span><span id="LMAHeureuxPorosityDiff-89"><a href="#LMAHeureuxPorosityDiff-89"><span class="linenos"> 89</span></a><span class="sd">        used in the differential equations, in years.&quot;&quot;&quot;</span>
</span><span id="LMAHeureuxPorosityDiff-90"><a href="#LMAHeureuxPorosityDiff-90"><span class="linenos"> 90</span></a>        
</span><span id="LMAHeureuxPorosityDiff-91"><a href="#LMAHeureuxPorosityDiff-91"><span class="linenos"> 91</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">k1</span> <span class="o">=</span> <span class="n">k1</span>
</span><span id="LMAHeureuxPorosityDiff-92"><a href="#LMAHeureuxPorosityDiff-92"><span class="linenos"> 92</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;(*float*):   </span>
</span><span id="LMAHeureuxPorosityDiff-93"><a href="#LMAHeureuxPorosityDiff-93"><span class="linenos"> 93</span></a><span class="sd">        rate coefficient (1/a).&quot;&quot;&quot;</span>
</span><span id="LMAHeureuxPorosityDiff-94"><a href="#LMAHeureuxPorosityDiff-94"><span class="linenos"> 94</span></a>        
</span><span id="LMAHeureuxPorosityDiff-95"><a href="#LMAHeureuxPorosityDiff-95"><span class="linenos"> 95</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">k2</span> <span class="o">=</span> <span class="n">k2</span>
</span><span id="LMAHeureuxPorosityDiff-96"><a href="#LMAHeureuxPorosityDiff-96"><span class="linenos"> 96</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;(*float*):   </span>
</span><span id="LMAHeureuxPorosityDiff-97"><a href="#LMAHeureuxPorosityDiff-97"><span class="linenos"> 97</span></a><span class="sd">        rate coefficient (1/a).&quot;&quot;&quot;</span>
</span><span id="LMAHeureuxPorosityDiff-98"><a href="#LMAHeureuxPorosityDiff-98"><span class="linenos"> 98</span></a>        
</span><span id="LMAHeureuxPorosityDiff-99"><a href="#LMAHeureuxPorosityDiff-99"><span class="linenos"> 99</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">nu1</span> <span class="o">=</span> <span class="n">k1</span><span class="o">/</span><span class="n">k2</span>
</span><span id="LMAHeureuxPorosityDiff-100"><a href="#LMAHeureuxPorosityDiff-100"><span class="linenos">100</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;@private&quot;&quot;&quot;</span>
</span><span id="LMAHeureuxPorosityDiff-101"><a href="#LMAHeureuxPorosityDiff-101"><span class="linenos">101</span></a>
</span><span id="LMAHeureuxPorosityDiff-102"><a href="#LMAHeureuxPorosityDiff-102"><span class="linenos">102</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">k3</span> <span class="o">=</span> <span class="n">k3</span>
</span><span id="LMAHeureuxPorosityDiff-103"><a href="#LMAHeureuxPorosityDiff-103"><span class="linenos">103</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;(*float*):   </span>
</span><span id="LMAHeureuxPorosityDiff-104"><a href="#LMAHeureuxPorosityDiff-104"><span class="linenos">104</span></a><span class="sd">        rate coefficient (1/a).&quot;&quot;&quot;</span>
</span><span id="LMAHeureuxPorosityDiff-105"><a href="#LMAHeureuxPorosityDiff-105"><span class="linenos">105</span></a>        
</span><span id="LMAHeureuxPorosityDiff-106"><a href="#LMAHeureuxPorosityDiff-106"><span class="linenos">106</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">k4</span> <span class="o">=</span> <span class="n">k4</span>
</span><span id="LMAHeureuxPorosityDiff-107"><a href="#LMAHeureuxPorosityDiff-107"><span class="linenos">107</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;(*float*):   </span>
</span><span id="LMAHeureuxPorosityDiff-108"><a href="#LMAHeureuxPorosityDiff-108"><span class="linenos">108</span></a><span class="sd">        rate coefficient (1/a).&quot;&quot;&quot;</span>
</span><span id="LMAHeureuxPorosityDiff-109"><a href="#LMAHeureuxPorosityDiff-109"><span class="linenos">109</span></a>        
</span><span id="LMAHeureuxPorosityDiff-110"><a href="#LMAHeureuxPorosityDiff-110"><span class="linenos">110</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">nu2</span> <span class="o">=</span> <span class="n">k4</span><span class="o">/</span><span class="n">k3</span>
</span><span id="LMAHeureuxPorosityDiff-111"><a href="#LMAHeureuxPorosityDiff-111"><span class="linenos">111</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;@private&quot;&quot;&quot;</span>
</span><span id="LMAHeureuxPorosityDiff-112"><a href="#LMAHeureuxPorosityDiff-112"><span class="linenos">112</span></a>        
</span><span id="LMAHeureuxPorosityDiff-113"><a href="#LMAHeureuxPorosityDiff-113"><span class="linenos">113</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">m1</span> <span class="o">=</span> <span class="n">m1</span>
</span><span id="LMAHeureuxPorosityDiff-114"><a href="#LMAHeureuxPorosityDiff-114"><span class="linenos">114</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;(*float*):       </span>
</span><span id="LMAHeureuxPorosityDiff-115"><a href="#LMAHeureuxPorosityDiff-115"><span class="linenos">115</span></a><span class="sd">        Exponent of the reaction term for aragonite precipation.&quot;&quot;&quot;</span>
</span><span id="LMAHeureuxPorosityDiff-116"><a href="#LMAHeureuxPorosityDiff-116"><span class="linenos">116</span></a>        
</span><span id="LMAHeureuxPorosityDiff-117"><a href="#LMAHeureuxPorosityDiff-117"><span class="linenos">117</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">m2</span> <span class="o">=</span> <span class="n">m2</span>
</span><span id="LMAHeureuxPorosityDiff-118"><a href="#LMAHeureuxPorosityDiff-118"><span class="linenos">118</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;(*float*):   </span>
</span><span id="LMAHeureuxPorosityDiff-119"><a href="#LMAHeureuxPorosityDiff-119"><span class="linenos">119</span></a><span class="sd">        Exponent of the reaction term for aragonite dissolution.&quot;&quot;&quot;</span>
</span><span id="LMAHeureuxPorosityDiff-120"><a href="#LMAHeureuxPorosityDiff-120"><span class="linenos">120</span></a>        
</span><span id="LMAHeureuxPorosityDiff-121"><a href="#LMAHeureuxPorosityDiff-121"><span class="linenos">121</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">n1</span> <span class="o">=</span> <span class="n">n1</span>
</span><span id="LMAHeureuxPorosityDiff-122"><a href="#LMAHeureuxPorosityDiff-122"><span class="linenos">122</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;(*float*):   </span>
</span><span id="LMAHeureuxPorosityDiff-123"><a href="#LMAHeureuxPorosityDiff-123"><span class="linenos">123</span></a><span class="sd">        Exponent of the reaction term for calcite precipation.&quot;&quot;&quot;</span>
</span><span id="LMAHeureuxPorosityDiff-124"><a href="#LMAHeureuxPorosityDiff-124"><span class="linenos">124</span></a>        
</span><span id="LMAHeureuxPorosityDiff-125"><a href="#LMAHeureuxPorosityDiff-125"><span class="linenos">125</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">n2</span> <span class="o">=</span> <span class="n">n2</span>
</span><span id="LMAHeureuxPorosityDiff-126"><a href="#LMAHeureuxPorosityDiff-126"><span class="linenos">126</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;(*float*):   </span>
</span><span id="LMAHeureuxPorosityDiff-127"><a href="#LMAHeureuxPorosityDiff-127"><span class="linenos">127</span></a><span class="sd">        Exponent of the reaction term for calcite dissolution.&quot;&quot;&quot;</span>
</span><span id="LMAHeureuxPorosityDiff-128"><a href="#LMAHeureuxPorosityDiff-128"><span class="linenos">128</span></a>        
</span><span id="LMAHeureuxPorosityDiff-129"><a href="#LMAHeureuxPorosityDiff-129"><span class="linenos">129</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">b</span> <span class="o">=</span> <span class="n">b</span>
</span><span id="LMAHeureuxPorosityDiff-130"><a href="#LMAHeureuxPorosityDiff-130"><span class="linenos">130</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;(*float*):   </span>
</span><span id="LMAHeureuxPorosityDiff-131"><a href="#LMAHeureuxPorosityDiff-131"><span class="linenos">131</span></a><span class="sd">        Sediment compressibility (1/(kPa) in SI or 0.1/kBa in cgs).&quot;&quot;&quot;</span>
</span><span id="LMAHeureuxPorosityDiff-132"><a href="#LMAHeureuxPorosityDiff-132"><span class="linenos">132</span></a>        
</span><span id="LMAHeureuxPorosityDiff-133"><a href="#LMAHeureuxPorosityDiff-133"><span class="linenos">133</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">beta</span> <span class="o">=</span> <span class="n">beta</span>
</span><span id="LMAHeureuxPorosityDiff-134"><a href="#LMAHeureuxPorosityDiff-134"><span class="linenos">134</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;(*float*):   </span>
</span><span id="LMAHeureuxPorosityDiff-135"><a href="#LMAHeureuxPorosityDiff-135"><span class="linenos">135</span></a><span class="sd">        Constant in the hydraulic conductivity (cm/a).&quot;&quot;&quot;</span>
</span><span id="LMAHeureuxPorosityDiff-136"><a href="#LMAHeureuxPorosityDiff-136"><span class="linenos">136</span></a>        
</span><span id="LMAHeureuxPorosityDiff-137"><a href="#LMAHeureuxPorosityDiff-137"><span class="linenos">137</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">rhos</span> <span class="o">=</span> <span class="n">rhos</span>
</span><span id="LMAHeureuxPorosityDiff-138"><a href="#LMAHeureuxPorosityDiff-138"><span class="linenos">138</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;(*float*):   </span>
</span><span id="LMAHeureuxPorosityDiff-139"><a href="#LMAHeureuxPorosityDiff-139"><span class="linenos">139</span></a><span class="sd">        Total solid density (g/cm³).&quot;&quot;&quot;</span>
</span><span id="LMAHeureuxPorosityDiff-140"><a href="#LMAHeureuxPorosityDiff-140"><span class="linenos">140</span></a>        
</span><span id="LMAHeureuxPorosityDiff-141"><a href="#LMAHeureuxPorosityDiff-141"><span class="linenos">141</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">rhow</span> <span class="o">=</span> <span class="n">rhow</span>
</span><span id="LMAHeureuxPorosityDiff-142"><a href="#LMAHeureuxPorosityDiff-142"><span class="linenos">142</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;(*float*):   </span>
</span><span id="LMAHeureuxPorosityDiff-143"><a href="#LMAHeureuxPorosityDiff-143"><span class="linenos">143</span></a><span class="sd">        Density of water (g/cm³).&quot;&quot;&quot;</span>
</span><span id="LMAHeureuxPorosityDiff-144"><a href="#LMAHeureuxPorosityDiff-144"><span class="linenos">144</span></a>        
</span><span id="LMAHeureuxPorosityDiff-145"><a href="#LMAHeureuxPorosityDiff-145"><span class="linenos">145</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">rhos0</span> <span class="o">=</span> <span class="n">rhos0</span>
</span><span id="LMAHeureuxPorosityDiff-146"><a href="#LMAHeureuxPorosityDiff-146"><span class="linenos">146</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;(*float*):   </span>
</span><span id="LMAHeureuxPorosityDiff-147"><a href="#LMAHeureuxPorosityDiff-147"><span class="linenos">147</span></a><span class="sd">        Initial value of the total solid density (g/cm³).&quot;&quot;&quot;</span>
</span><span id="LMAHeureuxPorosityDiff-148"><a href="#LMAHeureuxPorosityDiff-148"><span class="linenos">148</span></a>        
</span><span id="LMAHeureuxPorosityDiff-149"><a href="#LMAHeureuxPorosityDiff-149"><span class="linenos">149</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">KA</span> <span class="o">=</span> <span class="n">KA</span>
</span><span id="LMAHeureuxPorosityDiff-150"><a href="#LMAHeureuxPorosityDiff-150"><span class="linenos">150</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;(*float*):   </span>
</span><span id="LMAHeureuxPorosityDiff-151"><a href="#LMAHeureuxPorosityDiff-151"><span class="linenos">151</span></a><span class="sd">        Solubility of aragonite (M²).&quot;&quot;&quot;</span>
</span><span id="LMAHeureuxPorosityDiff-152"><a href="#LMAHeureuxPorosityDiff-152"><span class="linenos">152</span></a>        
</span><span id="LMAHeureuxPorosityDiff-153"><a href="#LMAHeureuxPorosityDiff-153"><span class="linenos">153</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">KC</span> <span class="o">=</span> <span class="n">KC</span>
</span><span id="LMAHeureuxPorosityDiff-154"><a href="#LMAHeureuxPorosityDiff-154"><span class="linenos">154</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;(*float*):   </span>
</span><span id="LMAHeureuxPorosityDiff-155"><a href="#LMAHeureuxPorosityDiff-155"><span class="linenos">155</span></a><span class="sd">        Solubility of calcite (M²).&quot;&quot;&quot;</span>
</span><span id="LMAHeureuxPorosityDiff-156"><a href="#LMAHeureuxPorosityDiff-156"><span class="linenos">156</span></a>        
</span><span id="LMAHeureuxPorosityDiff-157"><a href="#LMAHeureuxPorosityDiff-157"><span class="linenos">157</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">KRat</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">KC</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">KA</span>
</span><span id="LMAHeureuxPorosityDiff-158"><a href="#LMAHeureuxPorosityDiff-158"><span class="linenos">158</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;@private&quot;&quot;&quot;</span>
</span><span id="LMAHeureuxPorosityDiff-159"><a href="#LMAHeureuxPorosityDiff-159"><span class="linenos">159</span></a>        
</span><span id="LMAHeureuxPorosityDiff-160"><a href="#LMAHeureuxPorosityDiff-160"><span class="linenos">160</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">muA</span> <span class="o">=</span> <span class="n">muA</span>
</span><span id="LMAHeureuxPorosityDiff-161"><a href="#LMAHeureuxPorosityDiff-161"><span class="linenos">161</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;(*float*):   </span>
</span><span id="LMAHeureuxPorosityDiff-162"><a href="#LMAHeureuxPorosityDiff-162"><span class="linenos">162</span></a><span class="sd">        Molar mass of calcite and aragonite (g/mol).&quot;&quot;&quot;</span>
</span><span id="LMAHeureuxPorosityDiff-163"><a href="#LMAHeureuxPorosityDiff-163"><span class="linenos">163</span></a>        
</span><span id="LMAHeureuxPorosityDiff-164"><a href="#LMAHeureuxPorosityDiff-164"><span class="linenos">164</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">D0Ca</span> <span class="o">=</span> <span class="n">D0Ca</span>
</span><span id="LMAHeureuxPorosityDiff-165"><a href="#LMAHeureuxPorosityDiff-165"><span class="linenos">165</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;(*float*):   </span>
</span><span id="LMAHeureuxPorosityDiff-166"><a href="#LMAHeureuxPorosityDiff-166"><span class="linenos">166</span></a><span class="sd">        Molecular diffusion coefficient of calcium ions in water (cm²/a).&quot;&quot;&quot;</span>
</span><span id="LMAHeureuxPorosityDiff-167"><a href="#LMAHeureuxPorosityDiff-167"><span class="linenos">167</span></a>        
</span><span id="LMAHeureuxPorosityDiff-168"><a href="#LMAHeureuxPorosityDiff-168"><span class="linenos">168</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">PhiNR</span> <span class="o">=</span> <span class="n">PhiNR</span>
</span><span id="LMAHeureuxPorosityDiff-169"><a href="#LMAHeureuxPorosityDiff-169"><span class="linenos">169</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;(*float*):   </span>
</span><span id="LMAHeureuxPorosityDiff-170"><a href="#LMAHeureuxPorosityDiff-170"><span class="linenos">170</span></a><span class="sd">        Stationary unreactive system porosity (dimensionless).&quot;&quot;&quot;</span>
</span><span id="LMAHeureuxPorosityDiff-171"><a href="#LMAHeureuxPorosityDiff-171"><span class="linenos">171</span></a>        
</span><span id="LMAHeureuxPorosityDiff-172"><a href="#LMAHeureuxPorosityDiff-172"><span class="linenos">172</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">PhiInfty</span> <span class="o">=</span> <span class="n">PhiInfty</span> 
</span><span id="LMAHeureuxPorosityDiff-173"><a href="#LMAHeureuxPorosityDiff-173"><span class="linenos">173</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;(*float*):   </span>
</span><span id="LMAHeureuxPorosityDiff-174"><a href="#LMAHeureuxPorosityDiff-174"><span class="linenos">174</span></a><span class="sd">        Parameter in equation 23 from L&#39;Heureux (dimensionless).&quot;&quot;&quot;</span>
</span><span id="LMAHeureuxPorosityDiff-175"><a href="#LMAHeureuxPorosityDiff-175"><span class="linenos">175</span></a>        
</span><span id="LMAHeureuxPorosityDiff-176"><a href="#LMAHeureuxPorosityDiff-176"><span class="linenos">176</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">Phi0</span> <span class="o">=</span> <span class="n">Phi0</span>
</span><span id="LMAHeureuxPorosityDiff-177"><a href="#LMAHeureuxPorosityDiff-177"><span class="linenos">177</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;@private&quot;&quot;&quot;</span>
</span><span id="LMAHeureuxPorosityDiff-178"><a href="#LMAHeureuxPorosityDiff-178"><span class="linenos">178</span></a>
</span><span id="LMAHeureuxPorosityDiff-179"><a href="#LMAHeureuxPorosityDiff-179"><span class="linenos">179</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">DCa</span> <span class="o">=</span> <span class="n">DCa</span>
</span><span id="LMAHeureuxPorosityDiff-180"><a href="#LMAHeureuxPorosityDiff-180"><span class="linenos">180</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;(*float*):   </span>
</span><span id="LMAHeureuxPorosityDiff-181"><a href="#LMAHeureuxPorosityDiff-181"><span class="linenos">181</span></a><span class="sd">        Molecular diffusion coefficient of calcium ions in the sediment </span>
</span><span id="LMAHeureuxPorosityDiff-182"><a href="#LMAHeureuxPorosityDiff-182"><span class="linenos">182</span></a><span class="sd">        (cm²/a).&quot;&quot;&quot;</span>
</span><span id="LMAHeureuxPorosityDiff-183"><a href="#LMAHeureuxPorosityDiff-183"><span class="linenos">183</span></a>        
</span><span id="LMAHeureuxPorosityDiff-184"><a href="#LMAHeureuxPorosityDiff-184"><span class="linenos">184</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">DCO3</span> <span class="o">=</span> <span class="n">DCO3</span>
</span><span id="LMAHeureuxPorosityDiff-185"><a href="#LMAHeureuxPorosityDiff-185"><span class="linenos">185</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;(*float*):   </span>
</span><span id="LMAHeureuxPorosityDiff-186"><a href="#LMAHeureuxPorosityDiff-186"><span class="linenos">186</span></a><span class="sd">        Molecular diffusion coefficient of carbonate ions in the sediment </span>
</span><span id="LMAHeureuxPorosityDiff-187"><a href="#LMAHeureuxPorosityDiff-187"><span class="linenos">187</span></a><span class="sd">        (cm²/a).&quot;&quot;&quot;</span>
</span><span id="LMAHeureuxPorosityDiff-188"><a href="#LMAHeureuxPorosityDiff-188"><span class="linenos">188</span></a>        
</span><span id="LMAHeureuxPorosityDiff-189"><a href="#LMAHeureuxPorosityDiff-189"><span class="linenos">189</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">not_too_shallow</span> <span class="o">=</span> <span class="n">not_too_shallow</span>
</span><span id="LMAHeureuxPorosityDiff-190"><a href="#LMAHeureuxPorosityDiff-190"><span class="linenos">190</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;(*pde.Scalarfield*):   </span>
</span><span id="LMAHeureuxPorosityDiff-191"><a href="#LMAHeureuxPorosityDiff-191"><span class="linenos">191</span></a><span class="sd">        Heaviside step function that is zero above the upper edge of the </span>
</span><span id="LMAHeureuxPorosityDiff-192"><a href="#LMAHeureuxPorosityDiff-192"><span class="linenos">192</span></a><span class="sd">        aragonite dissolution zone (ADZ) and 1 below that edge.&quot;&quot;&quot;</span>
</span><span id="LMAHeureuxPorosityDiff-193"><a href="#LMAHeureuxPorosityDiff-193"><span class="linenos">193</span></a>        
</span><span id="LMAHeureuxPorosityDiff-194"><a href="#LMAHeureuxPorosityDiff-194"><span class="linenos">194</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">not_too_deep</span> <span class="o">=</span> <span class="n">not_too_deep</span>
</span><span id="LMAHeureuxPorosityDiff-195"><a href="#LMAHeureuxPorosityDiff-195"><span class="linenos">195</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;(*pde.Scalarfield*):   </span>
</span><span id="LMAHeureuxPorosityDiff-196"><a href="#LMAHeureuxPorosityDiff-196"><span class="linenos">196</span></a><span class="sd">        Heaviside step function that is zero below the lower edge of the ADZ</span>
</span><span id="LMAHeureuxPorosityDiff-197"><a href="#LMAHeureuxPorosityDiff-197"><span class="linenos">197</span></a><span class="sd">        and 1 above it.&quot;&quot;&quot;</span>
</span><span id="LMAHeureuxPorosityDiff-198"><a href="#LMAHeureuxPorosityDiff-198"><span class="linenos">198</span></a>        
</span><span id="LMAHeureuxPorosityDiff-199"><a href="#LMAHeureuxPorosityDiff-199"><span class="linenos">199</span></a>
</span><span id="LMAHeureuxPorosityDiff-200"><a href="#LMAHeureuxPorosityDiff-200"><span class="linenos">200</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">g</span> <span class="o">=</span> <span class="mi">100</span> <span class="o">*</span> <span class="mf">9.81</span>
</span><span id="LMAHeureuxPorosityDiff-201"><a href="#LMAHeureuxPorosityDiff-201"><span class="linenos">201</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;@private&quot;&quot;&quot;</span>
</span><span id="LMAHeureuxPorosityDiff-202"><a href="#LMAHeureuxPorosityDiff-202"><span class="linenos">202</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">dCa</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">DCa</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">D0Ca</span>
</span><span id="LMAHeureuxPorosityDiff-203"><a href="#LMAHeureuxPorosityDiff-203"><span class="linenos">203</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;@private&quot;&quot;&quot;</span>
</span><span id="LMAHeureuxPorosityDiff-204"><a href="#LMAHeureuxPorosityDiff-204"><span class="linenos">204</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">dCO3</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">DCO3</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">D0Ca</span>
</span><span id="LMAHeureuxPorosityDiff-205"><a href="#LMAHeureuxPorosityDiff-205"><span class="linenos">205</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;@private&quot;&quot;&quot;</span>
</span><span id="LMAHeureuxPorosityDiff-206"><a href="#LMAHeureuxPorosityDiff-206"><span class="linenos">206</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">delta</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rhos</span> <span class="o">/</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">muA</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">KC</span><span class="p">))</span>
</span><span id="LMAHeureuxPorosityDiff-207"><a href="#LMAHeureuxPorosityDiff-207"><span class="linenos">207</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;@private&quot;&quot;&quot;</span>
</span><span id="LMAHeureuxPorosityDiff-208"><a href="#LMAHeureuxPorosityDiff-208"><span class="linenos">208</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">Da</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">k2</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">Tstar</span>
</span><span id="LMAHeureuxPorosityDiff-209"><a href="#LMAHeureuxPorosityDiff-209"><span class="linenos">209</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;@private&quot;&quot;&quot;</span>
</span><span id="LMAHeureuxPorosityDiff-210"><a href="#LMAHeureuxPorosityDiff-210"><span class="linenos">210</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">lambda_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">k3</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">k2</span>
</span><span id="LMAHeureuxPorosityDiff-211"><a href="#LMAHeureuxPorosityDiff-211"><span class="linenos">211</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;@private&quot;&quot;&quot;</span>
</span><span id="LMAHeureuxPorosityDiff-212"><a href="#LMAHeureuxPorosityDiff-212"><span class="linenos">212</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">auxcon</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">beta</span> <span class="o">/</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">D0Ca</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">b</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">g</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">rhow</span> <span class="o">*</span> \
</span><span id="LMAHeureuxPorosityDiff-213"><a href="#LMAHeureuxPorosityDiff-213"><span class="linenos">213</span></a>                 <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">PhiNR</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">PhiInfty</span><span class="p">))</span>
</span><span id="LMAHeureuxPorosityDiff-214"><a href="#LMAHeureuxPorosityDiff-214"><span class="linenos">214</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;@private&quot;&quot;&quot;</span>
</span><span id="LMAHeureuxPorosityDiff-215"><a href="#LMAHeureuxPorosityDiff-215"><span class="linenos">215</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">rhorat0</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rhos0</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">rhow</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">beta</span> <span class="o">/</span> \
</span><span id="LMAHeureuxPorosityDiff-216"><a href="#LMAHeureuxPorosityDiff-216"><span class="linenos">216</span></a>                  <span class="bp">self</span><span class="o">.</span><span class="n">sedimentationrate</span>
</span><span id="LMAHeureuxPorosityDiff-217"><a href="#LMAHeureuxPorosityDiff-217"><span class="linenos">217</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;@private&quot;&quot;&quot;</span>
</span><span id="LMAHeureuxPorosityDiff-218"><a href="#LMAHeureuxPorosityDiff-218"><span class="linenos">218</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">rhorat</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rhos</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">rhow</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">beta</span> <span class="o">/</span> \
</span><span id="LMAHeureuxPorosityDiff-219"><a href="#LMAHeureuxPorosityDiff-219"><span class="linenos">219</span></a>                 <span class="bp">self</span><span class="o">.</span><span class="n">sedimentationrate</span>
</span><span id="LMAHeureuxPorosityDiff-220"><a href="#LMAHeureuxPorosityDiff-220"><span class="linenos">220</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;@private&quot;&quot;&quot;</span>
</span><span id="LMAHeureuxPorosityDiff-221"><a href="#LMAHeureuxPorosityDiff-221"><span class="linenos">221</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">presum</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">rhorat0</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">Phi0</span> <span class="o">**</span> <span class="mi">3</span> <span class="o">*</span> \
</span><span id="LMAHeureuxPorosityDiff-222"><a href="#LMAHeureuxPorosityDiff-222"><span class="linenos">222</span></a>                 <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="mi">10</span> <span class="o">-</span> <span class="mi">10</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">Phi0</span><span class="p">))</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">Phi0</span><span class="p">)</span>     
</span><span id="LMAHeureuxPorosityDiff-223"><a href="#LMAHeureuxPorosityDiff-223"><span class="linenos">223</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;@private&quot;&quot;&quot;</span>
</span><span id="LMAHeureuxPorosityDiff-224"><a href="#LMAHeureuxPorosityDiff-224"><span class="linenos">224</span></a>
</span><span id="LMAHeureuxPorosityDiff-225"><a href="#LMAHeureuxPorosityDiff-225"><span class="linenos">225</span></a>        <span class="c1"># Fiadeiro-Veronis differentiation involves a coth and a reciprocal, which can</span>
</span><span id="LMAHeureuxPorosityDiff-226"><a href="#LMAHeureuxPorosityDiff-226"><span class="linenos">226</span></a>        <span class="c1"># easily lead to FloatingPointError: overflow encountered in double_scalars.</span>
</span><span id="LMAHeureuxPorosityDiff-227"><a href="#LMAHeureuxPorosityDiff-227"><span class="linenos">227</span></a>        <span class="c1"># To avoid this, better revert to either backwards or central differencing </span>
</span><span id="LMAHeureuxPorosityDiff-228"><a href="#LMAHeureuxPorosityDiff-228"><span class="linenos">228</span></a>        <span class="c1"># the Peclet number is very large or very small.</span>
</span><span id="LMAHeureuxPorosityDiff-229"><a href="#LMAHeureuxPorosityDiff-229"><span class="linenos">229</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">Peclet_min</span> <span class="o">=</span> <span class="mf">1e-2</span>
</span><span id="LMAHeureuxPorosityDiff-230"><a href="#LMAHeureuxPorosityDiff-230"><span class="linenos">230</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;@private&quot;&quot;&quot;</span>
</span><span id="LMAHeureuxPorosityDiff-231"><a href="#LMAHeureuxPorosityDiff-231"><span class="linenos">231</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">Peclet_max</span> <span class="o">=</span> <span class="mi">1</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">Peclet_min</span>
</span><span id="LMAHeureuxPorosityDiff-232"><a href="#LMAHeureuxPorosityDiff-232"><span class="linenos">232</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;@private&quot;&quot;&quot;</span>
</span><span id="LMAHeureuxPorosityDiff-233"><a href="#LMAHeureuxPorosityDiff-233"><span class="linenos">233</span></a>        <span class="c1"># Need this number for Fiadeiro-Veronis differentiation.</span>
</span><span id="LMAHeureuxPorosityDiff-234"><a href="#LMAHeureuxPorosityDiff-234"><span class="linenos">234</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">delta_x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">AragoniteSurface</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">_axes_coords</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> \
</span><span id="LMAHeureuxPorosityDiff-235"><a href="#LMAHeureuxPorosityDiff-235"><span class="linenos">235</span></a>                       <span class="bp">self</span><span class="o">.</span><span class="n">AragoniteSurface</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">_axes_coords</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
</span><span id="LMAHeureuxPorosityDiff-236"><a href="#LMAHeureuxPorosityDiff-236"><span class="linenos">236</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;@private&quot;&quot;&quot;</span>
</span><span id="LMAHeureuxPorosityDiff-237"><a href="#LMAHeureuxPorosityDiff-237"><span class="linenos">237</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">PhiIni</span> <span class="o">=</span> <span class="n">PhiIni</span>
</span><span id="LMAHeureuxPorosityDiff-238"><a href="#LMAHeureuxPorosityDiff-238"><span class="linenos">238</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;**PhiIni** (*float*):   </span>
</span><span id="LMAHeureuxPorosityDiff-239"><a href="#LMAHeureuxPorosityDiff-239"><span class="linenos">239</span></a><span class="sd">        Initial homogeneous porosity (dimensionless)&quot;&quot;&quot;</span>
</span><span id="LMAHeureuxPorosityDiff-240"><a href="#LMAHeureuxPorosityDiff-240"><span class="linenos">240</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">F_fixed</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="mi">10</span> <span class="o">-</span> <span class="mi">10</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">PhiIni</span><span class="p">)</span>
</span><span id="LMAHeureuxPorosityDiff-241"><a href="#LMAHeureuxPorosityDiff-241"><span class="linenos">241</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;@private&quot;&quot;&quot;</span>
</span><span id="LMAHeureuxPorosityDiff-242"><a href="#LMAHeureuxPorosityDiff-242"><span class="linenos">242</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">dPhi_fixed</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">auxcon</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">F_fixed</span> <span class="o">*</span>\
</span><span id="LMAHeureuxPorosityDiff-243"><a href="#LMAHeureuxPorosityDiff-243"><span class="linenos">243</span></a>                          <span class="bp">self</span><span class="o">.</span><span class="n">PhiIni</span> <span class="o">**</span> <span class="mi">3</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">PhiIni</span><span class="p">)</span> 
</span><span id="LMAHeureuxPorosityDiff-244"><a href="#LMAHeureuxPorosityDiff-244"><span class="linenos">244</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;@private&quot;&quot;&quot;</span>
</span><span id="LMAHeureuxPorosityDiff-245"><a href="#LMAHeureuxPorosityDiff-245"><span class="linenos">245</span></a>                          
</span><span id="LMAHeureuxPorosityDiff-246"><a href="#LMAHeureuxPorosityDiff-246"><span class="linenos">246</span></a>
</span><span id="LMAHeureuxPorosityDiff-247"><a href="#LMAHeureuxPorosityDiff-247"><span class="linenos">247</span></a>    <span class="k">def</span> <span class="nf">get_state</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">AragoniteSurface</span><span class="p">,</span> <span class="n">CalciteSurface</span><span class="p">,</span> <span class="n">CaSurface</span><span class="p">,</span> <span class="n">CO3Surface</span><span class="p">,</span> 
</span><span id="LMAHeureuxPorosityDiff-248"><a href="#LMAHeureuxPorosityDiff-248"><span class="linenos">248</span></a>                  <span class="n">PorSurface</span><span class="p">):</span>
</span><span id="LMAHeureuxPorosityDiff-249"><a href="#LMAHeureuxPorosityDiff-249"><span class="linenos">249</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;@private&quot;&quot;&quot;</span>
</span><span id="LMAHeureuxPorosityDiff-250"><a href="#LMAHeureuxPorosityDiff-250"><span class="linenos">250</span></a>        <span class="c1"># Return initial state and register forward and backward difference</span>
</span><span id="LMAHeureuxPorosityDiff-251"><a href="#LMAHeureuxPorosityDiff-251"><span class="linenos">251</span></a>        <span class="c1"># operators. </span>
</span><span id="LMAHeureuxPorosityDiff-252"><a href="#LMAHeureuxPorosityDiff-252"><span class="linenos">252</span></a>        <span class="n">AragoniteSurface</span><span class="o">.</span><span class="n">label</span> <span class="o">=</span> <span class="s2">&quot;ARA&quot;</span>
</span><span id="LMAHeureuxPorosityDiff-253"><a href="#LMAHeureuxPorosityDiff-253"><span class="linenos">253</span></a>        <span class="n">CalciteSurface</span><span class="o">.</span><span class="n">label</span> <span class="o">=</span> <span class="s2">&quot;CAL&quot;</span>
</span><span id="LMAHeureuxPorosityDiff-254"><a href="#LMAHeureuxPorosityDiff-254"><span class="linenos">254</span></a>        <span class="n">CaSurface</span><span class="o">.</span><span class="n">label</span> <span class="o">=</span> <span class="s2">&quot;Ca&quot;</span>
</span><span id="LMAHeureuxPorosityDiff-255"><a href="#LMAHeureuxPorosityDiff-255"><span class="linenos">255</span></a>        <span class="n">CO3Surface</span><span class="o">.</span><span class="n">label</span> <span class="o">=</span> <span class="s2">&quot;CO3&quot;</span>
</span><span id="LMAHeureuxPorosityDiff-256"><a href="#LMAHeureuxPorosityDiff-256"><span class="linenos">256</span></a>        <span class="n">PorSurface</span><span class="o">.</span><span class="n">label</span> <span class="o">=</span> <span class="s2">&quot;Po&quot;</span>
</span><span id="LMAHeureuxPorosityDiff-257"><a href="#LMAHeureuxPorosityDiff-257"><span class="linenos">257</span></a>
</span><span id="LMAHeureuxPorosityDiff-258"><a href="#LMAHeureuxPorosityDiff-258"><span class="linenos">258</span></a>        <span class="k">return</span> <span class="n">FieldCollection</span><span class="p">([</span><span class="n">AragoniteSurface</span><span class="p">,</span> <span class="n">CalciteSurface</span><span class="p">,</span> <span class="n">CaSurface</span><span class="p">,</span> 
</span><span id="LMAHeureuxPorosityDiff-259"><a href="#LMAHeureuxPorosityDiff-259"><span class="linenos">259</span></a>                                <span class="n">CO3Surface</span><span class="p">,</span> <span class="n">PorSurface</span><span class="p">])</span>
</span><span id="LMAHeureuxPorosityDiff-260"><a href="#LMAHeureuxPorosityDiff-260"><span class="linenos">260</span></a>
</span><span id="LMAHeureuxPorosityDiff-261"><a href="#LMAHeureuxPorosityDiff-261"><span class="linenos">261</span></a>
</span><span id="LMAHeureuxPorosityDiff-262"><a href="#LMAHeureuxPorosityDiff-262"><span class="linenos">262</span></a>    <span class="k">def</span> <span class="nf">track_U_at_bottom</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">state</span><span class="p">,</span> <span class="n">t</span><span class="p">):</span>
</span><span id="LMAHeureuxPorosityDiff-263"><a href="#LMAHeureuxPorosityDiff-263"><span class="linenos">263</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;For recording U, the solid matrix advection field.</span>
</span><span id="LMAHeureuxPorosityDiff-264"><a href="#LMAHeureuxPorosityDiff-264"><span class="linenos">264</span></a><span class="sd">        Although U is computed as part of the integration, for recording it,</span>
</span><span id="LMAHeureuxPorosityDiff-265"><a href="#LMAHeureuxPorosityDiff-265"><span class="linenos">265</span></a><span class="sd">        we need to rederive it from the porosity at the bottom of the depth </span>
</span><span id="LMAHeureuxPorosityDiff-266"><a href="#LMAHeureuxPorosityDiff-266"><span class="linenos">266</span></a><span class="sd">        grid.</span>
</span><span id="LMAHeureuxPorosityDiff-267"><a href="#LMAHeureuxPorosityDiff-267"><span class="linenos">267</span></a><span class="sd">          &quot;&quot;&quot;</span>
</span><span id="LMAHeureuxPorosityDiff-268"><a href="#LMAHeureuxPorosityDiff-268"><span class="linenos">268</span></a>        <span class="c1"># First, extract the porosity at the bottom of the system.</span>
</span><span id="LMAHeureuxPorosityDiff-269"><a href="#LMAHeureuxPorosityDiff-269"><span class="linenos">269</span></a>        <span class="c1"># The derived quantities will then also be at the bottom of the system.</span>
</span><span id="LMAHeureuxPorosityDiff-270"><a href="#LMAHeureuxPorosityDiff-270"><span class="linenos">270</span></a>        <span class="n">Phi</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="mi">4</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</span><span id="LMAHeureuxPorosityDiff-271"><a href="#LMAHeureuxPorosityDiff-271"><span class="linenos">271</span></a>        <span class="n">F</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="mi">10</span> <span class="o">-</span> <span class="mi">10</span> <span class="o">/</span> <span class="n">Phi</span><span class="p">)</span>
</span><span id="LMAHeureuxPorosityDiff-272"><a href="#LMAHeureuxPorosityDiff-272"><span class="linenos">272</span></a>        <span class="n">one_minus_Phi</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">Phi</span>
</span><span id="LMAHeureuxPorosityDiff-273"><a href="#LMAHeureuxPorosityDiff-273"><span class="linenos">273</span></a>        <span class="n">U_bottom</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">presum</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">rhorat</span> <span class="o">*</span> <span class="n">Phi</span> <span class="o">**</span> <span class="mi">3</span> <span class="o">*</span> <span class="n">F</span> <span class="o">/</span><span class="n">one_minus_Phi</span>
</span><span id="LMAHeureuxPorosityDiff-274"><a href="#LMAHeureuxPorosityDiff-274"><span class="linenos">274</span></a>        <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;U at bottom&quot;</span><span class="p">:</span> <span class="n">U_bottom</span><span class="p">}</span>
</span><span id="LMAHeureuxPorosityDiff-275"><a href="#LMAHeureuxPorosityDiff-275"><span class="linenos">275</span></a>
</span><span id="LMAHeureuxPorosityDiff-276"><a href="#LMAHeureuxPorosityDiff-276"><span class="linenos">276</span></a>    <span class="nd">@staticmethod</span>
</span><span id="LMAHeureuxPorosityDiff-277"><a href="#LMAHeureuxPorosityDiff-277"><span class="linenos">277</span></a>    <span class="nd">@njit</span>
</span><span id="LMAHeureuxPorosityDiff-278"><a href="#LMAHeureuxPorosityDiff-278"><span class="linenos">278</span></a>    <span class="k">def</span> <span class="nf">calculate_sigma</span><span class="p">(</span><span class="n">Peclet</span><span class="p">,</span> <span class="n">W_data</span><span class="p">,</span> <span class="n">Peclet_min</span><span class="p">,</span> <span class="n">Peclet_max</span><span class="p">):</span>
</span><span id="LMAHeureuxPorosityDiff-279"><a href="#LMAHeureuxPorosityDiff-279"><span class="linenos">279</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot; Calculate sigma following formula 8.73 from Boudreau:</span>
</span><span id="LMAHeureuxPorosityDiff-280"><a href="#LMAHeureuxPorosityDiff-280"><span class="linenos">280</span></a><span class="sd">        &#39;Diagenetic Models and their implementation&#39;.</span>
</span><span id="LMAHeureuxPorosityDiff-281"><a href="#LMAHeureuxPorosityDiff-281"><span class="linenos">281</span></a>
</span><span id="LMAHeureuxPorosityDiff-282"><a href="#LMAHeureuxPorosityDiff-282"><span class="linenos">282</span></a><span class="sd">        Args:</span>
</span><span id="LMAHeureuxPorosityDiff-283"><a href="#LMAHeureuxPorosityDiff-283"><span class="linenos">283</span></a><span class="sd">        -  **Peclet** (*ndarray(dtype=float, ndim=1)*):</span>
</span><span id="LMAHeureuxPorosityDiff-284"><a href="#LMAHeureuxPorosityDiff-284"><span class="linenos">284</span></a><span class="sd">           Array along depth of the Peclet numbers.</span>
</span><span id="LMAHeureuxPorosityDiff-285"><a href="#LMAHeureuxPorosityDiff-285"><span class="linenos">285</span></a><span class="sd">        -  **W-data** (*ndarray(dtype=float, ndim=1)*):</span>
</span><span id="LMAHeureuxPorosityDiff-286"><a href="#LMAHeureuxPorosityDiff-286"><span class="linenos">286</span></a><span class="sd">           Array along depth of the velocity of the pore water </span>
</span><span id="LMAHeureuxPorosityDiff-287"><a href="#LMAHeureuxPorosityDiff-287"><span class="linenos">287</span></a><span class="sd">           (counted positive downwards)</span>
</span><span id="LMAHeureuxPorosityDiff-288"><a href="#LMAHeureuxPorosityDiff-288"><span class="linenos">288</span></a><span class="sd">        -  **Peclet_min** (*float*):</span>
</span><span id="LMAHeureuxPorosityDiff-289"><a href="#LMAHeureuxPorosityDiff-289"><span class="linenos">289</span></a><span class="sd">           Lower limit for calculating 1/tanh(Peclet)</span>
</span><span id="LMAHeureuxPorosityDiff-290"><a href="#LMAHeureuxPorosityDiff-290"><span class="linenos">290</span></a><span class="sd">        -  **Peclet_max** (*float*):</span>
</span><span id="LMAHeureuxPorosityDiff-291"><a href="#LMAHeureuxPorosityDiff-291"><span class="linenos">291</span></a><span class="sd">           Upper limit for calculating 1/tanh(Peclet)</span>
</span><span id="LMAHeureuxPorosityDiff-292"><a href="#LMAHeureuxPorosityDiff-292"><span class="linenos">292</span></a>
</span><span id="LMAHeureuxPorosityDiff-293"><a href="#LMAHeureuxPorosityDiff-293"><span class="linenos">293</span></a><span class="sd">        Returns</span>
</span><span id="LMAHeureuxPorosityDiff-294"><a href="#LMAHeureuxPorosityDiff-294"><span class="linenos">294</span></a><span class="sd">        -  **sigma** (*ndarray(dtype=float, ndim=1)*):</span>
</span><span id="LMAHeureuxPorosityDiff-295"><a href="#LMAHeureuxPorosityDiff-295"><span class="linenos">295</span></a><span class="sd">           Array along depth with sigma values</span>
</span><span id="LMAHeureuxPorosityDiff-296"><a href="#LMAHeureuxPorosityDiff-296"><span class="linenos">296</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="LMAHeureuxPorosityDiff-297"><a href="#LMAHeureuxPorosityDiff-297"><span class="linenos">297</span></a>        <span class="n">sigma</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="n">Peclet</span><span class="o">.</span><span class="n">size</span><span class="p">)</span>
</span><span id="LMAHeureuxPorosityDiff-298"><a href="#LMAHeureuxPorosityDiff-298"><span class="linenos">298</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">sigma</span><span class="o">.</span><span class="n">size</span><span class="p">):</span>
</span><span id="LMAHeureuxPorosityDiff-299"><a href="#LMAHeureuxPorosityDiff-299"><span class="linenos">299</span></a>            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">Peclet</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">&lt;</span> <span class="n">Peclet_min</span><span class="p">:</span>
</span><span id="LMAHeureuxPorosityDiff-300"><a href="#LMAHeureuxPorosityDiff-300"><span class="linenos">300</span></a>                <span class="n">sigma</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="LMAHeureuxPorosityDiff-301"><a href="#LMAHeureuxPorosityDiff-301"><span class="linenos">301</span></a>            <span class="k">elif</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">Peclet</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">&gt;</span> <span class="n">Peclet_max</span><span class="p">:</span>
</span><span id="LMAHeureuxPorosityDiff-302"><a href="#LMAHeureuxPorosityDiff-302"><span class="linenos">302</span></a>                <span class="n">sigma</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sign</span><span class="p">(</span><span class="n">W_data</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
</span><span id="LMAHeureuxPorosityDiff-303"><a href="#LMAHeureuxPorosityDiff-303"><span class="linenos">303</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="LMAHeureuxPorosityDiff-304"><a href="#LMAHeureuxPorosityDiff-304"><span class="linenos">304</span></a>                <span class="n">sigma</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cosh</span><span class="p">(</span><span class="n">Peclet</span><span class="p">[</span><span class="n">i</span><span class="p">])</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sinh</span><span class="p">(</span><span class="n">Peclet</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">-</span> \
</span><span id="LMAHeureuxPorosityDiff-305"><a href="#LMAHeureuxPorosityDiff-305"><span class="linenos">305</span></a>                    <span class="mi">1</span><span class="o">/</span><span class="n">Peclet</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
</span><span id="LMAHeureuxPorosityDiff-306"><a href="#LMAHeureuxPorosityDiff-306"><span class="linenos">306</span></a>        <span class="k">return</span> <span class="n">sigma</span>
</span><span id="LMAHeureuxPorosityDiff-307"><a href="#LMAHeureuxPorosityDiff-307"><span class="linenos">307</span></a>
</span><span id="LMAHeureuxPorosityDiff-308"><a href="#LMAHeureuxPorosityDiff-308"><span class="linenos">308</span></a>    <span class="k">def</span> <span class="nf">evolution_rate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">state</span><span class="p">,</span> <span class="n">t</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
</span><span id="LMAHeureuxPorosityDiff-309"><a href="#LMAHeureuxPorosityDiff-309"><span class="linenos">309</span></a>        <span class="n">CA</span><span class="p">,</span> <span class="n">CC</span><span class="p">,</span> <span class="n">cCa</span><span class="p">,</span> <span class="n">cCO3</span><span class="p">,</span> <span class="n">Phi</span> <span class="o">=</span> <span class="n">state</span>   
</span><span id="LMAHeureuxPorosityDiff-310"><a href="#LMAHeureuxPorosityDiff-310"><span class="linenos">310</span></a>
</span><span id="LMAHeureuxPorosityDiff-311"><a href="#LMAHeureuxPorosityDiff-311"><span class="linenos">311</span></a>        <span class="n">two_factors</span> <span class="o">=</span> <span class="n">cCa</span> <span class="o">*</span> <span class="n">cCO3</span>
</span><span id="LMAHeureuxPorosityDiff-312"><a href="#LMAHeureuxPorosityDiff-312"><span class="linenos">312</span></a>        <span class="n">two_factors_upp_lim</span> <span class="o">=</span> <span class="n">two_factors</span><span class="o">.</span><span class="n">to_scalar</span><span class="p">(</span><span class="k">lambda</span> <span class="n">f</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">fmin</span><span class="p">(</span><span class="n">f</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span>
</span><span id="LMAHeureuxPorosityDiff-313"><a href="#LMAHeureuxPorosityDiff-313"><span class="linenos">313</span></a>        <span class="n">two_factors_low_lim</span> <span class="o">=</span> <span class="n">two_factors</span><span class="o">.</span><span class="n">to_scalar</span><span class="p">(</span><span class="k">lambda</span> <span class="n">f</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">fmax</span><span class="p">(</span><span class="n">f</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span>
</span><span id="LMAHeureuxPorosityDiff-314"><a href="#LMAHeureuxPorosityDiff-314"><span class="linenos">314</span></a>
</span><span id="LMAHeureuxPorosityDiff-315"><a href="#LMAHeureuxPorosityDiff-315"><span class="linenos">315</span></a>        <span class="n">three_factors</span> <span class="o">=</span> <span class="n">two_factors</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">KRat</span>
</span><span id="LMAHeureuxPorosityDiff-316"><a href="#LMAHeureuxPorosityDiff-316"><span class="linenos">316</span></a>        <span class="n">three_factors_upp_lim</span> <span class="o">=</span> <span class="n">three_factors</span><span class="o">.</span><span class="n">to_scalar</span><span class="p">(</span><span class="k">lambda</span> <span class="n">f</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">fmin</span><span class="p">(</span><span class="n">f</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span>
</span><span id="LMAHeureuxPorosityDiff-317"><a href="#LMAHeureuxPorosityDiff-317"><span class="linenos">317</span></a>        <span class="n">three_factors_low_lim</span> <span class="o">=</span> <span class="n">three_factors</span><span class="o">.</span><span class="n">to_scalar</span><span class="p">(</span><span class="k">lambda</span> <span class="n">f</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">fmax</span><span class="p">(</span><span class="n">f</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span>
</span><span id="LMAHeureuxPorosityDiff-318"><a href="#LMAHeureuxPorosityDiff-318"><span class="linenos">318</span></a>
</span><span id="LMAHeureuxPorosityDiff-319"><a href="#LMAHeureuxPorosityDiff-319"><span class="linenos">319</span></a>        <span class="n">coA</span> <span class="o">=</span> <span class="n">CA</span> <span class="o">*</span> <span class="p">(((</span><span class="mi">1</span> <span class="o">-</span> <span class="n">three_factors_upp_lim</span><span class="p">)</span> <span class="o">**</span> <span class="bp">self</span><span class="o">.</span><span class="n">m2</span><span class="p">)</span> <span class="o">*</span> \
</span><span id="LMAHeureuxPorosityDiff-320"><a href="#LMAHeureuxPorosityDiff-320"><span class="linenos">320</span></a>                    <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">not_too_deep</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">not_too_shallow</span><span class="p">)</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">nu1</span> <span class="o">*</span> \
</span><span id="LMAHeureuxPorosityDiff-321"><a href="#LMAHeureuxPorosityDiff-321"><span class="linenos">321</span></a>                    <span class="p">(</span><span class="n">three_factors_low_lim</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">**</span> <span class="bp">self</span><span class="o">.</span><span class="n">m1</span><span class="p">)</span>
</span><span id="LMAHeureuxPorosityDiff-322"><a href="#LMAHeureuxPorosityDiff-322"><span class="linenos">322</span></a> 
</span><span id="LMAHeureuxPorosityDiff-323"><a href="#LMAHeureuxPorosityDiff-323"><span class="linenos">323</span></a>        <span class="n">coC</span> <span class="o">=</span> <span class="n">CC</span> <span class="o">*</span> <span class="p">(((</span><span class="n">two_factors_low_lim</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">**</span> <span class="bp">self</span><span class="o">.</span><span class="n">n1</span><span class="p">)</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">nu2</span> <span class="o">*</span> \
</span><span id="LMAHeureuxPorosityDiff-324"><a href="#LMAHeureuxPorosityDiff-324"><span class="linenos">324</span></a>                    <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">two_factors_upp_lim</span><span class="p">)</span> <span class="o">**</span> <span class="bp">self</span><span class="o">.</span><span class="n">n2</span><span class="p">)</span>
</span><span id="LMAHeureuxPorosityDiff-325"><a href="#LMAHeureuxPorosityDiff-325"><span class="linenos">325</span></a>
</span><span id="LMAHeureuxPorosityDiff-326"><a href="#LMAHeureuxPorosityDiff-326"><span class="linenos">326</span></a>        <span class="n">F</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="mi">10</span> <span class="o">-</span> <span class="mi">10</span> <span class="o">/</span> <span class="n">Phi</span><span class="p">)</span>
</span><span id="LMAHeureuxPorosityDiff-327"><a href="#LMAHeureuxPorosityDiff-327"><span class="linenos">327</span></a>        <span class="n">one_minus_Phi</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">Phi</span>
</span><span id="LMAHeureuxPorosityDiff-328"><a href="#LMAHeureuxPorosityDiff-328"><span class="linenos">328</span></a>        <span class="n">U</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">presum</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">rhorat</span> <span class="o">*</span> <span class="n">Phi</span> <span class="o">**</span> <span class="mi">3</span> <span class="o">*</span> <span class="n">F</span> <span class="o">/</span><span class="n">one_minus_Phi</span>
</span><span id="LMAHeureuxPorosityDiff-329"><a href="#LMAHeureuxPorosityDiff-329"><span class="linenos">329</span></a>
</span><span id="LMAHeureuxPorosityDiff-330"><a href="#LMAHeureuxPorosityDiff-330"><span class="linenos">330</span></a>        <span class="c1"># Choose either forward or backward differencing for CA and CC</span>
</span><span id="LMAHeureuxPorosityDiff-331"><a href="#LMAHeureuxPorosityDiff-331"><span class="linenos">331</span></a>        <span class="c1"># depending on the sign of U</span>
</span><span id="LMAHeureuxPorosityDiff-332"><a href="#LMAHeureuxPorosityDiff-332"><span class="linenos">332</span></a>
</span><span id="LMAHeureuxPorosityDiff-333"><a href="#LMAHeureuxPorosityDiff-333"><span class="linenos">333</span></a>        <span class="n">CA_grad_back</span> <span class="o">=</span> <span class="n">CA</span><span class="o">.</span><span class="n">apply_operator</span><span class="p">(</span><span class="s2">&quot;grad_back&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">bc_CA</span><span class="p">)</span>
</span><span id="LMAHeureuxPorosityDiff-334"><a href="#LMAHeureuxPorosityDiff-334"><span class="linenos">334</span></a>        <span class="n">CA_grad_forw</span> <span class="o">=</span> <span class="n">CA</span><span class="o">.</span><span class="n">apply_operator</span><span class="p">(</span><span class="s2">&quot;grad_forw&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">bc_CA</span><span class="p">)</span>
</span><span id="LMAHeureuxPorosityDiff-335"><a href="#LMAHeureuxPorosityDiff-335"><span class="linenos">335</span></a>        <span class="n">CA_grad</span> <span class="o">=</span> <span class="n">ScalarField</span><span class="p">(</span><span class="n">state</span><span class="o">.</span><span class="n">grid</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">U</span><span class="o">.</span><span class="n">data</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">,</span> <span class="n">CA_grad_back</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> \
</span><span id="LMAHeureuxPorosityDiff-336"><a href="#LMAHeureuxPorosityDiff-336"><span class="linenos">336</span></a>            <span class="n">CA_grad_forw</span><span class="o">.</span><span class="n">data</span><span class="p">))</span>
</span><span id="LMAHeureuxPorosityDiff-337"><a href="#LMAHeureuxPorosityDiff-337"><span class="linenos">337</span></a>
</span><span id="LMAHeureuxPorosityDiff-338"><a href="#LMAHeureuxPorosityDiff-338"><span class="linenos">338</span></a>        <span class="n">CC_grad_back</span> <span class="o">=</span> <span class="n">CC</span><span class="o">.</span><span class="n">apply_operator</span><span class="p">(</span><span class="s2">&quot;grad_back&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">bc_CC</span><span class="p">)</span>
</span><span id="LMAHeureuxPorosityDiff-339"><a href="#LMAHeureuxPorosityDiff-339"><span class="linenos">339</span></a>        <span class="n">CC_grad_forw</span> <span class="o">=</span> <span class="n">CC</span><span class="o">.</span><span class="n">apply_operator</span><span class="p">(</span><span class="s2">&quot;grad_forw&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">bc_CC</span><span class="p">)</span>
</span><span id="LMAHeureuxPorosityDiff-340"><a href="#LMAHeureuxPorosityDiff-340"><span class="linenos">340</span></a>        <span class="n">CC_grad</span> <span class="o">=</span> <span class="n">ScalarField</span><span class="p">(</span><span class="n">state</span><span class="o">.</span><span class="n">grid</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">U</span><span class="o">.</span><span class="n">data</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">,</span> <span class="n">CC_grad_back</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> \
</span><span id="LMAHeureuxPorosityDiff-341"><a href="#LMAHeureuxPorosityDiff-341"><span class="linenos">341</span></a>            <span class="n">CC_grad_forw</span><span class="o">.</span><span class="n">data</span><span class="p">))</span>
</span><span id="LMAHeureuxPorosityDiff-342"><a href="#LMAHeureuxPorosityDiff-342"><span class="linenos">342</span></a>
</span><span id="LMAHeureuxPorosityDiff-343"><a href="#LMAHeureuxPorosityDiff-343"><span class="linenos">343</span></a>        <span class="n">W</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">presum</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">rhorat</span> <span class="o">*</span> <span class="n">Phi</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">F</span>
</span><span id="LMAHeureuxPorosityDiff-344"><a href="#LMAHeureuxPorosityDiff-344"><span class="linenos">344</span></a>        
</span><span id="LMAHeureuxPorosityDiff-345"><a href="#LMAHeureuxPorosityDiff-345"><span class="linenos">345</span></a>        <span class="n">dCA_dt</span> <span class="o">=</span> <span class="o">-</span> <span class="n">U</span> <span class="o">*</span> <span class="n">CA_grad</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">Da</span> <span class="o">*</span> <span class="p">((</span><span class="mi">1</span> <span class="o">-</span> <span class="n">CA</span><span class="p">)</span> \
</span><span id="LMAHeureuxPorosityDiff-346"><a href="#LMAHeureuxPorosityDiff-346"><span class="linenos">346</span></a>                 <span class="o">*</span> <span class="n">coA</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">lambda_</span> <span class="o">*</span> <span class="n">CA</span> <span class="o">*</span> <span class="n">coC</span><span class="p">)</span>
</span><span id="LMAHeureuxPorosityDiff-347"><a href="#LMAHeureuxPorosityDiff-347"><span class="linenos">347</span></a>
</span><span id="LMAHeureuxPorosityDiff-348"><a href="#LMAHeureuxPorosityDiff-348"><span class="linenos">348</span></a>        <span class="n">dCC_dt</span> <span class="o">=</span> <span class="o">-</span> <span class="n">U</span> <span class="o">*</span> <span class="n">CC_grad</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">Da</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lambda_</span> \
</span><span id="LMAHeureuxPorosityDiff-349"><a href="#LMAHeureuxPorosityDiff-349"><span class="linenos">349</span></a>                 <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">CC</span><span class="p">)</span> <span class="o">*</span> <span class="n">coC</span> <span class="o">+</span> <span class="n">CC</span> <span class="o">*</span> <span class="n">coA</span><span class="p">)</span>
</span><span id="LMAHeureuxPorosityDiff-350"><a href="#LMAHeureuxPorosityDiff-350"><span class="linenos">350</span></a>
</span><span id="LMAHeureuxPorosityDiff-351"><a href="#LMAHeureuxPorosityDiff-351"><span class="linenos">351</span></a>        <span class="c1"># Implementing equation 6 from l&#39;Heureux.</span>
</span><span id="LMAHeureuxPorosityDiff-352"><a href="#LMAHeureuxPorosityDiff-352"><span class="linenos">352</span></a>        <span class="n">denominator</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">Phi</span><span class="p">)</span>
</span><span id="LMAHeureuxPorosityDiff-353"><a href="#LMAHeureuxPorosityDiff-353"><span class="linenos">353</span></a>
</span><span id="LMAHeureuxPorosityDiff-354"><a href="#LMAHeureuxPorosityDiff-354"><span class="linenos">354</span></a>        <span class="c1"># Fiadeiro-Veronis scheme for equations 42 and 43</span>
</span><span id="LMAHeureuxPorosityDiff-355"><a href="#LMAHeureuxPorosityDiff-355"><span class="linenos">355</span></a>        <span class="c1"># from l&#39;Heureux. </span>
</span><span id="LMAHeureuxPorosityDiff-356"><a href="#LMAHeureuxPorosityDiff-356"><span class="linenos">356</span></a>        <span class="n">common_Peclet</span>  <span class="o">=</span> <span class="n">W</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">delta_x</span> <span class="o">/</span> <span class="mf">2.</span> 
</span><span id="LMAHeureuxPorosityDiff-357"><a href="#LMAHeureuxPorosityDiff-357"><span class="linenos">357</span></a>        <span class="n">Peclet_cCa</span> <span class="o">=</span>  <span class="n">common_Peclet</span> <span class="o">*</span> <span class="n">denominator</span><span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">dCa</span>       
</span><span id="LMAHeureuxPorosityDiff-358"><a href="#LMAHeureuxPorosityDiff-358"><span class="linenos">358</span></a>        <span class="n">sigma_cCa_data</span> <span class="o">=</span> <span class="n">LMAHeureuxPorosityDiff</span><span class="o">.</span><span class="n">calculate_sigma</span><span class="p">(</span>\
</span><span id="LMAHeureuxPorosityDiff-359"><a href="#LMAHeureuxPorosityDiff-359"><span class="linenos">359</span></a>            <span class="n">Peclet_cCa</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">W</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Peclet_min</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Peclet_max</span><span class="p">)</span>
</span><span id="LMAHeureuxPorosityDiff-360"><a href="#LMAHeureuxPorosityDiff-360"><span class="linenos">360</span></a>        <span class="n">sigma_cCa</span> <span class="o">=</span> <span class="n">ScalarField</span><span class="p">(</span><span class="n">state</span><span class="o">.</span><span class="n">grid</span><span class="p">,</span> <span class="n">sigma_cCa_data</span><span class="p">)</span>
</span><span id="LMAHeureuxPorosityDiff-361"><a href="#LMAHeureuxPorosityDiff-361"><span class="linenos">361</span></a>
</span><span id="LMAHeureuxPorosityDiff-362"><a href="#LMAHeureuxPorosityDiff-362"><span class="linenos">362</span></a>        <span class="n">Peclet_cCO3</span> <span class="o">=</span> <span class="n">common_Peclet</span> <span class="o">*</span> <span class="n">denominator</span><span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">dCO3</span>      
</span><span id="LMAHeureuxPorosityDiff-363"><a href="#LMAHeureuxPorosityDiff-363"><span class="linenos">363</span></a>        <span class="n">sigma_cCO3_data</span> <span class="o">=</span> <span class="n">LMAHeureuxPorosityDiff</span><span class="o">.</span><span class="n">calculate_sigma</span><span class="p">(</span>\
</span><span id="LMAHeureuxPorosityDiff-364"><a href="#LMAHeureuxPorosityDiff-364"><span class="linenos">364</span></a>            <span class="n">Peclet_cCO3</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">W</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Peclet_min</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Peclet_max</span><span class="p">)</span>
</span><span id="LMAHeureuxPorosityDiff-365"><a href="#LMAHeureuxPorosityDiff-365"><span class="linenos">365</span></a>        <span class="n">sigma_cCO3</span> <span class="o">=</span> <span class="n">ScalarField</span><span class="p">(</span><span class="n">state</span><span class="o">.</span><span class="n">grid</span><span class="p">,</span> <span class="n">sigma_cCO3_data</span><span class="p">)</span>
</span><span id="LMAHeureuxPorosityDiff-366"><a href="#LMAHeureuxPorosityDiff-366"><span class="linenos">366</span></a>
</span><span id="LMAHeureuxPorosityDiff-367"><a href="#LMAHeureuxPorosityDiff-367"><span class="linenos">367</span></a>        <span class="c1"># dPhi = self.auxcon * F * (Phi ** 3) / one_minus_Phi</span>
</span><span id="LMAHeureuxPorosityDiff-368"><a href="#LMAHeureuxPorosityDiff-368"><span class="linenos">368</span></a>        <span class="n">dPhi</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dPhi_fixed</span>
</span><span id="LMAHeureuxPorosityDiff-369"><a href="#LMAHeureuxPorosityDiff-369"><span class="linenos">369</span></a>
</span><span id="LMAHeureuxPorosityDiff-370"><a href="#LMAHeureuxPorosityDiff-370"><span class="linenos">370</span></a>        <span class="n">Peclet_Phi</span> <span class="o">=</span> <span class="n">common_Peclet</span> <span class="o">/</span> <span class="n">dPhi</span>
</span><span id="LMAHeureuxPorosityDiff-371"><a href="#LMAHeureuxPorosityDiff-371"><span class="linenos">371</span></a>        <span class="n">sigma_Phi_data</span> <span class="o">=</span> <span class="n">LMAHeureuxPorosityDiff</span><span class="o">.</span><span class="n">calculate_sigma</span><span class="p">(</span>\
</span><span id="LMAHeureuxPorosityDiff-372"><a href="#LMAHeureuxPorosityDiff-372"><span class="linenos">372</span></a>            <span class="n">Peclet_Phi</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">W</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Peclet_min</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Peclet_max</span><span class="p">)</span>
</span><span id="LMAHeureuxPorosityDiff-373"><a href="#LMAHeureuxPorosityDiff-373"><span class="linenos">373</span></a>        <span class="n">sigma_Phi</span> <span class="o">=</span> <span class="n">ScalarField</span><span class="p">(</span><span class="n">state</span><span class="o">.</span><span class="n">grid</span><span class="p">,</span> <span class="n">sigma_Phi_data</span><span class="p">)</span>
</span><span id="LMAHeureuxPorosityDiff-374"><a href="#LMAHeureuxPorosityDiff-374"><span class="linenos">374</span></a>
</span><span id="LMAHeureuxPorosityDiff-375"><a href="#LMAHeureuxPorosityDiff-375"><span class="linenos">375</span></a>        <span class="n">cCa_grad_back</span> <span class="o">=</span> <span class="n">cCa</span><span class="o">.</span><span class="n">apply_operator</span><span class="p">(</span><span class="s2">&quot;grad_back&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">bc_cCa</span><span class="p">)</span>
</span><span id="LMAHeureuxPorosityDiff-376"><a href="#LMAHeureuxPorosityDiff-376"><span class="linenos">376</span></a>        <span class="n">cCa_grad_forw</span> <span class="o">=</span> <span class="n">cCa</span><span class="o">.</span><span class="n">apply_operator</span><span class="p">(</span><span class="s2">&quot;grad_forw&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">bc_cCa</span><span class="p">)</span>
</span><span id="LMAHeureuxPorosityDiff-377"><a href="#LMAHeureuxPorosityDiff-377"><span class="linenos">377</span></a>        <span class="n">cCa_grad</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">((</span><span class="mi">1</span><span class="o">-</span><span class="n">sigma_cCa</span><span class="p">)</span> <span class="o">*</span> <span class="n">cCa_grad_forw</span> <span class="o">+</span>\
</span><span id="LMAHeureuxPorosityDiff-378"><a href="#LMAHeureuxPorosityDiff-378"><span class="linenos">378</span></a>             <span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="n">sigma_cCa</span><span class="p">)</span> <span class="o">*</span> <span class="n">cCa_grad_back</span><span class="p">)</span>
</span><span id="LMAHeureuxPorosityDiff-379"><a href="#LMAHeureuxPorosityDiff-379"><span class="linenos">379</span></a>
</span><span id="LMAHeureuxPorosityDiff-380"><a href="#LMAHeureuxPorosityDiff-380"><span class="linenos">380</span></a>        <span class="n">cCO3_grad_back</span> <span class="o">=</span> <span class="n">cCO3</span><span class="o">.</span><span class="n">apply_operator</span><span class="p">(</span><span class="s2">&quot;grad_back&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">bc_cCO3</span><span class="p">)</span>
</span><span id="LMAHeureuxPorosityDiff-381"><a href="#LMAHeureuxPorosityDiff-381"><span class="linenos">381</span></a>        <span class="n">cCO3_grad_forw</span> <span class="o">=</span> <span class="n">cCO3</span><span class="o">.</span><span class="n">apply_operator</span><span class="p">(</span><span class="s2">&quot;grad_forw&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">bc_cCO3</span><span class="p">)</span>
</span><span id="LMAHeureuxPorosityDiff-382"><a href="#LMAHeureuxPorosityDiff-382"><span class="linenos">382</span></a>        <span class="n">cCO3_grad</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">((</span><span class="mi">1</span><span class="o">-</span><span class="n">sigma_cCO3</span><span class="p">)</span> <span class="o">*</span> <span class="n">cCO3_grad_forw</span> <span class="o">+</span>\
</span><span id="LMAHeureuxPorosityDiff-383"><a href="#LMAHeureuxPorosityDiff-383"><span class="linenos">383</span></a>             <span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="n">sigma_cCO3</span><span class="p">)</span> <span class="o">*</span> <span class="n">cCO3_grad_back</span><span class="p">)</span>
</span><span id="LMAHeureuxPorosityDiff-384"><a href="#LMAHeureuxPorosityDiff-384"><span class="linenos">384</span></a>
</span><span id="LMAHeureuxPorosityDiff-385"><a href="#LMAHeureuxPorosityDiff-385"><span class="linenos">385</span></a>        <span class="n">Phi_grad_back</span> <span class="o">=</span> <span class="n">Phi</span><span class="o">.</span><span class="n">apply_operator</span><span class="p">(</span><span class="s2">&quot;grad_back&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">bc_Phi</span><span class="p">)</span>
</span><span id="LMAHeureuxPorosityDiff-386"><a href="#LMAHeureuxPorosityDiff-386"><span class="linenos">386</span></a>        <span class="n">Phi_grad_forw</span> <span class="o">=</span> <span class="n">Phi</span><span class="o">.</span><span class="n">apply_operator</span><span class="p">(</span><span class="s2">&quot;grad_forw&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">bc_Phi</span><span class="p">)</span>
</span><span id="LMAHeureuxPorosityDiff-387"><a href="#LMAHeureuxPorosityDiff-387"><span class="linenos">387</span></a>        <span class="n">Phi_grad</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">((</span><span class="mi">1</span><span class="o">-</span><span class="n">sigma_Phi</span><span class="p">)</span> <span class="o">*</span> <span class="n">Phi_grad_forw</span> <span class="o">+</span>\
</span><span id="LMAHeureuxPorosityDiff-388"><a href="#LMAHeureuxPorosityDiff-388"><span class="linenos">388</span></a>             <span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="n">sigma_Phi</span><span class="p">)</span> <span class="o">*</span> <span class="n">Phi_grad_back</span><span class="p">)</span>
</span><span id="LMAHeureuxPorosityDiff-389"><a href="#LMAHeureuxPorosityDiff-389"><span class="linenos">389</span></a>
</span><span id="LMAHeureuxPorosityDiff-390"><a href="#LMAHeureuxPorosityDiff-390"><span class="linenos">390</span></a>        <span class="n">Phi_denom</span> <span class="o">=</span> <span class="n">Phi</span><span class="o">/</span><span class="n">denominator</span>
</span><span id="LMAHeureuxPorosityDiff-391"><a href="#LMAHeureuxPorosityDiff-391"><span class="linenos">391</span></a>        <span class="n">grad_Phi_denom</span> <span class="o">=</span> <span class="n">Phi_grad</span> <span class="o">*</span> <span class="p">(</span><span class="n">denominator</span> <span class="o">+</span> <span class="mi">2</span><span class="p">)</span> <span class="o">/</span> <span class="n">denominator</span> <span class="o">**</span> <span class="mi">2</span>
</span><span id="LMAHeureuxPorosityDiff-392"><a href="#LMAHeureuxPorosityDiff-392"><span class="linenos">392</span></a>
</span><span id="LMAHeureuxPorosityDiff-393"><a href="#LMAHeureuxPorosityDiff-393"><span class="linenos">393</span></a>        <span class="n">common_helper</span> <span class="o">=</span> <span class="n">coA</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">lambda_</span> <span class="o">*</span> <span class="n">coC</span>
</span><span id="LMAHeureuxPorosityDiff-394"><a href="#LMAHeureuxPorosityDiff-394"><span class="linenos">394</span></a>
</span><span id="LMAHeureuxPorosityDiff-395"><a href="#LMAHeureuxPorosityDiff-395"><span class="linenos">395</span></a>        <span class="n">dcCa_dt</span> <span class="o">=</span> <span class="p">(</span><span class="n">cCa_grad</span> <span class="o">*</span> <span class="n">grad_Phi_denom</span> <span class="o">+</span> <span class="n">Phi_denom</span> <span class="o">*</span> <span class="n">cCa</span><span class="o">.</span><span class="n">laplace</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bc_cCa</span><span class="p">))</span> \
</span><span id="LMAHeureuxPorosityDiff-396"><a href="#LMAHeureuxPorosityDiff-396"><span class="linenos">396</span></a>                  <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">dCa</span> <span class="o">/</span><span class="n">Phi</span> <span class="o">-</span><span class="n">W</span> <span class="o">*</span> <span class="n">cCa_grad</span> \
</span><span id="LMAHeureuxPorosityDiff-397"><a href="#LMAHeureuxPorosityDiff-397"><span class="linenos">397</span></a>                  <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">Da</span> <span class="o">*</span> <span class="n">one_minus_Phi</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">delta</span> <span class="o">-</span> <span class="n">cCa</span><span class="p">)</span> <span class="o">*</span> <span class="n">common_helper</span> <span class="o">/</span> <span class="n">Phi</span>
</span><span id="LMAHeureuxPorosityDiff-398"><a href="#LMAHeureuxPorosityDiff-398"><span class="linenos">398</span></a>
</span><span id="LMAHeureuxPorosityDiff-399"><a href="#LMAHeureuxPorosityDiff-399"><span class="linenos">399</span></a>        <span class="n">dcCO3_dt</span> <span class="o">=</span> <span class="p">(</span><span class="n">cCO3_grad</span> <span class="o">*</span> <span class="n">grad_Phi_denom</span> <span class="o">+</span> <span class="n">Phi_denom</span> <span class="o">*</span> <span class="n">cCO3</span><span class="o">.</span><span class="n">laplace</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bc_cCO3</span><span class="p">))</span> \
</span><span id="LMAHeureuxPorosityDiff-400"><a href="#LMAHeureuxPorosityDiff-400"><span class="linenos">400</span></a>                   <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">dCO3</span><span class="o">/</span><span class="n">Phi</span> <span class="o">-</span><span class="n">W</span> <span class="o">*</span> <span class="n">cCO3_grad</span> \
</span><span id="LMAHeureuxPorosityDiff-401"><a href="#LMAHeureuxPorosityDiff-401"><span class="linenos">401</span></a>                   <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">Da</span> <span class="o">*</span> <span class="n">one_minus_Phi</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">delta</span> <span class="o">-</span> <span class="n">cCO3</span><span class="p">)</span> <span class="o">*</span> <span class="n">common_helper</span> <span class="o">/</span> <span class="n">Phi</span>
</span><span id="LMAHeureuxPorosityDiff-402"><a href="#LMAHeureuxPorosityDiff-402"><span class="linenos">402</span></a>
</span><span id="LMAHeureuxPorosityDiff-403"><a href="#LMAHeureuxPorosityDiff-403"><span class="linenos">403</span></a>        <span class="n">dW_dx</span> <span class="o">=</span> <span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">rhorat</span> <span class="o">*</span> <span class="n">Phi_grad</span> <span class="o">*</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">Phi</span> <span class="o">*</span> <span class="n">F</span> <span class="o">+</span> <span class="mi">10</span> <span class="o">*</span> <span class="p">(</span><span class="n">F</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span>
</span><span id="LMAHeureuxPorosityDiff-404"><a href="#LMAHeureuxPorosityDiff-404"><span class="linenos">404</span></a>
</span><span id="LMAHeureuxPorosityDiff-405"><a href="#LMAHeureuxPorosityDiff-405"><span class="linenos">405</span></a>        <span class="c1"># This is closer to the original form of (43) from l&#39; Heureux than</span>
</span><span id="LMAHeureuxPorosityDiff-406"><a href="#LMAHeureuxPorosityDiff-406"><span class="linenos">406</span></a>        <span class="c1"># the Matlab implementation.</span>
</span><span id="LMAHeureuxPorosityDiff-407"><a href="#LMAHeureuxPorosityDiff-407"><span class="linenos">407</span></a>        <span class="n">dPhi_dt</span> <span class="o">=</span> <span class="o">-</span> <span class="p">(</span><span class="n">Phi</span> <span class="o">*</span> <span class="n">dW_dx</span> <span class="o">+</span> <span class="n">W</span> <span class="o">*</span> <span class="n">Phi_grad</span><span class="p">)</span> \
</span><span id="LMAHeureuxPorosityDiff-408"><a href="#LMAHeureuxPorosityDiff-408"><span class="linenos">408</span></a>                  <span class="o">+</span> <span class="n">dPhi</span> <span class="o">*</span> <span class="n">Phi</span><span class="o">.</span><span class="n">laplace</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bc_Phi</span><span class="p">)</span> \
</span><span id="LMAHeureuxPorosityDiff-409"><a href="#LMAHeureuxPorosityDiff-409"><span class="linenos">409</span></a>                  <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">Da</span> <span class="o">*</span> <span class="n">one_minus_Phi</span> <span class="o">*</span> <span class="n">common_helper</span>
</span><span id="LMAHeureuxPorosityDiff-410"><a href="#LMAHeureuxPorosityDiff-410"><span class="linenos">410</span></a>
</span><span id="LMAHeureuxPorosityDiff-411"><a href="#LMAHeureuxPorosityDiff-411"><span class="linenos">411</span></a>        <span class="k">return</span> <span class="n">FieldCollection</span><span class="p">([</span><span class="n">dCA_dt</span><span class="p">,</span> <span class="n">dCC_dt</span><span class="p">,</span> <span class="n">dcCa_dt</span><span class="p">,</span> <span class="n">dcCO3_dt</span><span class="p">,</span> <span class="n">dPhi_dt</span><span class="p">])</span>
</span><span id="LMAHeureuxPorosityDiff-412"><a href="#LMAHeureuxPorosityDiff-412"><span class="linenos">412</span></a>
</span><span id="LMAHeureuxPorosityDiff-413"><a href="#LMAHeureuxPorosityDiff-413"><span class="linenos">413</span></a>    <span class="k">def</span> <span class="nf">_make_pde_rhs_numba</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">state</span><span class="p">):</span>
</span><span id="LMAHeureuxPorosityDiff-414"><a href="#LMAHeureuxPorosityDiff-414"><span class="linenos">414</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot; the numba-accelerated evolution equation &quot;&quot;&quot;</span>
</span><span id="LMAHeureuxPorosityDiff-415"><a href="#LMAHeureuxPorosityDiff-415"><span class="linenos">415</span></a>        <span class="c1"># make attributes locally available</span>
</span><span id="LMAHeureuxPorosityDiff-416"><a href="#LMAHeureuxPorosityDiff-416"><span class="linenos">416</span></a>        <span class="n">KRat</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">KRat</span>
</span><span id="LMAHeureuxPorosityDiff-417"><a href="#LMAHeureuxPorosityDiff-417"><span class="linenos">417</span></a>        <span class="n">m1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">m1</span>
</span><span id="LMAHeureuxPorosityDiff-418"><a href="#LMAHeureuxPorosityDiff-418"><span class="linenos">418</span></a>        <span class="n">m2</span>  <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">m2</span>
</span><span id="LMAHeureuxPorosityDiff-419"><a href="#LMAHeureuxPorosityDiff-419"><span class="linenos">419</span></a>        <span class="n">n1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">n1</span>
</span><span id="LMAHeureuxPorosityDiff-420"><a href="#LMAHeureuxPorosityDiff-420"><span class="linenos">420</span></a>        <span class="n">n2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">n2</span>
</span><span id="LMAHeureuxPorosityDiff-421"><a href="#LMAHeureuxPorosityDiff-421"><span class="linenos">421</span></a>        <span class="n">nu1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nu1</span>
</span><span id="LMAHeureuxPorosityDiff-422"><a href="#LMAHeureuxPorosityDiff-422"><span class="linenos">422</span></a>        <span class="n">nu2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nu2</span>
</span><span id="LMAHeureuxPorosityDiff-423"><a href="#LMAHeureuxPorosityDiff-423"><span class="linenos">423</span></a>        <span class="n">not_too_deep</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">not_too_deep</span><span class="o">.</span><span class="n">data</span>
</span><span id="LMAHeureuxPorosityDiff-424"><a href="#LMAHeureuxPorosityDiff-424"><span class="linenos">424</span></a>        <span class="n">not_too_shallow</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">not_too_shallow</span><span class="o">.</span><span class="n">data</span>
</span><span id="LMAHeureuxPorosityDiff-425"><a href="#LMAHeureuxPorosityDiff-425"><span class="linenos">425</span></a>        <span class="n">presum</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">presum</span>
</span><span id="LMAHeureuxPorosityDiff-426"><a href="#LMAHeureuxPorosityDiff-426"><span class="linenos">426</span></a>        <span class="n">rhorat</span><span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rhorat</span>
</span><span id="LMAHeureuxPorosityDiff-427"><a href="#LMAHeureuxPorosityDiff-427"><span class="linenos">427</span></a>        <span class="n">lambda_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lambda_</span>
</span><span id="LMAHeureuxPorosityDiff-428"><a href="#LMAHeureuxPorosityDiff-428"><span class="linenos">428</span></a>        <span class="n">Da</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Da</span>
</span><span id="LMAHeureuxPorosityDiff-429"><a href="#LMAHeureuxPorosityDiff-429"><span class="linenos">429</span></a>        <span class="n">dCa</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dCa</span>
</span><span id="LMAHeureuxPorosityDiff-430"><a href="#LMAHeureuxPorosityDiff-430"><span class="linenos">430</span></a>        <span class="n">dCO3</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dCO3</span>
</span><span id="LMAHeureuxPorosityDiff-431"><a href="#LMAHeureuxPorosityDiff-431"><span class="linenos">431</span></a>        <span class="n">delta</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">delta</span>
</span><span id="LMAHeureuxPorosityDiff-432"><a href="#LMAHeureuxPorosityDiff-432"><span class="linenos">432</span></a>        <span class="c1"># The following three numbers are also needed for Fiadeiro-Veronis.</span>
</span><span id="LMAHeureuxPorosityDiff-433"><a href="#LMAHeureuxPorosityDiff-433"><span class="linenos">433</span></a>        <span class="n">dPhi_fixed</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dPhi_fixed</span>
</span><span id="LMAHeureuxPorosityDiff-434"><a href="#LMAHeureuxPorosityDiff-434"><span class="linenos">434</span></a>        <span class="n">Peclet_min</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Peclet_min</span>
</span><span id="LMAHeureuxPorosityDiff-435"><a href="#LMAHeureuxPorosityDiff-435"><span class="linenos">435</span></a>        <span class="n">Peclet_max</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Peclet_max</span>
</span><span id="LMAHeureuxPorosityDiff-436"><a href="#LMAHeureuxPorosityDiff-436"><span class="linenos">436</span></a>        <span class="n">delta_x</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">_axes_coords</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">state</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">_axes_coords</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
</span><span id="LMAHeureuxPorosityDiff-437"><a href="#LMAHeureuxPorosityDiff-437"><span class="linenos">437</span></a>        <span class="n">grad_back_CA</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">make_operator</span><span class="p">(</span><span class="s2">&quot;grad_back&quot;</span><span class="p">,</span> <span class="n">bc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bc_CA</span><span class="p">)</span>
</span><span id="LMAHeureuxPorosityDiff-438"><a href="#LMAHeureuxPorosityDiff-438"><span class="linenos">438</span></a>        <span class="n">grad_forw_CA</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">make_operator</span><span class="p">(</span><span class="s2">&quot;grad_forw&quot;</span><span class="p">,</span> <span class="n">bc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bc_CA</span><span class="p">)</span>
</span><span id="LMAHeureuxPorosityDiff-439"><a href="#LMAHeureuxPorosityDiff-439"><span class="linenos">439</span></a>        <span class="n">grad_back_CC</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">make_operator</span><span class="p">(</span><span class="s2">&quot;grad_back&quot;</span><span class="p">,</span> <span class="n">bc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bc_CC</span><span class="p">)</span>
</span><span id="LMAHeureuxPorosityDiff-440"><a href="#LMAHeureuxPorosityDiff-440"><span class="linenos">440</span></a>        <span class="n">grad_forw_CC</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">make_operator</span><span class="p">(</span><span class="s2">&quot;grad_forw&quot;</span><span class="p">,</span> <span class="n">bc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bc_CC</span><span class="p">)</span>
</span><span id="LMAHeureuxPorosityDiff-441"><a href="#LMAHeureuxPorosityDiff-441"><span class="linenos">441</span></a>        <span class="n">grad_back_cCa</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">make_operator</span><span class="p">(</span><span class="s2">&quot;grad_back&quot;</span><span class="p">,</span> <span class="n">bc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bc_cCa</span><span class="p">)</span>
</span><span id="LMAHeureuxPorosityDiff-442"><a href="#LMAHeureuxPorosityDiff-442"><span class="linenos">442</span></a>        <span class="n">grad_forw_cCa</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">make_operator</span><span class="p">(</span><span class="s2">&quot;grad_forw&quot;</span><span class="p">,</span> <span class="n">bc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bc_cCa</span><span class="p">)</span>
</span><span id="LMAHeureuxPorosityDiff-443"><a href="#LMAHeureuxPorosityDiff-443"><span class="linenos">443</span></a>        <span class="n">laplace_cCa</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">make_operator</span><span class="p">(</span><span class="s2">&quot;laplace&quot;</span><span class="p">,</span> <span class="n">bc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bc_cCa</span><span class="p">)</span>
</span><span id="LMAHeureuxPorosityDiff-444"><a href="#LMAHeureuxPorosityDiff-444"><span class="linenos">444</span></a>        <span class="n">grad_back_cCO3</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">make_operator</span><span class="p">(</span><span class="s2">&quot;grad_back&quot;</span><span class="p">,</span> <span class="n">bc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bc_cCO3</span><span class="p">)</span>
</span><span id="LMAHeureuxPorosityDiff-445"><a href="#LMAHeureuxPorosityDiff-445"><span class="linenos">445</span></a>        <span class="n">grad_forw_cCO3</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">make_operator</span><span class="p">(</span><span class="s2">&quot;grad_forw&quot;</span><span class="p">,</span> <span class="n">bc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bc_cCO3</span><span class="p">)</span>
</span><span id="LMAHeureuxPorosityDiff-446"><a href="#LMAHeureuxPorosityDiff-446"><span class="linenos">446</span></a>        <span class="n">laplace_cCO3</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">make_operator</span><span class="p">(</span><span class="s2">&quot;laplace&quot;</span><span class="p">,</span> <span class="n">bc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bc_cCO3</span><span class="p">)</span>
</span><span id="LMAHeureuxPorosityDiff-447"><a href="#LMAHeureuxPorosityDiff-447"><span class="linenos">447</span></a>        <span class="n">grad_back_Phi</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">make_operator</span><span class="p">(</span><span class="s2">&quot;grad_back&quot;</span><span class="p">,</span> <span class="n">bc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bc_Phi</span><span class="p">)</span>
</span><span id="LMAHeureuxPorosityDiff-448"><a href="#LMAHeureuxPorosityDiff-448"><span class="linenos">448</span></a>        <span class="n">grad_forw_Phi</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">make_operator</span><span class="p">(</span><span class="s2">&quot;grad_forw&quot;</span><span class="p">,</span> <span class="n">bc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bc_Phi</span><span class="p">)</span>
</span><span id="LMAHeureuxPorosityDiff-449"><a href="#LMAHeureuxPorosityDiff-449"><span class="linenos">449</span></a>        <span class="n">laplace_Phi</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">make_operator</span><span class="p">(</span><span class="s2">&quot;laplace&quot;</span><span class="p">,</span> <span class="n">bc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bc_Phi</span><span class="p">)</span>
</span><span id="LMAHeureuxPorosityDiff-450"><a href="#LMAHeureuxPorosityDiff-450"><span class="linenos">450</span></a>
</span><span id="LMAHeureuxPorosityDiff-451"><a href="#LMAHeureuxPorosityDiff-451"><span class="linenos">451</span></a>        <span class="nd">@njit</span>
</span><span id="LMAHeureuxPorosityDiff-452"><a href="#LMAHeureuxPorosityDiff-452"><span class="linenos">452</span></a>        <span class="k">def</span> <span class="nf">pde_rhs</span><span class="p">(</span><span class="n">state_data</span><span class="p">,</span> <span class="n">t</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
</span><span id="LMAHeureuxPorosityDiff-453"><a href="#LMAHeureuxPorosityDiff-453"><span class="linenos">453</span></a><span class="w">            </span><span class="sd">&quot;&quot;&quot; compiled helper function evaluating right hand side &quot;&quot;&quot;</span>
</span><span id="LMAHeureuxPorosityDiff-454"><a href="#LMAHeureuxPorosityDiff-454"><span class="linenos">454</span></a>            <span class="c1"># Instead of the default central differenced gradient from py-pde</span>
</span><span id="LMAHeureuxPorosityDiff-455"><a href="#LMAHeureuxPorosityDiff-455"><span class="linenos">455</span></a>            <span class="c1"># construct forward and backward differenced gradients and apply</span>
</span><span id="LMAHeureuxPorosityDiff-456"><a href="#LMAHeureuxPorosityDiff-456"><span class="linenos">456</span></a>            <span class="c1"># either one of them, based on the sign of U.</span>
</span><span id="LMAHeureuxPorosityDiff-457"><a href="#LMAHeureuxPorosityDiff-457"><span class="linenos">457</span></a>            <span class="n">CA</span> <span class="o">=</span> <span class="n">state_data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="LMAHeureuxPorosityDiff-458"><a href="#LMAHeureuxPorosityDiff-458"><span class="linenos">458</span></a>            <span class="n">CA_grad_back</span> <span class="o">=</span> <span class="n">grad_back_CA</span><span class="p">(</span><span class="n">CA</span><span class="p">)</span>
</span><span id="LMAHeureuxPorosityDiff-459"><a href="#LMAHeureuxPorosityDiff-459"><span class="linenos">459</span></a>            <span class="n">CA_grad_forw</span> <span class="o">=</span> <span class="n">grad_forw_CA</span><span class="p">(</span><span class="n">CA</span><span class="p">)</span>
</span><span id="LMAHeureuxPorosityDiff-460"><a href="#LMAHeureuxPorosityDiff-460"><span class="linenos">460</span></a>
</span><span id="LMAHeureuxPorosityDiff-461"><a href="#LMAHeureuxPorosityDiff-461"><span class="linenos">461</span></a>            <span class="n">CC</span> <span class="o">=</span> <span class="n">state_data</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
</span><span id="LMAHeureuxPorosityDiff-462"><a href="#LMAHeureuxPorosityDiff-462"><span class="linenos">462</span></a>            <span class="n">CC_grad_back</span> <span class="o">=</span> <span class="n">grad_back_CC</span><span class="p">(</span><span class="n">CC</span><span class="p">)</span>
</span><span id="LMAHeureuxPorosityDiff-463"><a href="#LMAHeureuxPorosityDiff-463"><span class="linenos">463</span></a>            <span class="n">CC_grad_forw</span> <span class="o">=</span> <span class="n">grad_forw_CC</span><span class="p">(</span><span class="n">CC</span><span class="p">)</span>
</span><span id="LMAHeureuxPorosityDiff-464"><a href="#LMAHeureuxPorosityDiff-464"><span class="linenos">464</span></a>
</span><span id="LMAHeureuxPorosityDiff-465"><a href="#LMAHeureuxPorosityDiff-465"><span class="linenos">465</span></a>            <span class="n">cCa</span> <span class="o">=</span> <span class="n">state_data</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
</span><span id="LMAHeureuxPorosityDiff-466"><a href="#LMAHeureuxPorosityDiff-466"><span class="linenos">466</span></a>            <span class="n">cCa_grad_back</span> <span class="o">=</span> <span class="n">grad_back_cCa</span><span class="p">(</span><span class="n">cCa</span><span class="p">)</span>
</span><span id="LMAHeureuxPorosityDiff-467"><a href="#LMAHeureuxPorosityDiff-467"><span class="linenos">467</span></a>            <span class="n">cCa_grad_forw</span> <span class="o">=</span> <span class="n">grad_forw_cCa</span><span class="p">(</span><span class="n">cCa</span><span class="p">)</span>
</span><span id="LMAHeureuxPorosityDiff-468"><a href="#LMAHeureuxPorosityDiff-468"><span class="linenos">468</span></a>            <span class="n">cCa_laplace</span> <span class="o">=</span> <span class="n">laplace_cCa</span><span class="p">(</span><span class="n">cCa</span><span class="p">)</span>
</span><span id="LMAHeureuxPorosityDiff-469"><a href="#LMAHeureuxPorosityDiff-469"><span class="linenos">469</span></a>
</span><span id="LMAHeureuxPorosityDiff-470"><a href="#LMAHeureuxPorosityDiff-470"><span class="linenos">470</span></a>            <span class="n">cCO3</span> <span class="o">=</span> <span class="n">state_data</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
</span><span id="LMAHeureuxPorosityDiff-471"><a href="#LMAHeureuxPorosityDiff-471"><span class="linenos">471</span></a>            <span class="n">cCO3_grad_back</span> <span class="o">=</span> <span class="n">grad_back_cCO3</span><span class="p">(</span><span class="n">cCO3</span><span class="p">)</span>
</span><span id="LMAHeureuxPorosityDiff-472"><a href="#LMAHeureuxPorosityDiff-472"><span class="linenos">472</span></a>            <span class="n">cCO3_grad_forw</span> <span class="o">=</span> <span class="n">grad_forw_cCO3</span><span class="p">(</span><span class="n">cCO3</span><span class="p">)</span>
</span><span id="LMAHeureuxPorosityDiff-473"><a href="#LMAHeureuxPorosityDiff-473"><span class="linenos">473</span></a>            <span class="n">cCO3_laplace</span> <span class="o">=</span> <span class="n">laplace_cCO3</span><span class="p">(</span><span class="n">cCO3</span><span class="p">)</span>
</span><span id="LMAHeureuxPorosityDiff-474"><a href="#LMAHeureuxPorosityDiff-474"><span class="linenos">474</span></a>
</span><span id="LMAHeureuxPorosityDiff-475"><a href="#LMAHeureuxPorosityDiff-475"><span class="linenos">475</span></a>            <span class="n">Phi</span> <span class="o">=</span> <span class="n">state_data</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span>
</span><span id="LMAHeureuxPorosityDiff-476"><a href="#LMAHeureuxPorosityDiff-476"><span class="linenos">476</span></a>            <span class="n">Phi_grad_back</span> <span class="o">=</span> <span class="n">grad_back_Phi</span><span class="p">(</span><span class="n">Phi</span><span class="p">)</span>
</span><span id="LMAHeureuxPorosityDiff-477"><a href="#LMAHeureuxPorosityDiff-477"><span class="linenos">477</span></a>            <span class="n">Phi_grad_forw</span> <span class="o">=</span> <span class="n">grad_forw_Phi</span><span class="p">(</span><span class="n">Phi</span><span class="p">)</span>
</span><span id="LMAHeureuxPorosityDiff-478"><a href="#LMAHeureuxPorosityDiff-478"><span class="linenos">478</span></a>            <span class="n">Phi_laplace</span> <span class="o">=</span> <span class="n">laplace_Phi</span><span class="p">(</span><span class="n">Phi</span><span class="p">)</span>
</span><span id="LMAHeureuxPorosityDiff-479"><a href="#LMAHeureuxPorosityDiff-479"><span class="linenos">479</span></a>
</span><span id="LMAHeureuxPorosityDiff-480"><a href="#LMAHeureuxPorosityDiff-480"><span class="linenos">480</span></a>            <span class="n">rate</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty_like</span><span class="p">(</span><span class="n">state_data</span><span class="p">)</span>
</span><span id="LMAHeureuxPorosityDiff-481"><a href="#LMAHeureuxPorosityDiff-481"><span class="linenos">481</span></a>
</span><span id="LMAHeureuxPorosityDiff-482"><a href="#LMAHeureuxPorosityDiff-482"><span class="linenos">482</span></a>            <span class="c1"># state_data.size should be the same as len(CA) or len(CC), check this.</span>
</span><span id="LMAHeureuxPorosityDiff-483"><a href="#LMAHeureuxPorosityDiff-483"><span class="linenos">483</span></a>            <span class="c1"># So the number of depths, really.</span>
</span><span id="LMAHeureuxPorosityDiff-484"><a href="#LMAHeureuxPorosityDiff-484"><span class="linenos">484</span></a>            <span class="n">no_depths</span> <span class="o">=</span> <span class="n">state_data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">size</span>
</span><span id="LMAHeureuxPorosityDiff-485"><a href="#LMAHeureuxPorosityDiff-485"><span class="linenos">485</span></a>
</span><span id="LMAHeureuxPorosityDiff-486"><a href="#LMAHeureuxPorosityDiff-486"><span class="linenos">486</span></a>            <span class="n">denominator</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="n">no_depths</span><span class="p">)</span>
</span><span id="LMAHeureuxPorosityDiff-487"><a href="#LMAHeureuxPorosityDiff-487"><span class="linenos">487</span></a>            <span class="n">common_helper1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="n">no_depths</span><span class="p">)</span>
</span><span id="LMAHeureuxPorosityDiff-488"><a href="#LMAHeureuxPorosityDiff-488"><span class="linenos">488</span></a>            <span class="n">common_helper2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="n">no_depths</span><span class="p">)</span>
</span><span id="LMAHeureuxPorosityDiff-489"><a href="#LMAHeureuxPorosityDiff-489"><span class="linenos">489</span></a>            <span class="n">helper_cCa_grad</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="n">no_depths</span><span class="p">)</span>
</span><span id="LMAHeureuxPorosityDiff-490"><a href="#LMAHeureuxPorosityDiff-490"><span class="linenos">490</span></a>            <span class="n">helper_cCO3_grad</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="n">no_depths</span><span class="p">)</span>
</span><span id="LMAHeureuxPorosityDiff-491"><a href="#LMAHeureuxPorosityDiff-491"><span class="linenos">491</span></a>            <span class="n">F</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="n">no_depths</span><span class="p">)</span>
</span><span id="LMAHeureuxPorosityDiff-492"><a href="#LMAHeureuxPorosityDiff-492"><span class="linenos">492</span></a>            <span class="n">U</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="n">no_depths</span><span class="p">)</span>
</span><span id="LMAHeureuxPorosityDiff-493"><a href="#LMAHeureuxPorosityDiff-493"><span class="linenos">493</span></a>            <span class="n">W</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="n">no_depths</span><span class="p">)</span>
</span><span id="LMAHeureuxPorosityDiff-494"><a href="#LMAHeureuxPorosityDiff-494"><span class="linenos">494</span></a>            <span class="n">two_factors</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="n">no_depths</span><span class="p">)</span>
</span><span id="LMAHeureuxPorosityDiff-495"><a href="#LMAHeureuxPorosityDiff-495"><span class="linenos">495</span></a>            <span class="n">two_factors_upp_lim</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="n">no_depths</span><span class="p">)</span>
</span><span id="LMAHeureuxPorosityDiff-496"><a href="#LMAHeureuxPorosityDiff-496"><span class="linenos">496</span></a>            <span class="n">two_factors_low_lim</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="n">no_depths</span><span class="p">)</span>
</span><span id="LMAHeureuxPorosityDiff-497"><a href="#LMAHeureuxPorosityDiff-497"><span class="linenos">497</span></a>            <span class="n">three_factors</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="n">no_depths</span><span class="p">)</span>
</span><span id="LMAHeureuxPorosityDiff-498"><a href="#LMAHeureuxPorosityDiff-498"><span class="linenos">498</span></a>            <span class="n">three_factors_upp_lim</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="n">no_depths</span><span class="p">)</span>
</span><span id="LMAHeureuxPorosityDiff-499"><a href="#LMAHeureuxPorosityDiff-499"><span class="linenos">499</span></a>            <span class="n">three_factors_low_lim</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="n">no_depths</span><span class="p">)</span>
</span><span id="LMAHeureuxPorosityDiff-500"><a href="#LMAHeureuxPorosityDiff-500"><span class="linenos">500</span></a>            <span class="n">coA</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="n">no_depths</span><span class="p">)</span>
</span><span id="LMAHeureuxPorosityDiff-501"><a href="#LMAHeureuxPorosityDiff-501"><span class="linenos">501</span></a>            <span class="n">coC</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="n">no_depths</span><span class="p">)</span>
</span><span id="LMAHeureuxPorosityDiff-502"><a href="#LMAHeureuxPorosityDiff-502"><span class="linenos">502</span></a>            <span class="n">common_helper3</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="n">no_depths</span><span class="p">)</span>
</span><span id="LMAHeureuxPorosityDiff-503"><a href="#LMAHeureuxPorosityDiff-503"><span class="linenos">503</span></a>            <span class="n">dPhi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="n">no_depths</span><span class="p">)</span>
</span><span id="LMAHeureuxPorosityDiff-504"><a href="#LMAHeureuxPorosityDiff-504"><span class="linenos">504</span></a>            <span class="n">dW_dx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="n">no_depths</span><span class="p">)</span>
</span><span id="LMAHeureuxPorosityDiff-505"><a href="#LMAHeureuxPorosityDiff-505"><span class="linenos">505</span></a>            <span class="n">one_minus_Phi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="n">no_depths</span><span class="p">)</span>
</span><span id="LMAHeureuxPorosityDiff-506"><a href="#LMAHeureuxPorosityDiff-506"><span class="linenos">506</span></a>            <span class="n">CA_grad</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="n">no_depths</span><span class="p">)</span>
</span><span id="LMAHeureuxPorosityDiff-507"><a href="#LMAHeureuxPorosityDiff-507"><span class="linenos">507</span></a>            <span class="n">CC_grad</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="n">no_depths</span><span class="p">)</span>
</span><span id="LMAHeureuxPorosityDiff-508"><a href="#LMAHeureuxPorosityDiff-508"><span class="linenos">508</span></a>            <span class="n">cCa_grad</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="n">no_depths</span><span class="p">)</span>
</span><span id="LMAHeureuxPorosityDiff-509"><a href="#LMAHeureuxPorosityDiff-509"><span class="linenos">509</span></a>            <span class="n">cCO3_grad</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="n">no_depths</span><span class="p">)</span>
</span><span id="LMAHeureuxPorosityDiff-510"><a href="#LMAHeureuxPorosityDiff-510"><span class="linenos">510</span></a>            <span class="n">Phi_grad</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="n">no_depths</span><span class="p">)</span>            
</span><span id="LMAHeureuxPorosityDiff-511"><a href="#LMAHeureuxPorosityDiff-511"><span class="linenos">511</span></a>
</span><span id="LMAHeureuxPorosityDiff-512"><a href="#LMAHeureuxPorosityDiff-512"><span class="linenos">512</span></a>            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">no_depths</span><span class="p">):</span>
</span><span id="LMAHeureuxPorosityDiff-513"><a href="#LMAHeureuxPorosityDiff-513"><span class="linenos">513</span></a>                <span class="n">F</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="mi">10</span> <span class="o">-</span> <span class="mi">10</span> <span class="o">/</span> <span class="n">Phi</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
</span><span id="LMAHeureuxPorosityDiff-514"><a href="#LMAHeureuxPorosityDiff-514"><span class="linenos">514</span></a>
</span><span id="LMAHeureuxPorosityDiff-515"><a href="#LMAHeureuxPorosityDiff-515"><span class="linenos">515</span></a>                <span class="n">U</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">presum</span> <span class="o">+</span> <span class="n">rhorat</span> <span class="o">*</span> <span class="n">Phi</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">**</span> <span class="mi">3</span> <span class="o">*</span> <span class="n">F</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">/</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">Phi</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
</span><span id="LMAHeureuxPorosityDiff-516"><a href="#LMAHeureuxPorosityDiff-516"><span class="linenos">516</span></a>
</span><span id="LMAHeureuxPorosityDiff-517"><a href="#LMAHeureuxPorosityDiff-517"><span class="linenos">517</span></a>                <span class="k">if</span> <span class="n">U</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="LMAHeureuxPorosityDiff-518"><a href="#LMAHeureuxPorosityDiff-518"><span class="linenos">518</span></a>                    <span class="n">CA_grad</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">CA_grad_back</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
</span><span id="LMAHeureuxPorosityDiff-519"><a href="#LMAHeureuxPorosityDiff-519"><span class="linenos">519</span></a>                    <span class="n">CC_grad</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">CC_grad_back</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
</span><span id="LMAHeureuxPorosityDiff-520"><a href="#LMAHeureuxPorosityDiff-520"><span class="linenos">520</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="LMAHeureuxPorosityDiff-521"><a href="#LMAHeureuxPorosityDiff-521"><span class="linenos">521</span></a>                    <span class="n">CA_grad</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">CA_grad_forw</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
</span><span id="LMAHeureuxPorosityDiff-522"><a href="#LMAHeureuxPorosityDiff-522"><span class="linenos">522</span></a>                    <span class="n">CC_grad</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">CC_grad_forw</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
</span><span id="LMAHeureuxPorosityDiff-523"><a href="#LMAHeureuxPorosityDiff-523"><span class="linenos">523</span></a>
</span><span id="LMAHeureuxPorosityDiff-524"><a href="#LMAHeureuxPorosityDiff-524"><span class="linenos">524</span></a>                <span class="n">W</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">presum</span> <span class="o">-</span> <span class="n">rhorat</span> <span class="o">*</span> <span class="n">Phi</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">F</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
</span><span id="LMAHeureuxPorosityDiff-525"><a href="#LMAHeureuxPorosityDiff-525"><span class="linenos">525</span></a>
</span><span id="LMAHeureuxPorosityDiff-526"><a href="#LMAHeureuxPorosityDiff-526"><span class="linenos">526</span></a>                <span class="c1"># Implementing equation 6 from l&#39;Heureux.</span>
</span><span id="LMAHeureuxPorosityDiff-527"><a href="#LMAHeureuxPorosityDiff-527"><span class="linenos">527</span></a>                <span class="n">denominator</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">Phi</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
</span><span id="LMAHeureuxPorosityDiff-528"><a href="#LMAHeureuxPorosityDiff-528"><span class="linenos">528</span></a>
</span><span id="LMAHeureuxPorosityDiff-529"><a href="#LMAHeureuxPorosityDiff-529"><span class="linenos">529</span></a>                <span class="c1"># Fiadeiro-Veronis scheme for equations 42 and 43</span>
</span><span id="LMAHeureuxPorosityDiff-530"><a href="#LMAHeureuxPorosityDiff-530"><span class="linenos">530</span></a>                <span class="c1"># from l&#39;Heureux. </span>
</span><span id="LMAHeureuxPorosityDiff-531"><a href="#LMAHeureuxPorosityDiff-531"><span class="linenos">531</span></a>                <span class="n">Peclet_cCa</span> <span class="o">=</span> <span class="n">W</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="n">delta_x</span> <span class="o">*</span> <span class="n">denominator</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">/</span> <span class="p">(</span><span class="mf">2.</span> <span class="o">*</span> <span class="n">dCa</span> <span class="p">)</span>
</span><span id="LMAHeureuxPorosityDiff-532"><a href="#LMAHeureuxPorosityDiff-532"><span class="linenos">532</span></a>                <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">Peclet_cCa</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">Peclet_min</span><span class="p">:</span>
</span><span id="LMAHeureuxPorosityDiff-533"><a href="#LMAHeureuxPorosityDiff-533"><span class="linenos">533</span></a>                    <span class="n">sigma_cCa</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="LMAHeureuxPorosityDiff-534"><a href="#LMAHeureuxPorosityDiff-534"><span class="linenos">534</span></a>                <span class="k">elif</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">Peclet_cCa</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">Peclet_max</span><span class="p">:</span>
</span><span id="LMAHeureuxPorosityDiff-535"><a href="#LMAHeureuxPorosityDiff-535"><span class="linenos">535</span></a>                    <span class="n">sigma_cCa</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sign</span><span class="p">(</span><span class="n">W</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
</span><span id="LMAHeureuxPorosityDiff-536"><a href="#LMAHeureuxPorosityDiff-536"><span class="linenos">536</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="LMAHeureuxPorosityDiff-537"><a href="#LMAHeureuxPorosityDiff-537"><span class="linenos">537</span></a>                     <span class="n">sigma_cCa</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cosh</span><span class="p">(</span><span class="n">Peclet_cCa</span><span class="p">)</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sinh</span><span class="p">(</span><span class="n">Peclet_cCa</span><span class="p">)</span> <span class="o">-</span> \
</span><span id="LMAHeureuxPorosityDiff-538"><a href="#LMAHeureuxPorosityDiff-538"><span class="linenos">538</span></a>                        <span class="mi">1</span><span class="o">/</span><span class="n">Peclet_cCa</span>
</span><span id="LMAHeureuxPorosityDiff-539"><a href="#LMAHeureuxPorosityDiff-539"><span class="linenos">539</span></a>
</span><span id="LMAHeureuxPorosityDiff-540"><a href="#LMAHeureuxPorosityDiff-540"><span class="linenos">540</span></a>                <span class="n">Peclet_cCO3</span> <span class="o">=</span> <span class="n">W</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="n">delta_x</span> <span class="o">*</span> <span class="n">denominator</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">/</span> <span class="p">(</span><span class="mf">2.</span> <span class="o">*</span> <span class="n">dCO3</span><span class="p">)</span>
</span><span id="LMAHeureuxPorosityDiff-541"><a href="#LMAHeureuxPorosityDiff-541"><span class="linenos">541</span></a>                <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">Peclet_cCO3</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">Peclet_min</span><span class="p">:</span>
</span><span id="LMAHeureuxPorosityDiff-542"><a href="#LMAHeureuxPorosityDiff-542"><span class="linenos">542</span></a>                    <span class="n">sigma_cCO3</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="LMAHeureuxPorosityDiff-543"><a href="#LMAHeureuxPorosityDiff-543"><span class="linenos">543</span></a>                <span class="k">elif</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">Peclet_cCO3</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">Peclet_max</span><span class="p">:</span>
</span><span id="LMAHeureuxPorosityDiff-544"><a href="#LMAHeureuxPorosityDiff-544"><span class="linenos">544</span></a>                    <span class="n">sigma_cCO3</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sign</span><span class="p">(</span><span class="n">W</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
</span><span id="LMAHeureuxPorosityDiff-545"><a href="#LMAHeureuxPorosityDiff-545"><span class="linenos">545</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="LMAHeureuxPorosityDiff-546"><a href="#LMAHeureuxPorosityDiff-546"><span class="linenos">546</span></a>                    <span class="n">sigma_cCO3</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cosh</span><span class="p">(</span><span class="n">Peclet_cCO3</span><span class="p">)</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sinh</span><span class="p">(</span><span class="n">Peclet_cCO3</span><span class="p">)</span> <span class="o">-</span> \
</span><span id="LMAHeureuxPorosityDiff-547"><a href="#LMAHeureuxPorosityDiff-547"><span class="linenos">547</span></a>                        <span class="mi">1</span><span class="o">/</span><span class="n">Peclet_cCO3</span>
</span><span id="LMAHeureuxPorosityDiff-548"><a href="#LMAHeureuxPorosityDiff-548"><span class="linenos">548</span></a>
</span><span id="LMAHeureuxPorosityDiff-549"><a href="#LMAHeureuxPorosityDiff-549"><span class="linenos">549</span></a>                <span class="n">one_minus_Phi</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">Phi</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>                 
</span><span id="LMAHeureuxPorosityDiff-550"><a href="#LMAHeureuxPorosityDiff-550"><span class="linenos">550</span></a>                <span class="n">dPhi</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">dPhi_fixed</span>
</span><span id="LMAHeureuxPorosityDiff-551"><a href="#LMAHeureuxPorosityDiff-551"><span class="linenos">551</span></a>                <span class="n">Peclet_Phi</span> <span class="o">=</span> <span class="n">W</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="n">delta_x</span> <span class="o">/</span> <span class="p">(</span><span class="mf">2.</span> <span class="o">*</span> <span class="n">dPhi</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
</span><span id="LMAHeureuxPorosityDiff-552"><a href="#LMAHeureuxPorosityDiff-552"><span class="linenos">552</span></a>                <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">Peclet_Phi</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">Peclet_min</span><span class="p">:</span>
</span><span id="LMAHeureuxPorosityDiff-553"><a href="#LMAHeureuxPorosityDiff-553"><span class="linenos">553</span></a>                    <span class="n">sigma_Phi</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="LMAHeureuxPorosityDiff-554"><a href="#LMAHeureuxPorosityDiff-554"><span class="linenos">554</span></a>                <span class="k">elif</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">Peclet_Phi</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">Peclet_max</span><span class="p">:</span>
</span><span id="LMAHeureuxPorosityDiff-555"><a href="#LMAHeureuxPorosityDiff-555"><span class="linenos">555</span></a>                    <span class="n">sigma_Phi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sign</span><span class="p">(</span><span class="n">W</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
</span><span id="LMAHeureuxPorosityDiff-556"><a href="#LMAHeureuxPorosityDiff-556"><span class="linenos">556</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="LMAHeureuxPorosityDiff-557"><a href="#LMAHeureuxPorosityDiff-557"><span class="linenos">557</span></a>                    <span class="n">sigma_Phi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cosh</span><span class="p">(</span><span class="n">Peclet_Phi</span><span class="p">)</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sinh</span><span class="p">(</span><span class="n">Peclet_Phi</span><span class="p">)</span> <span class="o">-</span> \
</span><span id="LMAHeureuxPorosityDiff-558"><a href="#LMAHeureuxPorosityDiff-558"><span class="linenos">558</span></a>                        <span class="mi">1</span><span class="o">/</span><span class="n">Peclet_Phi</span>
</span><span id="LMAHeureuxPorosityDiff-559"><a href="#LMAHeureuxPorosityDiff-559"><span class="linenos">559</span></a>
</span><span id="LMAHeureuxPorosityDiff-560"><a href="#LMAHeureuxPorosityDiff-560"><span class="linenos">560</span></a>                <span class="n">cCa_grad</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">((</span><span class="mi">1</span><span class="o">-</span><span class="n">sigma_cCa</span><span class="p">)</span> <span class="o">*</span> <span class="n">cCa_grad_forw</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> \
</span><span id="LMAHeureuxPorosityDiff-561"><a href="#LMAHeureuxPorosityDiff-561"><span class="linenos">561</span></a>                              <span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="n">sigma_cCa</span><span class="p">)</span> <span class="o">*</span> <span class="n">cCa_grad_back</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
</span><span id="LMAHeureuxPorosityDiff-562"><a href="#LMAHeureuxPorosityDiff-562"><span class="linenos">562</span></a>                <span class="n">cCO3_grad</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">((</span><span class="mi">1</span><span class="o">-</span><span class="n">sigma_cCO3</span><span class="p">)</span> <span class="o">*</span> <span class="n">cCO3_grad_forw</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> \
</span><span id="LMAHeureuxPorosityDiff-563"><a href="#LMAHeureuxPorosityDiff-563"><span class="linenos">563</span></a>                              <span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="n">sigma_cCO3</span><span class="p">)</span> <span class="o">*</span> <span class="n">cCO3_grad_back</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
</span><span id="LMAHeureuxPorosityDiff-564"><a href="#LMAHeureuxPorosityDiff-564"><span class="linenos">564</span></a>                <span class="n">Phi_grad</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">((</span><span class="mi">1</span><span class="o">-</span><span class="n">sigma_Phi</span><span class="p">)</span> <span class="o">*</span> <span class="n">Phi_grad_forw</span> <span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">+</span> \
</span><span id="LMAHeureuxPorosityDiff-565"><a href="#LMAHeureuxPorosityDiff-565"><span class="linenos">565</span></a>                              <span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="n">sigma_Phi</span><span class="p">)</span> <span class="o">*</span> <span class="n">Phi_grad_back</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
</span><span id="LMAHeureuxPorosityDiff-566"><a href="#LMAHeureuxPorosityDiff-566"><span class="linenos">566</span></a>
</span><span id="LMAHeureuxPorosityDiff-567"><a href="#LMAHeureuxPorosityDiff-567"><span class="linenos">567</span></a>                <span class="n">common_helper1</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">Phi</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">/</span><span class="n">denominator</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
</span><span id="LMAHeureuxPorosityDiff-568"><a href="#LMAHeureuxPorosityDiff-568"><span class="linenos">568</span></a>                <span class="n">common_helper2</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">Phi_grad</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="mi">2</span> <span class="o">+</span> <span class="n">denominator</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> \
</span><span id="LMAHeureuxPorosityDiff-569"><a href="#LMAHeureuxPorosityDiff-569"><span class="linenos">569</span></a>                                    <span class="o">/</span> <span class="n">denominator</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">**</span> <span class="mi">2</span>
</span><span id="LMAHeureuxPorosityDiff-570"><a href="#LMAHeureuxPorosityDiff-570"><span class="linenos">570</span></a>                <span class="n">helper_cCa_grad</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">dCa</span> <span class="o">*</span> <span class="p">(</span><span class="n">common_helper2</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="n">cCa_grad</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> \
</span><span id="LMAHeureuxPorosityDiff-571"><a href="#LMAHeureuxPorosityDiff-571"><span class="linenos">571</span></a>                                     <span class="o">+</span> <span class="n">common_helper1</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="n">cCa_laplace</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
</span><span id="LMAHeureuxPorosityDiff-572"><a href="#LMAHeureuxPorosityDiff-572"><span class="linenos">572</span></a>                <span class="n">helper_cCO3_grad</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">dCO3</span> <span class="o">*</span> <span class="p">(</span><span class="n">common_helper2</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="n">cCO3_grad</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> \
</span><span id="LMAHeureuxPorosityDiff-573"><a href="#LMAHeureuxPorosityDiff-573"><span class="linenos">573</span></a>                                     <span class="o">+</span> <span class="n">common_helper1</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="n">cCO3_laplace</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>            
</span><span id="LMAHeureuxPorosityDiff-574"><a href="#LMAHeureuxPorosityDiff-574"><span class="linenos">574</span></a>
</span><span id="LMAHeureuxPorosityDiff-575"><a href="#LMAHeureuxPorosityDiff-575"><span class="linenos">575</span></a>                <span class="n">two_factors</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">cCa</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="n">cCO3</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
</span><span id="LMAHeureuxPorosityDiff-576"><a href="#LMAHeureuxPorosityDiff-576"><span class="linenos">576</span></a>                <span class="n">two_factors_upp_lim</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">two_factors</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="mi">1</span><span class="p">)</span>
</span><span id="LMAHeureuxPorosityDiff-577"><a href="#LMAHeureuxPorosityDiff-577"><span class="linenos">577</span></a>                <span class="n">two_factors_low_lim</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">two_factors</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="mi">1</span><span class="p">)</span>
</span><span id="LMAHeureuxPorosityDiff-578"><a href="#LMAHeureuxPorosityDiff-578"><span class="linenos">578</span></a>                <span class="n">three_factors</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">two_factors</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="n">KRat</span>
</span><span id="LMAHeureuxPorosityDiff-579"><a href="#LMAHeureuxPorosityDiff-579"><span class="linenos">579</span></a>                <span class="n">three_factors_upp_lim</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">three_factors</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="mi">1</span><span class="p">)</span>
</span><span id="LMAHeureuxPorosityDiff-580"><a href="#LMAHeureuxPorosityDiff-580"><span class="linenos">580</span></a>                <span class="n">three_factors_low_lim</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">three_factors</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="mi">1</span><span class="p">)</span>
</span><span id="LMAHeureuxPorosityDiff-581"><a href="#LMAHeureuxPorosityDiff-581"><span class="linenos">581</span></a>
</span><span id="LMAHeureuxPorosityDiff-582"><a href="#LMAHeureuxPorosityDiff-582"><span class="linenos">582</span></a>                <span class="n">coA</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">CA</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="p">(((</span><span class="mi">1</span> <span class="o">-</span> <span class="n">three_factors_upp_lim</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">**</span> <span class="n">m2</span><span class="p">)</span> <span class="o">*</span> \
</span><span id="LMAHeureuxPorosityDiff-583"><a href="#LMAHeureuxPorosityDiff-583"><span class="linenos">583</span></a>                    <span class="p">(</span><span class="n">not_too_deep</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="n">not_too_shallow</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">-</span> <span class="n">nu1</span> <span class="o">*</span> \
</span><span id="LMAHeureuxPorosityDiff-584"><a href="#LMAHeureuxPorosityDiff-584"><span class="linenos">584</span></a>                    <span class="p">(</span><span class="n">three_factors_low_lim</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">**</span> <span class="n">m1</span><span class="p">)</span>
</span><span id="LMAHeureuxPorosityDiff-585"><a href="#LMAHeureuxPorosityDiff-585"><span class="linenos">585</span></a>
</span><span id="LMAHeureuxPorosityDiff-586"><a href="#LMAHeureuxPorosityDiff-586"><span class="linenos">586</span></a>                <span class="n">coC</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">CC</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="p">(((</span><span class="n">two_factors_low_lim</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">**</span> <span class="n">n1</span><span class="p">)</span> <span class="o">-</span> <span class="n">nu2</span> <span class="o">*</span> \
</span><span id="LMAHeureuxPorosityDiff-587"><a href="#LMAHeureuxPorosityDiff-587"><span class="linenos">587</span></a>                    <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">two_factors_upp_lim</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">**</span> <span class="n">n2</span><span class="p">)</span>         
</span><span id="LMAHeureuxPorosityDiff-588"><a href="#LMAHeureuxPorosityDiff-588"><span class="linenos">588</span></a>
</span><span id="LMAHeureuxPorosityDiff-589"><a href="#LMAHeureuxPorosityDiff-589"><span class="linenos">589</span></a>                <span class="n">common_helper3</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">coA</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">lambda_</span><span class="o">*</span> <span class="n">coC</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
</span><span id="LMAHeureuxPorosityDiff-590"><a href="#LMAHeureuxPorosityDiff-590"><span class="linenos">590</span></a>                   
</span><span id="LMAHeureuxPorosityDiff-591"><a href="#LMAHeureuxPorosityDiff-591"><span class="linenos">591</span></a>                <span class="n">dW_dx</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="n">rhorat</span> <span class="o">*</span> <span class="n">Phi_grad</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">Phi</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="n">F</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="mi">10</span> <span class="o">*</span> <span class="p">(</span><span class="n">F</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span>    
</span><span id="LMAHeureuxPorosityDiff-592"><a href="#LMAHeureuxPorosityDiff-592"><span class="linenos">592</span></a>       
</span><span id="LMAHeureuxPorosityDiff-593"><a href="#LMAHeureuxPorosityDiff-593"><span class="linenos">593</span></a>                <span class="c1"># This is dCA_dt</span>
</span><span id="LMAHeureuxPorosityDiff-594"><a href="#LMAHeureuxPorosityDiff-594"><span class="linenos">594</span></a>                <span class="n">rate</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span> <span class="n">U</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="n">CA_grad</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">Da</span> <span class="o">*</span> <span class="p">((</span><span class="mi">1</span> <span class="o">-</span> <span class="n">CA</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> \
</span><span id="LMAHeureuxPorosityDiff-595"><a href="#LMAHeureuxPorosityDiff-595"><span class="linenos">595</span></a>                             <span class="o">*</span> <span class="n">coA</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">lambda_</span> <span class="o">*</span> <span class="n">CA</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="n">coC</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
</span><span id="LMAHeureuxPorosityDiff-596"><a href="#LMAHeureuxPorosityDiff-596"><span class="linenos">596</span></a>
</span><span id="LMAHeureuxPorosityDiff-597"><a href="#LMAHeureuxPorosityDiff-597"><span class="linenos">597</span></a>                <span class="c1"># This is dCC_dt</span>
</span><span id="LMAHeureuxPorosityDiff-598"><a href="#LMAHeureuxPorosityDiff-598"><span class="linenos">598</span></a>                <span class="n">rate</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span> <span class="n">U</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="n">CC_grad</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">Da</span> <span class="o">*</span> <span class="p">(</span><span class="n">lambda_</span> <span class="o">*</span> \
</span><span id="LMAHeureuxPorosityDiff-599"><a href="#LMAHeureuxPorosityDiff-599"><span class="linenos">599</span></a>                             <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">CC</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">*</span> <span class="n">coC</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">CC</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="n">coA</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>              
</span><span id="LMAHeureuxPorosityDiff-600"><a href="#LMAHeureuxPorosityDiff-600"><span class="linenos">600</span></a>
</span><span id="LMAHeureuxPorosityDiff-601"><a href="#LMAHeureuxPorosityDiff-601"><span class="linenos">601</span></a>                <span class="c1"># This is dcCa_dt</span>
</span><span id="LMAHeureuxPorosityDiff-602"><a href="#LMAHeureuxPorosityDiff-602"><span class="linenos">602</span></a>                <span class="n">rate</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span>  <span class="n">helper_cCa_grad</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">/</span><span class="n">Phi</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">W</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> \
</span><span id="LMAHeureuxPorosityDiff-603"><a href="#LMAHeureuxPorosityDiff-603"><span class="linenos">603</span></a>                              <span class="n">cCa_grad</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">Da</span> <span class="o">*</span> <span class="n">one_minus_Phi</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> \
</span><span id="LMAHeureuxPorosityDiff-604"><a href="#LMAHeureuxPorosityDiff-604"><span class="linenos">604</span></a>                              <span class="p">(</span><span class="n">delta</span> <span class="o">-</span> <span class="n">cCa</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">*</span> <span class="n">common_helper3</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> \
</span><span id="LMAHeureuxPorosityDiff-605"><a href="#LMAHeureuxPorosityDiff-605"><span class="linenos">605</span></a>                              <span class="o">/</span><span class="n">Phi</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>                                 
</span><span id="LMAHeureuxPorosityDiff-606"><a href="#LMAHeureuxPorosityDiff-606"><span class="linenos">606</span></a>
</span><span id="LMAHeureuxPorosityDiff-607"><a href="#LMAHeureuxPorosityDiff-607"><span class="linenos">607</span></a>                <span class="c1"># This is dcCO3_dt</span>
</span><span id="LMAHeureuxPorosityDiff-608"><a href="#LMAHeureuxPorosityDiff-608"><span class="linenos">608</span></a>                <span class="n">rate</span><span class="p">[</span><span class="mi">3</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span>  <span class="n">helper_cCO3_grad</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">/</span><span class="n">Phi</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">W</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> \
</span><span id="LMAHeureuxPorosityDiff-609"><a href="#LMAHeureuxPorosityDiff-609"><span class="linenos">609</span></a>                              <span class="n">cCO3_grad</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">Da</span> <span class="o">*</span> <span class="n">one_minus_Phi</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> \
</span><span id="LMAHeureuxPorosityDiff-610"><a href="#LMAHeureuxPorosityDiff-610"><span class="linenos">610</span></a>                              <span class="p">(</span><span class="n">delta</span> <span class="o">-</span> <span class="n">cCO3</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">*</span> <span class="n">common_helper3</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> \
</span><span id="LMAHeureuxPorosityDiff-611"><a href="#LMAHeureuxPorosityDiff-611"><span class="linenos">611</span></a>                              <span class="o">/</span><span class="n">Phi</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>                       
</span><span id="LMAHeureuxPorosityDiff-612"><a href="#LMAHeureuxPorosityDiff-612"><span class="linenos">612</span></a>
</span><span id="LMAHeureuxPorosityDiff-613"><a href="#LMAHeureuxPorosityDiff-613"><span class="linenos">613</span></a>                <span class="c1"># This is dPhi_dt</span>
</span><span id="LMAHeureuxPorosityDiff-614"><a href="#LMAHeureuxPorosityDiff-614"><span class="linenos">614</span></a>                <span class="n">rate</span><span class="p">[</span><span class="mi">4</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span> <span class="p">(</span><span class="n">dW_dx</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="n">Phi</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">W</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="n">Phi_grad</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> \
</span><span id="LMAHeureuxPorosityDiff-615"><a href="#LMAHeureuxPorosityDiff-615"><span class="linenos">615</span></a>                             <span class="o">+</span> <span class="n">dPhi</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="n">Phi_laplace</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">Da</span> <span class="o">*</span> <span class="n">one_minus_Phi</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> \
</span><span id="LMAHeureuxPorosityDiff-616"><a href="#LMAHeureuxPorosityDiff-616"><span class="linenos">616</span></a>                             <span class="o">*</span> <span class="n">common_helper3</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> 
</span><span id="LMAHeureuxPorosityDiff-617"><a href="#LMAHeureuxPorosityDiff-617"><span class="linenos">617</span></a>
</span><span id="LMAHeureuxPorosityDiff-618"><a href="#LMAHeureuxPorosityDiff-618"><span class="linenos">618</span></a>            <span class="k">return</span> <span class="n">rate</span>
</span><span id="LMAHeureuxPorosityDiff-619"><a href="#LMAHeureuxPorosityDiff-619"><span class="linenos">619</span></a>
</span><span id="LMAHeureuxPorosityDiff-620"><a href="#LMAHeureuxPorosityDiff-620"><span class="linenos">620</span></a>        <span class="k">return</span> <span class="n">pde_rhs</span> 
</span></pre></div>


            <div class="docstring"><p>Sets all the physical parameters that define the model.</p>
</div>


                            <div id="LMAHeureuxPorosityDiff.AragoniteSurface" class="classattr">
                                <div class="attr variable">
            <span class="name">AragoniteSurface</span>

        
    </div>
    <a class="headerlink" href="#LMAHeureuxPorosityDiff.AragoniteSurface"></a>
    
            <div class="docstring"><p>(<em>pde.ScalarField</em>):<br />
Initial distribution of aragonite composition along all depths
(dimensionless).</p>
</div>


                            </div>
                            <div id="LMAHeureuxPorosityDiff.CalciteSurface" class="classattr">
                                <div class="attr variable">
            <span class="name">CalciteSurface</span>

        
    </div>
    <a class="headerlink" href="#LMAHeureuxPorosityDiff.CalciteSurface"></a>
    
            <div class="docstring"><p>(<em>pde.ScalarField</em>):<br />
Initial distribution of calcite composition along all depths
(dimensionless).</p>
</div>


                            </div>
                            <div id="LMAHeureuxPorosityDiff.CaSurface" class="classattr">
                                <div class="attr variable">
            <span class="name">CaSurface</span>

        
    </div>
    <a class="headerlink" href="#LMAHeureuxPorosityDiff.CaSurface"></a>
    
            <div class="docstring"><p>(<em>pde.Scalarfield</em>):<br />
Initial distribution of calcium ions concentration along all depths
(dimensionless).</p>
</div>


                            </div>
                            <div id="LMAHeureuxPorosityDiff.CO3Surface" class="classattr">
                                <div class="attr variable">
            <span class="name">CO3Surface</span>

        
    </div>
    <a class="headerlink" href="#LMAHeureuxPorosityDiff.CO3Surface"></a>
    
            <div class="docstring"><p>(<em>pde.ScalarField</em>):<br />
Initial distribution of carbonate ions concentration along all depths
(dimensionless).</p>
</div>


                            </div>
                            <div id="LMAHeureuxPorosityDiff.PorSurface" class="classattr">
                                <div class="attr variable">
            <span class="name">PorSurface</span>

        
    </div>
    <a class="headerlink" href="#LMAHeureuxPorosityDiff.PorSurface"></a>
    
            <div class="docstring"><p>(<em>pde.ScalarField</em>):<br />
Initial distribution of porosity along all depths (dimensionless).</p>
</div>


                            </div>
                            <div id="LMAHeureuxPorosityDiff.bc_CA" class="classattr">
                                <div class="attr variable">
            <span class="name">bc_CA</span>

        
    </div>
    <a class="headerlink" href="#LMAHeureuxPorosityDiff.bc_CA"></a>
    
            <div class="docstring"><p>Top and bottom  boundary condition for aragonite.<br />
<strong>CA0</strong> (<em>float</em>):<br />
Aragonite composition at the top of the system, i.e. at the 
water-sediment interface (dimensionless).</p>
</div>


                            </div>
                            <div id="LMAHeureuxPorosityDiff.bc_CC" class="classattr">
                                <div class="attr variable">
            <span class="name">bc_CC</span>

        
    </div>
    <a class="headerlink" href="#LMAHeureuxPorosityDiff.bc_CC"></a>
    
            <div class="docstring"><p>Top and bottom  boundary condition for calcite.<br />
<strong>CC0</strong> (<em>float</em>):<br />
Calcite composition at the top of the system, i.e. at the 
water-sediment interface (dimensionless).</p>
</div>


                            </div>
                            <div id="LMAHeureuxPorosityDiff.bc_cCa" class="classattr">
                                <div class="attr variable">
            <span class="name">bc_cCa</span>

        
    </div>
    <a class="headerlink" href="#LMAHeureuxPorosityDiff.bc_cCa"></a>
    
            <div class="docstring"><p>Top and bottom  boundary condition for the concentration of
calcium ions.<br />
<strong>cCa0</strong> (<em>float</em>):<br />
Calcium ion concentration at the top of the system, i.e. at the 
water-sediment interface (dimensionless).</p>
</div>


                            </div>
                            <div id="LMAHeureuxPorosityDiff.bc_cCO3" class="classattr">
                                <div class="attr variable">
            <span class="name">bc_cCO3</span>

        
    </div>
    <a class="headerlink" href="#LMAHeureuxPorosityDiff.bc_cCO3"></a>
    
            <div class="docstring"><p>Top and bottom  boundary condition for the concentration of
carbonate ions.<br />
<strong>cCO30</strong> (<em>float</em>):<br />
Carbonate ion concentration at the top of the system, i.e. at the
water-sediment interface (dimensionless).</p>
</div>


                            </div>
                            <div id="LMAHeureuxPorosityDiff.bc_Phi" class="classattr">
                                <div class="attr variable">
            <span class="name">bc_Phi</span>

        
    </div>
    <a class="headerlink" href="#LMAHeureuxPorosityDiff.bc_Phi"></a>
    
            <div class="docstring"><p>Top and bottom  boundary condition for the porosity.<br />
<strong>Phi0</strong> (<em>float</em>):<br />
Porosity at the top of the system, i.e. at the water-sediment 
interface (dimensionless).</p>
</div>


                            </div>
                            <div id="LMAHeureuxPorosityDiff.sedimentationrate" class="classattr">
                                <div class="attr variable">
            <span class="name">sedimentationrate</span>

        
    </div>
    <a class="headerlink" href="#LMAHeureuxPorosityDiff.sedimentationrate"></a>
    
            <div class="docstring"><p>(<em>float</em>):<br />
Sedimentation rate (cm/a).</p>
</div>


                            </div>
                            <div id="LMAHeureuxPorosityDiff.Xstar" class="classattr">
                                <div class="attr variable">
            <span class="name">Xstar</span>

        
    </div>
    <a class="headerlink" href="#LMAHeureuxPorosityDiff.Xstar"></a>
    
            <div class="docstring"><p>(<em>float</em>):<br />
Scaling factor between physical depths and dimensionless depths as
used in the differential equations, in cm.</p>
</div>


                            </div>
                            <div id="LMAHeureuxPorosityDiff.Tstar" class="classattr">
                                <div class="attr variable">
            <span class="name">Tstar</span>

        
    </div>
    <a class="headerlink" href="#LMAHeureuxPorosityDiff.Tstar"></a>
    
            <div class="docstring"><p>(<em>float</em>):<br />
Scaling factor between physical time and dimensionless time as
used in the differential equations, in years.</p>
</div>


                            </div>
                            <div id="LMAHeureuxPorosityDiff.k1" class="classattr">
                                <div class="attr variable">
            <span class="name">k1</span>

        
    </div>
    <a class="headerlink" href="#LMAHeureuxPorosityDiff.k1"></a>
    
            <div class="docstring"><p>(<em>float</em>):<br />
rate coefficient (1/a).</p>
</div>


                            </div>
                            <div id="LMAHeureuxPorosityDiff.k2" class="classattr">
                                <div class="attr variable">
            <span class="name">k2</span>

        
    </div>
    <a class="headerlink" href="#LMAHeureuxPorosityDiff.k2"></a>
    
            <div class="docstring"><p>(<em>float</em>):<br />
rate coefficient (1/a).</p>
</div>


                            </div>
                            <div id="LMAHeureuxPorosityDiff.k3" class="classattr">
                                <div class="attr variable">
            <span class="name">k3</span>

        
    </div>
    <a class="headerlink" href="#LMAHeureuxPorosityDiff.k3"></a>
    
            <div class="docstring"><p>(<em>float</em>):<br />
rate coefficient (1/a).</p>
</div>


                            </div>
                            <div id="LMAHeureuxPorosityDiff.k4" class="classattr">
                                <div class="attr variable">
            <span class="name">k4</span>

        
    </div>
    <a class="headerlink" href="#LMAHeureuxPorosityDiff.k4"></a>
    
            <div class="docstring"><p>(<em>float</em>):<br />
rate coefficient (1/a).</p>
</div>


                            </div>
                            <div id="LMAHeureuxPorosityDiff.m1" class="classattr">
                                <div class="attr variable">
            <span class="name">m1</span>

        
    </div>
    <a class="headerlink" href="#LMAHeureuxPorosityDiff.m1"></a>
    
            <div class="docstring"><p>(<em>float</em>):<br />
Exponent of the reaction term for aragonite precipation.</p>
</div>


                            </div>
                            <div id="LMAHeureuxPorosityDiff.m2" class="classattr">
                                <div class="attr variable">
            <span class="name">m2</span>

        
    </div>
    <a class="headerlink" href="#LMAHeureuxPorosityDiff.m2"></a>
    
            <div class="docstring"><p>(<em>float</em>):<br />
Exponent of the reaction term for aragonite dissolution.</p>
</div>


                            </div>
                            <div id="LMAHeureuxPorosityDiff.n1" class="classattr">
                                <div class="attr variable">
            <span class="name">n1</span>

        
    </div>
    <a class="headerlink" href="#LMAHeureuxPorosityDiff.n1"></a>
    
            <div class="docstring"><p>(<em>float</em>):<br />
Exponent of the reaction term for calcite precipation.</p>
</div>


                            </div>
                            <div id="LMAHeureuxPorosityDiff.n2" class="classattr">
                                <div class="attr variable">
            <span class="name">n2</span>

        
    </div>
    <a class="headerlink" href="#LMAHeureuxPorosityDiff.n2"></a>
    
            <div class="docstring"><p>(<em>float</em>):<br />
Exponent of the reaction term for calcite dissolution.</p>
</div>


                            </div>
                            <div id="LMAHeureuxPorosityDiff.b" class="classattr">
                                <div class="attr variable">
            <span class="name">b</span>

        
    </div>
    <a class="headerlink" href="#LMAHeureuxPorosityDiff.b"></a>
    
            <div class="docstring"><p>(<em>float</em>):<br />
Sediment compressibility (1/(kPa) in SI or 0.1/kBa in cgs).</p>
</div>


                            </div>
                            <div id="LMAHeureuxPorosityDiff.beta" class="classattr">
                                <div class="attr variable">
            <span class="name">beta</span>

        
    </div>
    <a class="headerlink" href="#LMAHeureuxPorosityDiff.beta"></a>
    
            <div class="docstring"><p>(<em>float</em>):<br />
Constant in the hydraulic conductivity (cm/a).</p>
</div>


                            </div>
                            <div id="LMAHeureuxPorosityDiff.rhos" class="classattr">
                                <div class="attr variable">
            <span class="name">rhos</span>

        
    </div>
    <a class="headerlink" href="#LMAHeureuxPorosityDiff.rhos"></a>
    
            <div class="docstring"><p>(<em>float</em>):<br />
Total solid density (g/cm³).</p>
</div>


                            </div>
                            <div id="LMAHeureuxPorosityDiff.rhow" class="classattr">
                                <div class="attr variable">
            <span class="name">rhow</span>

        
    </div>
    <a class="headerlink" href="#LMAHeureuxPorosityDiff.rhow"></a>
    
            <div class="docstring"><p>(<em>float</em>):<br />
Density of water (g/cm³).</p>
</div>


                            </div>
                            <div id="LMAHeureuxPorosityDiff.rhos0" class="classattr">
                                <div class="attr variable">
            <span class="name">rhos0</span>

        
    </div>
    <a class="headerlink" href="#LMAHeureuxPorosityDiff.rhos0"></a>
    
            <div class="docstring"><p>(<em>float</em>):<br />
Initial value of the total solid density (g/cm³).</p>
</div>


                            </div>
                            <div id="LMAHeureuxPorosityDiff.KA" class="classattr">
                                <div class="attr variable">
            <span class="name">KA</span>

        
    </div>
    <a class="headerlink" href="#LMAHeureuxPorosityDiff.KA"></a>
    
            <div class="docstring"><p>(<em>float</em>):<br />
Solubility of aragonite (M²).</p>
</div>


                            </div>
                            <div id="LMAHeureuxPorosityDiff.KC" class="classattr">
                                <div class="attr variable">
            <span class="name">KC</span>

        
    </div>
    <a class="headerlink" href="#LMAHeureuxPorosityDiff.KC"></a>
    
            <div class="docstring"><p>(<em>float</em>):<br />
Solubility of calcite (M²).</p>
</div>


                            </div>
                            <div id="LMAHeureuxPorosityDiff.muA" class="classattr">
                                <div class="attr variable">
            <span class="name">muA</span>

        
    </div>
    <a class="headerlink" href="#LMAHeureuxPorosityDiff.muA"></a>
    
            <div class="docstring"><p>(<em>float</em>):<br />
Molar mass of calcite and aragonite (g/mol).</p>
</div>


                            </div>
                            <div id="LMAHeureuxPorosityDiff.D0Ca" class="classattr">
                                <div class="attr variable">
            <span class="name">D0Ca</span>

        
    </div>
    <a class="headerlink" href="#LMAHeureuxPorosityDiff.D0Ca"></a>
    
            <div class="docstring"><p>(<em>float</em>):<br />
Molecular diffusion coefficient of calcium ions in water (cm²/a).</p>
</div>


                            </div>
                            <div id="LMAHeureuxPorosityDiff.PhiNR" class="classattr">
                                <div class="attr variable">
            <span class="name">PhiNR</span>

        
    </div>
    <a class="headerlink" href="#LMAHeureuxPorosityDiff.PhiNR"></a>
    
            <div class="docstring"><p>(<em>float</em>):<br />
Stationary unreactive system porosity (dimensionless).</p>
</div>


                            </div>
                            <div id="LMAHeureuxPorosityDiff.PhiInfty" class="classattr">
                                <div class="attr variable">
            <span class="name">PhiInfty</span>

        
    </div>
    <a class="headerlink" href="#LMAHeureuxPorosityDiff.PhiInfty"></a>
    
            <div class="docstring"><p>(<em>float</em>):<br />
Parameter in equation 23 from L'Heureux (dimensionless).</p>
</div>


                            </div>
                            <div id="LMAHeureuxPorosityDiff.DCa" class="classattr">
                                <div class="attr variable">
            <span class="name">DCa</span>

        
    </div>
    <a class="headerlink" href="#LMAHeureuxPorosityDiff.DCa"></a>
    
            <div class="docstring"><p>(<em>float</em>):<br />
Molecular diffusion coefficient of calcium ions in the sediment 
(cm²/a).</p>
</div>


                            </div>
                            <div id="LMAHeureuxPorosityDiff.DCO3" class="classattr">
                                <div class="attr variable">
            <span class="name">DCO3</span>

        
    </div>
    <a class="headerlink" href="#LMAHeureuxPorosityDiff.DCO3"></a>
    
            <div class="docstring"><p>(<em>float</em>):<br />
Molecular diffusion coefficient of carbonate ions in the sediment 
(cm²/a).</p>
</div>


                            </div>
                            <div id="LMAHeureuxPorosityDiff.not_too_shallow" class="classattr">
                                <div class="attr variable">
            <span class="name">not_too_shallow</span>

        
    </div>
    <a class="headerlink" href="#LMAHeureuxPorosityDiff.not_too_shallow"></a>
    
            <div class="docstring"><p>(<em>pde.Scalarfield</em>):<br />
Heaviside step function that is zero above the upper edge of the 
aragonite dissolution zone (ADZ) and 1 below that edge.</p>
</div>


                            </div>
                            <div id="LMAHeureuxPorosityDiff.not_too_deep" class="classattr">
                                <div class="attr variable">
            <span class="name">not_too_deep</span>

        
    </div>
    <a class="headerlink" href="#LMAHeureuxPorosityDiff.not_too_deep"></a>
    
            <div class="docstring"><p>(<em>pde.Scalarfield</em>):<br />
Heaviside step function that is zero below the lower edge of the ADZ
and 1 above it.</p>
</div>


                            </div>
                            <div id="LMAHeureuxPorosityDiff.PhiIni" class="classattr">
                                <div class="attr variable">
            <span class="name">PhiIni</span>

        
    </div>
    <a class="headerlink" href="#LMAHeureuxPorosityDiff.PhiIni"></a>
    
            <div class="docstring"><p><strong>PhiIni</strong> (<em>float</em>):<br />
Initial homogeneous porosity (dimensionless)</p>
</div>


                            </div>
                            <div id="LMAHeureuxPorosityDiff.track_U_at_bottom" class="classattr">
                                        <input id="LMAHeureuxPorosityDiff.track_U_at_bottom-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">track_U_at_bottom</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">state</span>, </span><span class="param"><span class="n">t</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="LMAHeureuxPorosityDiff.track_U_at_bottom-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#LMAHeureuxPorosityDiff.track_U_at_bottom"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="LMAHeureuxPorosityDiff.track_U_at_bottom-262"><a href="#LMAHeureuxPorosityDiff.track_U_at_bottom-262"><span class="linenos">262</span></a>    <span class="k">def</span> <span class="nf">track_U_at_bottom</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">state</span><span class="p">,</span> <span class="n">t</span><span class="p">):</span>
</span><span id="LMAHeureuxPorosityDiff.track_U_at_bottom-263"><a href="#LMAHeureuxPorosityDiff.track_U_at_bottom-263"><span class="linenos">263</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;For recording U, the solid matrix advection field.</span>
</span><span id="LMAHeureuxPorosityDiff.track_U_at_bottom-264"><a href="#LMAHeureuxPorosityDiff.track_U_at_bottom-264"><span class="linenos">264</span></a><span class="sd">        Although U is computed as part of the integration, for recording it,</span>
</span><span id="LMAHeureuxPorosityDiff.track_U_at_bottom-265"><a href="#LMAHeureuxPorosityDiff.track_U_at_bottom-265"><span class="linenos">265</span></a><span class="sd">        we need to rederive it from the porosity at the bottom of the depth </span>
</span><span id="LMAHeureuxPorosityDiff.track_U_at_bottom-266"><a href="#LMAHeureuxPorosityDiff.track_U_at_bottom-266"><span class="linenos">266</span></a><span class="sd">        grid.</span>
</span><span id="LMAHeureuxPorosityDiff.track_U_at_bottom-267"><a href="#LMAHeureuxPorosityDiff.track_U_at_bottom-267"><span class="linenos">267</span></a><span class="sd">          &quot;&quot;&quot;</span>
</span><span id="LMAHeureuxPorosityDiff.track_U_at_bottom-268"><a href="#LMAHeureuxPorosityDiff.track_U_at_bottom-268"><span class="linenos">268</span></a>        <span class="c1"># First, extract the porosity at the bottom of the system.</span>
</span><span id="LMAHeureuxPorosityDiff.track_U_at_bottom-269"><a href="#LMAHeureuxPorosityDiff.track_U_at_bottom-269"><span class="linenos">269</span></a>        <span class="c1"># The derived quantities will then also be at the bottom of the system.</span>
</span><span id="LMAHeureuxPorosityDiff.track_U_at_bottom-270"><a href="#LMAHeureuxPorosityDiff.track_U_at_bottom-270"><span class="linenos">270</span></a>        <span class="n">Phi</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="mi">4</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</span><span id="LMAHeureuxPorosityDiff.track_U_at_bottom-271"><a href="#LMAHeureuxPorosityDiff.track_U_at_bottom-271"><span class="linenos">271</span></a>        <span class="n">F</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="mi">10</span> <span class="o">-</span> <span class="mi">10</span> <span class="o">/</span> <span class="n">Phi</span><span class="p">)</span>
</span><span id="LMAHeureuxPorosityDiff.track_U_at_bottom-272"><a href="#LMAHeureuxPorosityDiff.track_U_at_bottom-272"><span class="linenos">272</span></a>        <span class="n">one_minus_Phi</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">Phi</span>
</span><span id="LMAHeureuxPorosityDiff.track_U_at_bottom-273"><a href="#LMAHeureuxPorosityDiff.track_U_at_bottom-273"><span class="linenos">273</span></a>        <span class="n">U_bottom</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">presum</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">rhorat</span> <span class="o">*</span> <span class="n">Phi</span> <span class="o">**</span> <span class="mi">3</span> <span class="o">*</span> <span class="n">F</span> <span class="o">/</span><span class="n">one_minus_Phi</span>
</span><span id="LMAHeureuxPorosityDiff.track_U_at_bottom-274"><a href="#LMAHeureuxPorosityDiff.track_U_at_bottom-274"><span class="linenos">274</span></a>        <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;U at bottom&quot;</span><span class="p">:</span> <span class="n">U_bottom</span><span class="p">}</span>
</span></pre></div>


            <div class="docstring"><p>For recording U, the solid matrix advection field.
Although U is computed as part of the integration, for recording it,
we need to rederive it from the porosity at the bottom of the depth 
grid.</p>
</div>


                            </div>
                            <div id="LMAHeureuxPorosityDiff.calculate_sigma" class="classattr">
                                        <input id="LMAHeureuxPorosityDiff.calculate_sigma-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator">@staticmethod</div>
        <div class="decorator">@njit</div>

        <span class="def">def</span>
        <span class="name">calculate_sigma</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">Peclet</span>, </span><span class="param"><span class="n">W_data</span>, </span><span class="param"><span class="n">Peclet_min</span>, </span><span class="param"><span class="n">Peclet_max</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="LMAHeureuxPorosityDiff.calculate_sigma-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#LMAHeureuxPorosityDiff.calculate_sigma"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="LMAHeureuxPorosityDiff.calculate_sigma-276"><a href="#LMAHeureuxPorosityDiff.calculate_sigma-276"><span class="linenos">276</span></a>    <span class="nd">@staticmethod</span>
</span><span id="LMAHeureuxPorosityDiff.calculate_sigma-277"><a href="#LMAHeureuxPorosityDiff.calculate_sigma-277"><span class="linenos">277</span></a>    <span class="nd">@njit</span>
</span><span id="LMAHeureuxPorosityDiff.calculate_sigma-278"><a href="#LMAHeureuxPorosityDiff.calculate_sigma-278"><span class="linenos">278</span></a>    <span class="k">def</span> <span class="nf">calculate_sigma</span><span class="p">(</span><span class="n">Peclet</span><span class="p">,</span> <span class="n">W_data</span><span class="p">,</span> <span class="n">Peclet_min</span><span class="p">,</span> <span class="n">Peclet_max</span><span class="p">):</span>
</span><span id="LMAHeureuxPorosityDiff.calculate_sigma-279"><a href="#LMAHeureuxPorosityDiff.calculate_sigma-279"><span class="linenos">279</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot; Calculate sigma following formula 8.73 from Boudreau:</span>
</span><span id="LMAHeureuxPorosityDiff.calculate_sigma-280"><a href="#LMAHeureuxPorosityDiff.calculate_sigma-280"><span class="linenos">280</span></a><span class="sd">        &#39;Diagenetic Models and their implementation&#39;.</span>
</span><span id="LMAHeureuxPorosityDiff.calculate_sigma-281"><a href="#LMAHeureuxPorosityDiff.calculate_sigma-281"><span class="linenos">281</span></a>
</span><span id="LMAHeureuxPorosityDiff.calculate_sigma-282"><a href="#LMAHeureuxPorosityDiff.calculate_sigma-282"><span class="linenos">282</span></a><span class="sd">        Args:</span>
</span><span id="LMAHeureuxPorosityDiff.calculate_sigma-283"><a href="#LMAHeureuxPorosityDiff.calculate_sigma-283"><span class="linenos">283</span></a><span class="sd">        -  **Peclet** (*ndarray(dtype=float, ndim=1)*):</span>
</span><span id="LMAHeureuxPorosityDiff.calculate_sigma-284"><a href="#LMAHeureuxPorosityDiff.calculate_sigma-284"><span class="linenos">284</span></a><span class="sd">           Array along depth of the Peclet numbers.</span>
</span><span id="LMAHeureuxPorosityDiff.calculate_sigma-285"><a href="#LMAHeureuxPorosityDiff.calculate_sigma-285"><span class="linenos">285</span></a><span class="sd">        -  **W-data** (*ndarray(dtype=float, ndim=1)*):</span>
</span><span id="LMAHeureuxPorosityDiff.calculate_sigma-286"><a href="#LMAHeureuxPorosityDiff.calculate_sigma-286"><span class="linenos">286</span></a><span class="sd">           Array along depth of the velocity of the pore water </span>
</span><span id="LMAHeureuxPorosityDiff.calculate_sigma-287"><a href="#LMAHeureuxPorosityDiff.calculate_sigma-287"><span class="linenos">287</span></a><span class="sd">           (counted positive downwards)</span>
</span><span id="LMAHeureuxPorosityDiff.calculate_sigma-288"><a href="#LMAHeureuxPorosityDiff.calculate_sigma-288"><span class="linenos">288</span></a><span class="sd">        -  **Peclet_min** (*float*):</span>
</span><span id="LMAHeureuxPorosityDiff.calculate_sigma-289"><a href="#LMAHeureuxPorosityDiff.calculate_sigma-289"><span class="linenos">289</span></a><span class="sd">           Lower limit for calculating 1/tanh(Peclet)</span>
</span><span id="LMAHeureuxPorosityDiff.calculate_sigma-290"><a href="#LMAHeureuxPorosityDiff.calculate_sigma-290"><span class="linenos">290</span></a><span class="sd">        -  **Peclet_max** (*float*):</span>
</span><span id="LMAHeureuxPorosityDiff.calculate_sigma-291"><a href="#LMAHeureuxPorosityDiff.calculate_sigma-291"><span class="linenos">291</span></a><span class="sd">           Upper limit for calculating 1/tanh(Peclet)</span>
</span><span id="LMAHeureuxPorosityDiff.calculate_sigma-292"><a href="#LMAHeureuxPorosityDiff.calculate_sigma-292"><span class="linenos">292</span></a>
</span><span id="LMAHeureuxPorosityDiff.calculate_sigma-293"><a href="#LMAHeureuxPorosityDiff.calculate_sigma-293"><span class="linenos">293</span></a><span class="sd">        Returns</span>
</span><span id="LMAHeureuxPorosityDiff.calculate_sigma-294"><a href="#LMAHeureuxPorosityDiff.calculate_sigma-294"><span class="linenos">294</span></a><span class="sd">        -  **sigma** (*ndarray(dtype=float, ndim=1)*):</span>
</span><span id="LMAHeureuxPorosityDiff.calculate_sigma-295"><a href="#LMAHeureuxPorosityDiff.calculate_sigma-295"><span class="linenos">295</span></a><span class="sd">           Array along depth with sigma values</span>
</span><span id="LMAHeureuxPorosityDiff.calculate_sigma-296"><a href="#LMAHeureuxPorosityDiff.calculate_sigma-296"><span class="linenos">296</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="LMAHeureuxPorosityDiff.calculate_sigma-297"><a href="#LMAHeureuxPorosityDiff.calculate_sigma-297"><span class="linenos">297</span></a>        <span class="n">sigma</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="n">Peclet</span><span class="o">.</span><span class="n">size</span><span class="p">)</span>
</span><span id="LMAHeureuxPorosityDiff.calculate_sigma-298"><a href="#LMAHeureuxPorosityDiff.calculate_sigma-298"><span class="linenos">298</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">sigma</span><span class="o">.</span><span class="n">size</span><span class="p">):</span>
</span><span id="LMAHeureuxPorosityDiff.calculate_sigma-299"><a href="#LMAHeureuxPorosityDiff.calculate_sigma-299"><span class="linenos">299</span></a>            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">Peclet</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">&lt;</span> <span class="n">Peclet_min</span><span class="p">:</span>
</span><span id="LMAHeureuxPorosityDiff.calculate_sigma-300"><a href="#LMAHeureuxPorosityDiff.calculate_sigma-300"><span class="linenos">300</span></a>                <span class="n">sigma</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="LMAHeureuxPorosityDiff.calculate_sigma-301"><a href="#LMAHeureuxPorosityDiff.calculate_sigma-301"><span class="linenos">301</span></a>            <span class="k">elif</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">Peclet</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">&gt;</span> <span class="n">Peclet_max</span><span class="p">:</span>
</span><span id="LMAHeureuxPorosityDiff.calculate_sigma-302"><a href="#LMAHeureuxPorosityDiff.calculate_sigma-302"><span class="linenos">302</span></a>                <span class="n">sigma</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sign</span><span class="p">(</span><span class="n">W_data</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
</span><span id="LMAHeureuxPorosityDiff.calculate_sigma-303"><a href="#LMAHeureuxPorosityDiff.calculate_sigma-303"><span class="linenos">303</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="LMAHeureuxPorosityDiff.calculate_sigma-304"><a href="#LMAHeureuxPorosityDiff.calculate_sigma-304"><span class="linenos">304</span></a>                <span class="n">sigma</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cosh</span><span class="p">(</span><span class="n">Peclet</span><span class="p">[</span><span class="n">i</span><span class="p">])</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sinh</span><span class="p">(</span><span class="n">Peclet</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">-</span> \
</span><span id="LMAHeureuxPorosityDiff.calculate_sigma-305"><a href="#LMAHeureuxPorosityDiff.calculate_sigma-305"><span class="linenos">305</span></a>                    <span class="mi">1</span><span class="o">/</span><span class="n">Peclet</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
</span><span id="LMAHeureuxPorosityDiff.calculate_sigma-306"><a href="#LMAHeureuxPorosityDiff.calculate_sigma-306"><span class="linenos">306</span></a>        <span class="k">return</span> <span class="n">sigma</span>
</span></pre></div>


            <div class="docstring"><p>Calculate sigma following formula 8.73 from Boudreau:
'Diagenetic Models and their implementation'.</p>

<p>Args:</p>

<ul>
<li><strong>Peclet</strong> (<em>ndarray(dtype=float, ndim=1)</em>):
Array along depth of the Peclet numbers.</li>
<li><strong>W-data</strong> (<em>ndarray(dtype=float, ndim=1)</em>):
Array along depth of the velocity of the pore water 
(counted positive downwards)</li>
<li><strong>Peclet_min</strong> (<em>float</em>):
Lower limit for calculating 1/tanh(Peclet)</li>
<li><strong>Peclet_max</strong> (<em>float</em>):
Upper limit for calculating 1/tanh(Peclet)</li>
</ul>

<p>Returns</p>

<ul>
<li><strong>sigma</strong> (<em>ndarray(dtype=float, ndim=1)</em>):
Array along depth with sigma values</li>
</ul>
</div>


                            </div>
                            <div id="LMAHeureuxPorosityDiff.evolution_rate" class="classattr">
                                        <input id="LMAHeureuxPorosityDiff.evolution_rate-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">evolution_rate</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">state</span>, </span><span class="param"><span class="n">t</span><span class="o">=</span><span class="mi">0</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="LMAHeureuxPorosityDiff.evolution_rate-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#LMAHeureuxPorosityDiff.evolution_rate"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="LMAHeureuxPorosityDiff.evolution_rate-308"><a href="#LMAHeureuxPorosityDiff.evolution_rate-308"><span class="linenos">308</span></a>    <span class="k">def</span> <span class="nf">evolution_rate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">state</span><span class="p">,</span> <span class="n">t</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
</span><span id="LMAHeureuxPorosityDiff.evolution_rate-309"><a href="#LMAHeureuxPorosityDiff.evolution_rate-309"><span class="linenos">309</span></a>        <span class="n">CA</span><span class="p">,</span> <span class="n">CC</span><span class="p">,</span> <span class="n">cCa</span><span class="p">,</span> <span class="n">cCO3</span><span class="p">,</span> <span class="n">Phi</span> <span class="o">=</span> <span class="n">state</span>   
</span><span id="LMAHeureuxPorosityDiff.evolution_rate-310"><a href="#LMAHeureuxPorosityDiff.evolution_rate-310"><span class="linenos">310</span></a>
</span><span id="LMAHeureuxPorosityDiff.evolution_rate-311"><a href="#LMAHeureuxPorosityDiff.evolution_rate-311"><span class="linenos">311</span></a>        <span class="n">two_factors</span> <span class="o">=</span> <span class="n">cCa</span> <span class="o">*</span> <span class="n">cCO3</span>
</span><span id="LMAHeureuxPorosityDiff.evolution_rate-312"><a href="#LMAHeureuxPorosityDiff.evolution_rate-312"><span class="linenos">312</span></a>        <span class="n">two_factors_upp_lim</span> <span class="o">=</span> <span class="n">two_factors</span><span class="o">.</span><span class="n">to_scalar</span><span class="p">(</span><span class="k">lambda</span> <span class="n">f</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">fmin</span><span class="p">(</span><span class="n">f</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span>
</span><span id="LMAHeureuxPorosityDiff.evolution_rate-313"><a href="#LMAHeureuxPorosityDiff.evolution_rate-313"><span class="linenos">313</span></a>        <span class="n">two_factors_low_lim</span> <span class="o">=</span> <span class="n">two_factors</span><span class="o">.</span><span class="n">to_scalar</span><span class="p">(</span><span class="k">lambda</span> <span class="n">f</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">fmax</span><span class="p">(</span><span class="n">f</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span>
</span><span id="LMAHeureuxPorosityDiff.evolution_rate-314"><a href="#LMAHeureuxPorosityDiff.evolution_rate-314"><span class="linenos">314</span></a>
</span><span id="LMAHeureuxPorosityDiff.evolution_rate-315"><a href="#LMAHeureuxPorosityDiff.evolution_rate-315"><span class="linenos">315</span></a>        <span class="n">three_factors</span> <span class="o">=</span> <span class="n">two_factors</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">KRat</span>
</span><span id="LMAHeureuxPorosityDiff.evolution_rate-316"><a href="#LMAHeureuxPorosityDiff.evolution_rate-316"><span class="linenos">316</span></a>        <span class="n">three_factors_upp_lim</span> <span class="o">=</span> <span class="n">three_factors</span><span class="o">.</span><span class="n">to_scalar</span><span class="p">(</span><span class="k">lambda</span> <span class="n">f</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">fmin</span><span class="p">(</span><span class="n">f</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span>
</span><span id="LMAHeureuxPorosityDiff.evolution_rate-317"><a href="#LMAHeureuxPorosityDiff.evolution_rate-317"><span class="linenos">317</span></a>        <span class="n">three_factors_low_lim</span> <span class="o">=</span> <span class="n">three_factors</span><span class="o">.</span><span class="n">to_scalar</span><span class="p">(</span><span class="k">lambda</span> <span class="n">f</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">fmax</span><span class="p">(</span><span class="n">f</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span>
</span><span id="LMAHeureuxPorosityDiff.evolution_rate-318"><a href="#LMAHeureuxPorosityDiff.evolution_rate-318"><span class="linenos">318</span></a>
</span><span id="LMAHeureuxPorosityDiff.evolution_rate-319"><a href="#LMAHeureuxPorosityDiff.evolution_rate-319"><span class="linenos">319</span></a>        <span class="n">coA</span> <span class="o">=</span> <span class="n">CA</span> <span class="o">*</span> <span class="p">(((</span><span class="mi">1</span> <span class="o">-</span> <span class="n">three_factors_upp_lim</span><span class="p">)</span> <span class="o">**</span> <span class="bp">self</span><span class="o">.</span><span class="n">m2</span><span class="p">)</span> <span class="o">*</span> \
</span><span id="LMAHeureuxPorosityDiff.evolution_rate-320"><a href="#LMAHeureuxPorosityDiff.evolution_rate-320"><span class="linenos">320</span></a>                    <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">not_too_deep</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">not_too_shallow</span><span class="p">)</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">nu1</span> <span class="o">*</span> \
</span><span id="LMAHeureuxPorosityDiff.evolution_rate-321"><a href="#LMAHeureuxPorosityDiff.evolution_rate-321"><span class="linenos">321</span></a>                    <span class="p">(</span><span class="n">three_factors_low_lim</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">**</span> <span class="bp">self</span><span class="o">.</span><span class="n">m1</span><span class="p">)</span>
</span><span id="LMAHeureuxPorosityDiff.evolution_rate-322"><a href="#LMAHeureuxPorosityDiff.evolution_rate-322"><span class="linenos">322</span></a> 
</span><span id="LMAHeureuxPorosityDiff.evolution_rate-323"><a href="#LMAHeureuxPorosityDiff.evolution_rate-323"><span class="linenos">323</span></a>        <span class="n">coC</span> <span class="o">=</span> <span class="n">CC</span> <span class="o">*</span> <span class="p">(((</span><span class="n">two_factors_low_lim</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">**</span> <span class="bp">self</span><span class="o">.</span><span class="n">n1</span><span class="p">)</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">nu2</span> <span class="o">*</span> \
</span><span id="LMAHeureuxPorosityDiff.evolution_rate-324"><a href="#LMAHeureuxPorosityDiff.evolution_rate-324"><span class="linenos">324</span></a>                    <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">two_factors_upp_lim</span><span class="p">)</span> <span class="o">**</span> <span class="bp">self</span><span class="o">.</span><span class="n">n2</span><span class="p">)</span>
</span><span id="LMAHeureuxPorosityDiff.evolution_rate-325"><a href="#LMAHeureuxPorosityDiff.evolution_rate-325"><span class="linenos">325</span></a>
</span><span id="LMAHeureuxPorosityDiff.evolution_rate-326"><a href="#LMAHeureuxPorosityDiff.evolution_rate-326"><span class="linenos">326</span></a>        <span class="n">F</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="mi">10</span> <span class="o">-</span> <span class="mi">10</span> <span class="o">/</span> <span class="n">Phi</span><span class="p">)</span>
</span><span id="LMAHeureuxPorosityDiff.evolution_rate-327"><a href="#LMAHeureuxPorosityDiff.evolution_rate-327"><span class="linenos">327</span></a>        <span class="n">one_minus_Phi</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">Phi</span>
</span><span id="LMAHeureuxPorosityDiff.evolution_rate-328"><a href="#LMAHeureuxPorosityDiff.evolution_rate-328"><span class="linenos">328</span></a>        <span class="n">U</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">presum</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">rhorat</span> <span class="o">*</span> <span class="n">Phi</span> <span class="o">**</span> <span class="mi">3</span> <span class="o">*</span> <span class="n">F</span> <span class="o">/</span><span class="n">one_minus_Phi</span>
</span><span id="LMAHeureuxPorosityDiff.evolution_rate-329"><a href="#LMAHeureuxPorosityDiff.evolution_rate-329"><span class="linenos">329</span></a>
</span><span id="LMAHeureuxPorosityDiff.evolution_rate-330"><a href="#LMAHeureuxPorosityDiff.evolution_rate-330"><span class="linenos">330</span></a>        <span class="c1"># Choose either forward or backward differencing for CA and CC</span>
</span><span id="LMAHeureuxPorosityDiff.evolution_rate-331"><a href="#LMAHeureuxPorosityDiff.evolution_rate-331"><span class="linenos">331</span></a>        <span class="c1"># depending on the sign of U</span>
</span><span id="LMAHeureuxPorosityDiff.evolution_rate-332"><a href="#LMAHeureuxPorosityDiff.evolution_rate-332"><span class="linenos">332</span></a>
</span><span id="LMAHeureuxPorosityDiff.evolution_rate-333"><a href="#LMAHeureuxPorosityDiff.evolution_rate-333"><span class="linenos">333</span></a>        <span class="n">CA_grad_back</span> <span class="o">=</span> <span class="n">CA</span><span class="o">.</span><span class="n">apply_operator</span><span class="p">(</span><span class="s2">&quot;grad_back&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">bc_CA</span><span class="p">)</span>
</span><span id="LMAHeureuxPorosityDiff.evolution_rate-334"><a href="#LMAHeureuxPorosityDiff.evolution_rate-334"><span class="linenos">334</span></a>        <span class="n">CA_grad_forw</span> <span class="o">=</span> <span class="n">CA</span><span class="o">.</span><span class="n">apply_operator</span><span class="p">(</span><span class="s2">&quot;grad_forw&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">bc_CA</span><span class="p">)</span>
</span><span id="LMAHeureuxPorosityDiff.evolution_rate-335"><a href="#LMAHeureuxPorosityDiff.evolution_rate-335"><span class="linenos">335</span></a>        <span class="n">CA_grad</span> <span class="o">=</span> <span class="n">ScalarField</span><span class="p">(</span><span class="n">state</span><span class="o">.</span><span class="n">grid</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">U</span><span class="o">.</span><span class="n">data</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">,</span> <span class="n">CA_grad_back</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> \
</span><span id="LMAHeureuxPorosityDiff.evolution_rate-336"><a href="#LMAHeureuxPorosityDiff.evolution_rate-336"><span class="linenos">336</span></a>            <span class="n">CA_grad_forw</span><span class="o">.</span><span class="n">data</span><span class="p">))</span>
</span><span id="LMAHeureuxPorosityDiff.evolution_rate-337"><a href="#LMAHeureuxPorosityDiff.evolution_rate-337"><span class="linenos">337</span></a>
</span><span id="LMAHeureuxPorosityDiff.evolution_rate-338"><a href="#LMAHeureuxPorosityDiff.evolution_rate-338"><span class="linenos">338</span></a>        <span class="n">CC_grad_back</span> <span class="o">=</span> <span class="n">CC</span><span class="o">.</span><span class="n">apply_operator</span><span class="p">(</span><span class="s2">&quot;grad_back&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">bc_CC</span><span class="p">)</span>
</span><span id="LMAHeureuxPorosityDiff.evolution_rate-339"><a href="#LMAHeureuxPorosityDiff.evolution_rate-339"><span class="linenos">339</span></a>        <span class="n">CC_grad_forw</span> <span class="o">=</span> <span class="n">CC</span><span class="o">.</span><span class="n">apply_operator</span><span class="p">(</span><span class="s2">&quot;grad_forw&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">bc_CC</span><span class="p">)</span>
</span><span id="LMAHeureuxPorosityDiff.evolution_rate-340"><a href="#LMAHeureuxPorosityDiff.evolution_rate-340"><span class="linenos">340</span></a>        <span class="n">CC_grad</span> <span class="o">=</span> <span class="n">ScalarField</span><span class="p">(</span><span class="n">state</span><span class="o">.</span><span class="n">grid</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">U</span><span class="o">.</span><span class="n">data</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">,</span> <span class="n">CC_grad_back</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> \
</span><span id="LMAHeureuxPorosityDiff.evolution_rate-341"><a href="#LMAHeureuxPorosityDiff.evolution_rate-341"><span class="linenos">341</span></a>            <span class="n">CC_grad_forw</span><span class="o">.</span><span class="n">data</span><span class="p">))</span>
</span><span id="LMAHeureuxPorosityDiff.evolution_rate-342"><a href="#LMAHeureuxPorosityDiff.evolution_rate-342"><span class="linenos">342</span></a>
</span><span id="LMAHeureuxPorosityDiff.evolution_rate-343"><a href="#LMAHeureuxPorosityDiff.evolution_rate-343"><span class="linenos">343</span></a>        <span class="n">W</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">presum</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">rhorat</span> <span class="o">*</span> <span class="n">Phi</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">F</span>
</span><span id="LMAHeureuxPorosityDiff.evolution_rate-344"><a href="#LMAHeureuxPorosityDiff.evolution_rate-344"><span class="linenos">344</span></a>        
</span><span id="LMAHeureuxPorosityDiff.evolution_rate-345"><a href="#LMAHeureuxPorosityDiff.evolution_rate-345"><span class="linenos">345</span></a>        <span class="n">dCA_dt</span> <span class="o">=</span> <span class="o">-</span> <span class="n">U</span> <span class="o">*</span> <span class="n">CA_grad</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">Da</span> <span class="o">*</span> <span class="p">((</span><span class="mi">1</span> <span class="o">-</span> <span class="n">CA</span><span class="p">)</span> \
</span><span id="LMAHeureuxPorosityDiff.evolution_rate-346"><a href="#LMAHeureuxPorosityDiff.evolution_rate-346"><span class="linenos">346</span></a>                 <span class="o">*</span> <span class="n">coA</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">lambda_</span> <span class="o">*</span> <span class="n">CA</span> <span class="o">*</span> <span class="n">coC</span><span class="p">)</span>
</span><span id="LMAHeureuxPorosityDiff.evolution_rate-347"><a href="#LMAHeureuxPorosityDiff.evolution_rate-347"><span class="linenos">347</span></a>
</span><span id="LMAHeureuxPorosityDiff.evolution_rate-348"><a href="#LMAHeureuxPorosityDiff.evolution_rate-348"><span class="linenos">348</span></a>        <span class="n">dCC_dt</span> <span class="o">=</span> <span class="o">-</span> <span class="n">U</span> <span class="o">*</span> <span class="n">CC_grad</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">Da</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lambda_</span> \
</span><span id="LMAHeureuxPorosityDiff.evolution_rate-349"><a href="#LMAHeureuxPorosityDiff.evolution_rate-349"><span class="linenos">349</span></a>                 <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">CC</span><span class="p">)</span> <span class="o">*</span> <span class="n">coC</span> <span class="o">+</span> <span class="n">CC</span> <span class="o">*</span> <span class="n">coA</span><span class="p">)</span>
</span><span id="LMAHeureuxPorosityDiff.evolution_rate-350"><a href="#LMAHeureuxPorosityDiff.evolution_rate-350"><span class="linenos">350</span></a>
</span><span id="LMAHeureuxPorosityDiff.evolution_rate-351"><a href="#LMAHeureuxPorosityDiff.evolution_rate-351"><span class="linenos">351</span></a>        <span class="c1"># Implementing equation 6 from l&#39;Heureux.</span>
</span><span id="LMAHeureuxPorosityDiff.evolution_rate-352"><a href="#LMAHeureuxPorosityDiff.evolution_rate-352"><span class="linenos">352</span></a>        <span class="n">denominator</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">Phi</span><span class="p">)</span>
</span><span id="LMAHeureuxPorosityDiff.evolution_rate-353"><a href="#LMAHeureuxPorosityDiff.evolution_rate-353"><span class="linenos">353</span></a>
</span><span id="LMAHeureuxPorosityDiff.evolution_rate-354"><a href="#LMAHeureuxPorosityDiff.evolution_rate-354"><span class="linenos">354</span></a>        <span class="c1"># Fiadeiro-Veronis scheme for equations 42 and 43</span>
</span><span id="LMAHeureuxPorosityDiff.evolution_rate-355"><a href="#LMAHeureuxPorosityDiff.evolution_rate-355"><span class="linenos">355</span></a>        <span class="c1"># from l&#39;Heureux. </span>
</span><span id="LMAHeureuxPorosityDiff.evolution_rate-356"><a href="#LMAHeureuxPorosityDiff.evolution_rate-356"><span class="linenos">356</span></a>        <span class="n">common_Peclet</span>  <span class="o">=</span> <span class="n">W</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">delta_x</span> <span class="o">/</span> <span class="mf">2.</span> 
</span><span id="LMAHeureuxPorosityDiff.evolution_rate-357"><a href="#LMAHeureuxPorosityDiff.evolution_rate-357"><span class="linenos">357</span></a>        <span class="n">Peclet_cCa</span> <span class="o">=</span>  <span class="n">common_Peclet</span> <span class="o">*</span> <span class="n">denominator</span><span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">dCa</span>       
</span><span id="LMAHeureuxPorosityDiff.evolution_rate-358"><a href="#LMAHeureuxPorosityDiff.evolution_rate-358"><span class="linenos">358</span></a>        <span class="n">sigma_cCa_data</span> <span class="o">=</span> <span class="n">LMAHeureuxPorosityDiff</span><span class="o">.</span><span class="n">calculate_sigma</span><span class="p">(</span>\
</span><span id="LMAHeureuxPorosityDiff.evolution_rate-359"><a href="#LMAHeureuxPorosityDiff.evolution_rate-359"><span class="linenos">359</span></a>            <span class="n">Peclet_cCa</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">W</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Peclet_min</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Peclet_max</span><span class="p">)</span>
</span><span id="LMAHeureuxPorosityDiff.evolution_rate-360"><a href="#LMAHeureuxPorosityDiff.evolution_rate-360"><span class="linenos">360</span></a>        <span class="n">sigma_cCa</span> <span class="o">=</span> <span class="n">ScalarField</span><span class="p">(</span><span class="n">state</span><span class="o">.</span><span class="n">grid</span><span class="p">,</span> <span class="n">sigma_cCa_data</span><span class="p">)</span>
</span><span id="LMAHeureuxPorosityDiff.evolution_rate-361"><a href="#LMAHeureuxPorosityDiff.evolution_rate-361"><span class="linenos">361</span></a>
</span><span id="LMAHeureuxPorosityDiff.evolution_rate-362"><a href="#LMAHeureuxPorosityDiff.evolution_rate-362"><span class="linenos">362</span></a>        <span class="n">Peclet_cCO3</span> <span class="o">=</span> <span class="n">common_Peclet</span> <span class="o">*</span> <span class="n">denominator</span><span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">dCO3</span>      
</span><span id="LMAHeureuxPorosityDiff.evolution_rate-363"><a href="#LMAHeureuxPorosityDiff.evolution_rate-363"><span class="linenos">363</span></a>        <span class="n">sigma_cCO3_data</span> <span class="o">=</span> <span class="n">LMAHeureuxPorosityDiff</span><span class="o">.</span><span class="n">calculate_sigma</span><span class="p">(</span>\
</span><span id="LMAHeureuxPorosityDiff.evolution_rate-364"><a href="#LMAHeureuxPorosityDiff.evolution_rate-364"><span class="linenos">364</span></a>            <span class="n">Peclet_cCO3</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">W</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Peclet_min</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Peclet_max</span><span class="p">)</span>
</span><span id="LMAHeureuxPorosityDiff.evolution_rate-365"><a href="#LMAHeureuxPorosityDiff.evolution_rate-365"><span class="linenos">365</span></a>        <span class="n">sigma_cCO3</span> <span class="o">=</span> <span class="n">ScalarField</span><span class="p">(</span><span class="n">state</span><span class="o">.</span><span class="n">grid</span><span class="p">,</span> <span class="n">sigma_cCO3_data</span><span class="p">)</span>
</span><span id="LMAHeureuxPorosityDiff.evolution_rate-366"><a href="#LMAHeureuxPorosityDiff.evolution_rate-366"><span class="linenos">366</span></a>
</span><span id="LMAHeureuxPorosityDiff.evolution_rate-367"><a href="#LMAHeureuxPorosityDiff.evolution_rate-367"><span class="linenos">367</span></a>        <span class="c1"># dPhi = self.auxcon * F * (Phi ** 3) / one_minus_Phi</span>
</span><span id="LMAHeureuxPorosityDiff.evolution_rate-368"><a href="#LMAHeureuxPorosityDiff.evolution_rate-368"><span class="linenos">368</span></a>        <span class="n">dPhi</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dPhi_fixed</span>
</span><span id="LMAHeureuxPorosityDiff.evolution_rate-369"><a href="#LMAHeureuxPorosityDiff.evolution_rate-369"><span class="linenos">369</span></a>
</span><span id="LMAHeureuxPorosityDiff.evolution_rate-370"><a href="#LMAHeureuxPorosityDiff.evolution_rate-370"><span class="linenos">370</span></a>        <span class="n">Peclet_Phi</span> <span class="o">=</span> <span class="n">common_Peclet</span> <span class="o">/</span> <span class="n">dPhi</span>
</span><span id="LMAHeureuxPorosityDiff.evolution_rate-371"><a href="#LMAHeureuxPorosityDiff.evolution_rate-371"><span class="linenos">371</span></a>        <span class="n">sigma_Phi_data</span> <span class="o">=</span> <span class="n">LMAHeureuxPorosityDiff</span><span class="o">.</span><span class="n">calculate_sigma</span><span class="p">(</span>\
</span><span id="LMAHeureuxPorosityDiff.evolution_rate-372"><a href="#LMAHeureuxPorosityDiff.evolution_rate-372"><span class="linenos">372</span></a>            <span class="n">Peclet_Phi</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">W</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Peclet_min</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Peclet_max</span><span class="p">)</span>
</span><span id="LMAHeureuxPorosityDiff.evolution_rate-373"><a href="#LMAHeureuxPorosityDiff.evolution_rate-373"><span class="linenos">373</span></a>        <span class="n">sigma_Phi</span> <span class="o">=</span> <span class="n">ScalarField</span><span class="p">(</span><span class="n">state</span><span class="o">.</span><span class="n">grid</span><span class="p">,</span> <span class="n">sigma_Phi_data</span><span class="p">)</span>
</span><span id="LMAHeureuxPorosityDiff.evolution_rate-374"><a href="#LMAHeureuxPorosityDiff.evolution_rate-374"><span class="linenos">374</span></a>
</span><span id="LMAHeureuxPorosityDiff.evolution_rate-375"><a href="#LMAHeureuxPorosityDiff.evolution_rate-375"><span class="linenos">375</span></a>        <span class="n">cCa_grad_back</span> <span class="o">=</span> <span class="n">cCa</span><span class="o">.</span><span class="n">apply_operator</span><span class="p">(</span><span class="s2">&quot;grad_back&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">bc_cCa</span><span class="p">)</span>
</span><span id="LMAHeureuxPorosityDiff.evolution_rate-376"><a href="#LMAHeureuxPorosityDiff.evolution_rate-376"><span class="linenos">376</span></a>        <span class="n">cCa_grad_forw</span> <span class="o">=</span> <span class="n">cCa</span><span class="o">.</span><span class="n">apply_operator</span><span class="p">(</span><span class="s2">&quot;grad_forw&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">bc_cCa</span><span class="p">)</span>
</span><span id="LMAHeureuxPorosityDiff.evolution_rate-377"><a href="#LMAHeureuxPorosityDiff.evolution_rate-377"><span class="linenos">377</span></a>        <span class="n">cCa_grad</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">((</span><span class="mi">1</span><span class="o">-</span><span class="n">sigma_cCa</span><span class="p">)</span> <span class="o">*</span> <span class="n">cCa_grad_forw</span> <span class="o">+</span>\
</span><span id="LMAHeureuxPorosityDiff.evolution_rate-378"><a href="#LMAHeureuxPorosityDiff.evolution_rate-378"><span class="linenos">378</span></a>             <span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="n">sigma_cCa</span><span class="p">)</span> <span class="o">*</span> <span class="n">cCa_grad_back</span><span class="p">)</span>
</span><span id="LMAHeureuxPorosityDiff.evolution_rate-379"><a href="#LMAHeureuxPorosityDiff.evolution_rate-379"><span class="linenos">379</span></a>
</span><span id="LMAHeureuxPorosityDiff.evolution_rate-380"><a href="#LMAHeureuxPorosityDiff.evolution_rate-380"><span class="linenos">380</span></a>        <span class="n">cCO3_grad_back</span> <span class="o">=</span> <span class="n">cCO3</span><span class="o">.</span><span class="n">apply_operator</span><span class="p">(</span><span class="s2">&quot;grad_back&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">bc_cCO3</span><span class="p">)</span>
</span><span id="LMAHeureuxPorosityDiff.evolution_rate-381"><a href="#LMAHeureuxPorosityDiff.evolution_rate-381"><span class="linenos">381</span></a>        <span class="n">cCO3_grad_forw</span> <span class="o">=</span> <span class="n">cCO3</span><span class="o">.</span><span class="n">apply_operator</span><span class="p">(</span><span class="s2">&quot;grad_forw&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">bc_cCO3</span><span class="p">)</span>
</span><span id="LMAHeureuxPorosityDiff.evolution_rate-382"><a href="#LMAHeureuxPorosityDiff.evolution_rate-382"><span class="linenos">382</span></a>        <span class="n">cCO3_grad</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">((</span><span class="mi">1</span><span class="o">-</span><span class="n">sigma_cCO3</span><span class="p">)</span> <span class="o">*</span> <span class="n">cCO3_grad_forw</span> <span class="o">+</span>\
</span><span id="LMAHeureuxPorosityDiff.evolution_rate-383"><a href="#LMAHeureuxPorosityDiff.evolution_rate-383"><span class="linenos">383</span></a>             <span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="n">sigma_cCO3</span><span class="p">)</span> <span class="o">*</span> <span class="n">cCO3_grad_back</span><span class="p">)</span>
</span><span id="LMAHeureuxPorosityDiff.evolution_rate-384"><a href="#LMAHeureuxPorosityDiff.evolution_rate-384"><span class="linenos">384</span></a>
</span><span id="LMAHeureuxPorosityDiff.evolution_rate-385"><a href="#LMAHeureuxPorosityDiff.evolution_rate-385"><span class="linenos">385</span></a>        <span class="n">Phi_grad_back</span> <span class="o">=</span> <span class="n">Phi</span><span class="o">.</span><span class="n">apply_operator</span><span class="p">(</span><span class="s2">&quot;grad_back&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">bc_Phi</span><span class="p">)</span>
</span><span id="LMAHeureuxPorosityDiff.evolution_rate-386"><a href="#LMAHeureuxPorosityDiff.evolution_rate-386"><span class="linenos">386</span></a>        <span class="n">Phi_grad_forw</span> <span class="o">=</span> <span class="n">Phi</span><span class="o">.</span><span class="n">apply_operator</span><span class="p">(</span><span class="s2">&quot;grad_forw&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">bc_Phi</span><span class="p">)</span>
</span><span id="LMAHeureuxPorosityDiff.evolution_rate-387"><a href="#LMAHeureuxPorosityDiff.evolution_rate-387"><span class="linenos">387</span></a>        <span class="n">Phi_grad</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">((</span><span class="mi">1</span><span class="o">-</span><span class="n">sigma_Phi</span><span class="p">)</span> <span class="o">*</span> <span class="n">Phi_grad_forw</span> <span class="o">+</span>\
</span><span id="LMAHeureuxPorosityDiff.evolution_rate-388"><a href="#LMAHeureuxPorosityDiff.evolution_rate-388"><span class="linenos">388</span></a>             <span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="n">sigma_Phi</span><span class="p">)</span> <span class="o">*</span> <span class="n">Phi_grad_back</span><span class="p">)</span>
</span><span id="LMAHeureuxPorosityDiff.evolution_rate-389"><a href="#LMAHeureuxPorosityDiff.evolution_rate-389"><span class="linenos">389</span></a>
</span><span id="LMAHeureuxPorosityDiff.evolution_rate-390"><a href="#LMAHeureuxPorosityDiff.evolution_rate-390"><span class="linenos">390</span></a>        <span class="n">Phi_denom</span> <span class="o">=</span> <span class="n">Phi</span><span class="o">/</span><span class="n">denominator</span>
</span><span id="LMAHeureuxPorosityDiff.evolution_rate-391"><a href="#LMAHeureuxPorosityDiff.evolution_rate-391"><span class="linenos">391</span></a>        <span class="n">grad_Phi_denom</span> <span class="o">=</span> <span class="n">Phi_grad</span> <span class="o">*</span> <span class="p">(</span><span class="n">denominator</span> <span class="o">+</span> <span class="mi">2</span><span class="p">)</span> <span class="o">/</span> <span class="n">denominator</span> <span class="o">**</span> <span class="mi">2</span>
</span><span id="LMAHeureuxPorosityDiff.evolution_rate-392"><a href="#LMAHeureuxPorosityDiff.evolution_rate-392"><span class="linenos">392</span></a>
</span><span id="LMAHeureuxPorosityDiff.evolution_rate-393"><a href="#LMAHeureuxPorosityDiff.evolution_rate-393"><span class="linenos">393</span></a>        <span class="n">common_helper</span> <span class="o">=</span> <span class="n">coA</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">lambda_</span> <span class="o">*</span> <span class="n">coC</span>
</span><span id="LMAHeureuxPorosityDiff.evolution_rate-394"><a href="#LMAHeureuxPorosityDiff.evolution_rate-394"><span class="linenos">394</span></a>
</span><span id="LMAHeureuxPorosityDiff.evolution_rate-395"><a href="#LMAHeureuxPorosityDiff.evolution_rate-395"><span class="linenos">395</span></a>        <span class="n">dcCa_dt</span> <span class="o">=</span> <span class="p">(</span><span class="n">cCa_grad</span> <span class="o">*</span> <span class="n">grad_Phi_denom</span> <span class="o">+</span> <span class="n">Phi_denom</span> <span class="o">*</span> <span class="n">cCa</span><span class="o">.</span><span class="n">laplace</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bc_cCa</span><span class="p">))</span> \
</span><span id="LMAHeureuxPorosityDiff.evolution_rate-396"><a href="#LMAHeureuxPorosityDiff.evolution_rate-396"><span class="linenos">396</span></a>                  <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">dCa</span> <span class="o">/</span><span class="n">Phi</span> <span class="o">-</span><span class="n">W</span> <span class="o">*</span> <span class="n">cCa_grad</span> \
</span><span id="LMAHeureuxPorosityDiff.evolution_rate-397"><a href="#LMAHeureuxPorosityDiff.evolution_rate-397"><span class="linenos">397</span></a>                  <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">Da</span> <span class="o">*</span> <span class="n">one_minus_Phi</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">delta</span> <span class="o">-</span> <span class="n">cCa</span><span class="p">)</span> <span class="o">*</span> <span class="n">common_helper</span> <span class="o">/</span> <span class="n">Phi</span>
</span><span id="LMAHeureuxPorosityDiff.evolution_rate-398"><a href="#LMAHeureuxPorosityDiff.evolution_rate-398"><span class="linenos">398</span></a>
</span><span id="LMAHeureuxPorosityDiff.evolution_rate-399"><a href="#LMAHeureuxPorosityDiff.evolution_rate-399"><span class="linenos">399</span></a>        <span class="n">dcCO3_dt</span> <span class="o">=</span> <span class="p">(</span><span class="n">cCO3_grad</span> <span class="o">*</span> <span class="n">grad_Phi_denom</span> <span class="o">+</span> <span class="n">Phi_denom</span> <span class="o">*</span> <span class="n">cCO3</span><span class="o">.</span><span class="n">laplace</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bc_cCO3</span><span class="p">))</span> \
</span><span id="LMAHeureuxPorosityDiff.evolution_rate-400"><a href="#LMAHeureuxPorosityDiff.evolution_rate-400"><span class="linenos">400</span></a>                   <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">dCO3</span><span class="o">/</span><span class="n">Phi</span> <span class="o">-</span><span class="n">W</span> <span class="o">*</span> <span class="n">cCO3_grad</span> \
</span><span id="LMAHeureuxPorosityDiff.evolution_rate-401"><a href="#LMAHeureuxPorosityDiff.evolution_rate-401"><span class="linenos">401</span></a>                   <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">Da</span> <span class="o">*</span> <span class="n">one_minus_Phi</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">delta</span> <span class="o">-</span> <span class="n">cCO3</span><span class="p">)</span> <span class="o">*</span> <span class="n">common_helper</span> <span class="o">/</span> <span class="n">Phi</span>
</span><span id="LMAHeureuxPorosityDiff.evolution_rate-402"><a href="#LMAHeureuxPorosityDiff.evolution_rate-402"><span class="linenos">402</span></a>
</span><span id="LMAHeureuxPorosityDiff.evolution_rate-403"><a href="#LMAHeureuxPorosityDiff.evolution_rate-403"><span class="linenos">403</span></a>        <span class="n">dW_dx</span> <span class="o">=</span> <span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">rhorat</span> <span class="o">*</span> <span class="n">Phi_grad</span> <span class="o">*</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">Phi</span> <span class="o">*</span> <span class="n">F</span> <span class="o">+</span> <span class="mi">10</span> <span class="o">*</span> <span class="p">(</span><span class="n">F</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span>
</span><span id="LMAHeureuxPorosityDiff.evolution_rate-404"><a href="#LMAHeureuxPorosityDiff.evolution_rate-404"><span class="linenos">404</span></a>
</span><span id="LMAHeureuxPorosityDiff.evolution_rate-405"><a href="#LMAHeureuxPorosityDiff.evolution_rate-405"><span class="linenos">405</span></a>        <span class="c1"># This is closer to the original form of (43) from l&#39; Heureux than</span>
</span><span id="LMAHeureuxPorosityDiff.evolution_rate-406"><a href="#LMAHeureuxPorosityDiff.evolution_rate-406"><span class="linenos">406</span></a>        <span class="c1"># the Matlab implementation.</span>
</span><span id="LMAHeureuxPorosityDiff.evolution_rate-407"><a href="#LMAHeureuxPorosityDiff.evolution_rate-407"><span class="linenos">407</span></a>        <span class="n">dPhi_dt</span> <span class="o">=</span> <span class="o">-</span> <span class="p">(</span><span class="n">Phi</span> <span class="o">*</span> <span class="n">dW_dx</span> <span class="o">+</span> <span class="n">W</span> <span class="o">*</span> <span class="n">Phi_grad</span><span class="p">)</span> \
</span><span id="LMAHeureuxPorosityDiff.evolution_rate-408"><a href="#LMAHeureuxPorosityDiff.evolution_rate-408"><span class="linenos">408</span></a>                  <span class="o">+</span> <span class="n">dPhi</span> <span class="o">*</span> <span class="n">Phi</span><span class="o">.</span><span class="n">laplace</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bc_Phi</span><span class="p">)</span> \
</span><span id="LMAHeureuxPorosityDiff.evolution_rate-409"><a href="#LMAHeureuxPorosityDiff.evolution_rate-409"><span class="linenos">409</span></a>                  <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">Da</span> <span class="o">*</span> <span class="n">one_minus_Phi</span> <span class="o">*</span> <span class="n">common_helper</span>
</span><span id="LMAHeureuxPorosityDiff.evolution_rate-410"><a href="#LMAHeureuxPorosityDiff.evolution_rate-410"><span class="linenos">410</span></a>
</span><span id="LMAHeureuxPorosityDiff.evolution_rate-411"><a href="#LMAHeureuxPorosityDiff.evolution_rate-411"><span class="linenos">411</span></a>        <span class="k">return</span> <span class="n">FieldCollection</span><span class="p">([</span><span class="n">dCA_dt</span><span class="p">,</span> <span class="n">dCC_dt</span><span class="p">,</span> <span class="n">dcCa_dt</span><span class="p">,</span> <span class="n">dcCO3_dt</span><span class="p">,</span> <span class="n">dPhi_dt</span><span class="p">])</span>
</span></pre></div>


            <div class="docstring"><p>Evaluate the right hand side of the PDE.</p>

<p>Args:
    state (<code>~pde.fields.base.FieldBase</code>):
        The field at the current time point
    t (float):
        The current time point</p>

<p>Returns:
    <code>~pde.fields.base.FieldBase</code>:
        Field describing the evolution rate of the PDE</p>
</div>


                            </div>
                            <div class="inherited">
                                <h5>Inherited Members</h5>
                                <dl>
                                    <div><dt>pde.pdes.base.PDEBase</dt>
                                <dd id="LMAHeureuxPorosityDiff.diagnostics" class="variable">diagnostics</dd>
                <dd id="LMAHeureuxPorosityDiff.check_implementation" class="variable">check_implementation</dd>
                <dd id="LMAHeureuxPorosityDiff.cache_rhs" class="variable">cache_rhs</dd>
                <dd id="LMAHeureuxPorosityDiff.explicit_time_dependence" class="variable">explicit_time_dependence</dd>
                <dd id="LMAHeureuxPorosityDiff.complex_valued" class="variable">complex_valued</dd>
                <dd id="LMAHeureuxPorosityDiff.noise" class="variable">noise</dd>
                <dd id="LMAHeureuxPorosityDiff.rng" class="variable">rng</dd>
                <dd id="LMAHeureuxPorosityDiff.is_sde" class="variable">is_sde</dd>
                <dd id="LMAHeureuxPorosityDiff.make_post_step_hook" class="function">make_post_step_hook</dd>
                <dd id="LMAHeureuxPorosityDiff.check_rhs_consistency" class="function">check_rhs_consistency</dd>
                <dd id="LMAHeureuxPorosityDiff.make_pde_rhs" class="function">make_pde_rhs</dd>
                <dd id="LMAHeureuxPorosityDiff.noise_realization" class="function">noise_realization</dd>
                <dd id="LMAHeureuxPorosityDiff.make_sde_rhs" class="function">make_sde_rhs</dd>
                <dd id="LMAHeureuxPorosityDiff.solve" class="function">solve</dd>

            </div>
                                </dl>
                            </div>
                </section>
                <section id="Scenario">
                            <input id="Scenario-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
                    <div class="decorator">@no_init_docs</div>
        <div class="decorator">@dataclass</div>

    <span class="def">class</span>
    <span class="name">Scenario</span>:

                <label class="view-source-button" for="Scenario-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Scenario"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Scenario-15"><a href="#Scenario-15"><span class="linenos">15</span></a><span class="nd">@no_init_docs</span>
</span><span id="Scenario-16"><a href="#Scenario-16"><span class="linenos">16</span></a><span class="nd">@dataclass</span>
</span><span id="Scenario-17"><a href="#Scenario-17"><span class="linenos">17</span></a><span class="k">class</span> <span class="nc">Scenario</span><span class="p">:</span>
</span><span id="Scenario-18"><a href="#Scenario-18"><span class="linenos">18</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot; Sets all the Scenario parameter values from the FORTRAN code from </span>
</span><span id="Scenario-19"><a href="#Scenario-19"><span class="linenos">19</span></a><span class="sd">    L&#39;Heureux (2018). Strictly, the initial and boundary porosities are not</span>
</span><span id="Scenario-20"><a href="#Scenario-20"><span class="linenos">20</span></a><span class="sd">    part of the Scenario parameters, but they are included here.</span>
</span><span id="Scenario-21"><a href="#Scenario-21"><span class="linenos">21</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="Scenario-22"><a href="#Scenario-22"><span class="linenos">22</span></a>    <span class="n">mua</span><span class="p">:</span> <span class="n">quantity</span>    <span class="o">=</span> <span class="mf">100.09</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">g</span><span class="o">/</span><span class="n">u</span><span class="o">.</span><span class="n">mol</span>
</span><span id="Scenario-23"><a href="#Scenario-23"><span class="linenos">23</span></a>    <span class="n">rhoa</span><span class="p">:</span> <span class="n">quantity</span>   <span class="o">=</span> <span class="mf">2.95</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">g</span><span class="o">/</span><span class="n">u</span><span class="o">.</span><span class="n">cm</span><span class="o">**</span><span class="mi">3</span>
</span><span id="Scenario-24"><a href="#Scenario-24"><span class="linenos">24</span></a>    <span class="n">rhoc</span><span class="p">:</span> <span class="n">quantity</span>   <span class="o">=</span> <span class="mf">2.71</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">g</span><span class="o">/</span><span class="n">u</span><span class="o">.</span><span class="n">cm</span><span class="o">**</span><span class="mi">3</span>
</span><span id="Scenario-25"><a href="#Scenario-25"><span class="linenos">25</span></a>    <span class="n">rhot</span><span class="p">:</span> <span class="n">quantity</span>   <span class="o">=</span> <span class="mf">2.8</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">g</span><span class="o">/</span><span class="n">u</span><span class="o">.</span><span class="n">cm</span><span class="o">**</span><span class="mi">3</span>
</span><span id="Scenario-26"><a href="#Scenario-26"><span class="linenos">26</span></a>    <span class="n">rhow</span><span class="p">:</span> <span class="n">quantity</span>   <span class="o">=</span> <span class="mf">1.023</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">g</span><span class="o">/</span><span class="n">u</span><span class="o">.</span><span class="n">cm</span><span class="o">**</span><span class="mi">3</span>
</span><span id="Scenario-27"><a href="#Scenario-27"><span class="linenos">27</span></a>    <span class="n">D0ca</span><span class="p">:</span> <span class="n">quantity</span>   <span class="o">=</span> <span class="mf">131.9</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">cm</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="n">u</span><span class="o">.</span><span class="n">a</span>
</span><span id="Scenario-28"><a href="#Scenario-28"><span class="linenos">28</span></a>    <span class="n">D0co3</span><span class="p">:</span> <span class="n">quantity</span>  <span class="o">=</span> <span class="mf">272.6</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">cm</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="n">u</span><span class="o">.</span><span class="n">a</span>
</span><span id="Scenario-29"><a href="#Scenario-29"><span class="linenos">29</span></a>    <span class="n">Ka</span><span class="p">:</span> <span class="n">quantity</span>     <span class="o">=</span> <span class="mi">10</span><span class="o">**</span><span class="p">(</span><span class="o">-</span><span class="mf">6.19</span><span class="p">)</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">M</span><span class="o">**</span><span class="mi">2</span>
</span><span id="Scenario-30"><a href="#Scenario-30"><span class="linenos">30</span></a>    <span class="n">Kc</span><span class="p">:</span> <span class="n">quantity</span>     <span class="o">=</span> <span class="mi">10</span><span class="o">**</span><span class="p">(</span><span class="o">-</span><span class="mf">6.37</span><span class="p">)</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">M</span><span class="o">**</span><span class="mi">2</span>
</span><span id="Scenario-31"><a href="#Scenario-31"><span class="linenos">31</span></a>    <span class="n">beta</span><span class="p">:</span> <span class="n">quantity</span>   <span class="o">=</span> <span class="mf">0.1</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">cm</span> <span class="o">/</span> <span class="n">u</span><span class="o">.</span><span class="n">a</span>
</span><span id="Scenario-32"><a href="#Scenario-32"><span class="linenos">32</span></a>    <span class="n">b</span><span class="p">:</span> <span class="n">quantity</span>      <span class="o">=</span> <span class="mf">5.0</span> <span class="o">/</span> <span class="n">u</span><span class="o">.</span><span class="n">kPa</span>
</span><span id="Scenario-33"><a href="#Scenario-33"><span class="linenos">33</span></a>    <span class="n">k1</span><span class="p">:</span> <span class="n">quantity</span>     <span class="o">=</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="n">u</span><span class="o">.</span><span class="n">a</span>
</span><span id="Scenario-34"><a href="#Scenario-34"><span class="linenos">34</span></a>    <span class="n">k2</span><span class="p">:</span> <span class="n">quantity</span>     <span class="o">=</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="n">u</span><span class="o">.</span><span class="n">a</span>
</span><span id="Scenario-35"><a href="#Scenario-35"><span class="linenos">35</span></a>    <span class="n">k3</span><span class="p">:</span> <span class="n">quantity</span>     <span class="o">=</span> <span class="mf">0.1</span> <span class="o">/</span> <span class="n">u</span><span class="o">.</span><span class="n">a</span>
</span><span id="Scenario-36"><a href="#Scenario-36"><span class="linenos">36</span></a>    <span class="n">k4</span><span class="p">:</span> <span class="n">quantity</span>     <span class="o">=</span> <span class="mf">0.1</span> <span class="o">/</span> <span class="n">u</span><span class="o">.</span><span class="n">a</span>
</span><span id="Scenario-37"><a href="#Scenario-37"><span class="linenos">37</span></a>    <span class="n">nn</span><span class="p">:</span> <span class="n">quantity</span>     <span class="o">=</span> <span class="mf">2.8</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">dimensionless</span>
</span><span id="Scenario-38"><a href="#Scenario-38"><span class="linenos">38</span></a>    <span class="n">m</span><span class="p">:</span> <span class="n">quantity</span>      <span class="o">=</span> <span class="mf">2.48</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">dimensionless</span>
</span><span id="Scenario-39"><a href="#Scenario-39"><span class="linenos">39</span></a>    <span class="n">S</span><span class="p">:</span> <span class="n">quantity</span>      <span class="o">=</span> <span class="mf">0.1</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">cm</span> <span class="o">/</span> <span class="n">u</span><span class="o">.</span><span class="n">a</span>
</span><span id="Scenario-40"><a href="#Scenario-40"><span class="linenos">40</span></a>    <span class="c1"># cAthy: quantity  = 0.1 * u.dimensionless</span>
</span><span id="Scenario-41"><a href="#Scenario-41"><span class="linenos">41</span></a>    <span class="n">phiinf</span><span class="p">:</span> <span class="n">quantity</span> <span class="o">=</span> <span class="mf">0.01</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">dimensionless</span>
</span><span id="Scenario-42"><a href="#Scenario-42"><span class="linenos">42</span></a>    <span class="n">phi0</span><span class="p">:</span> <span class="n">quantity</span>   <span class="o">=</span> <span class="mf">0.8</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">dimensionless</span>
</span><span id="Scenario-43"><a href="#Scenario-43"><span class="linenos">43</span></a>    <span class="n">ca0</span><span class="p">:</span> <span class="n">quantity</span>    <span class="o">=</span> <span class="mf">0.326e-3</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">M</span>
</span><span id="Scenario-44"><a href="#Scenario-44"><span class="linenos">44</span></a>    <span class="n">co30</span><span class="p">:</span> <span class="n">quantity</span>   <span class="o">=</span> <span class="mf">0.326e-3</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">M</span>
</span><span id="Scenario-45"><a href="#Scenario-45"><span class="linenos">45</span></a>    <span class="n">ccal0</span><span class="p">:</span> <span class="n">quantity</span>  <span class="o">=</span> <span class="mf">0.3</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">dimensionless</span>
</span><span id="Scenario-46"><a href="#Scenario-46"><span class="linenos">46</span></a>    <span class="n">cara0</span><span class="p">:</span> <span class="n">quantity</span>  <span class="o">=</span> <span class="mf">0.6</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">dimensionless</span>
</span><span id="Scenario-47"><a href="#Scenario-47"><span class="linenos">47</span></a>    <span class="n">xdis</span><span class="p">:</span> <span class="n">quantity</span>   <span class="o">=</span> <span class="mf">50.0</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">cm</span>       <span class="c1"># x_d   (start of dissolution zone)</span>
</span><span id="Scenario-48"><a href="#Scenario-48"><span class="linenos">48</span></a>    <span class="n">length</span><span class="p">:</span> <span class="n">quantity</span> <span class="o">=</span> <span class="mf">500.0</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">cm</span>
</span><span id="Scenario-49"><a href="#Scenario-49"><span class="linenos">49</span></a>    <span class="n">Th</span><span class="p">:</span> <span class="n">quantity</span>     <span class="o">=</span> <span class="mf">100.0</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">cm</span>      <span class="c1"># h_d   (height of dissolution zone)</span>
</span><span id="Scenario-50"><a href="#Scenario-50"><span class="linenos">50</span></a>    <span class="n">phi00</span><span class="p">:</span> <span class="n">quantity</span>  <span class="o">=</span> <span class="mf">0.8</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">dimensionless</span>
</span><span id="Scenario-51"><a href="#Scenario-51"><span class="linenos">51</span></a>    <span class="n">ca00</span><span class="p">:</span> <span class="n">quantity</span>   <span class="o">=</span> <span class="mf">0.326e-3</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">M</span>    <span class="c1"># sqrt(Kc) / 2</span>
</span><span id="Scenario-52"><a href="#Scenario-52"><span class="linenos">52</span></a>    <span class="n">co300</span><span class="p">:</span> <span class="n">quantity</span>  <span class="o">=</span> <span class="mf">0.326e-3</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">M</span>    <span class="c1"># sqrt(Kc) / 2</span>
</span><span id="Scenario-53"><a href="#Scenario-53"><span class="linenos">53</span></a>    <span class="n">ccal00</span><span class="p">:</span> <span class="n">quantity</span> <span class="o">=</span> <span class="mf">0.3</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">dimensionless</span>
</span><span id="Scenario-54"><a href="#Scenario-54"><span class="linenos">54</span></a>    <span class="n">cara00</span><span class="p">:</span> <span class="n">quantity</span> <span class="o">=</span> <span class="mf">0.6</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">dimensionless</span>
</span></pre></div>


            <div class="docstring"><p>Sets all the Scenario parameter values from the FORTRAN code from 
L'Heureux (2018). Strictly, the initial and boundary porosities are not
part of the Scenario parameters, but they are included here.</p>
</div>


                            <div id="Scenario.mua" class="classattr">
                                <div class="attr variable">
            <span class="name">mua</span><span class="annotation">: pint.Quantity</span>        =
<span class="default_value">&lt;Quantity(100.09, &#39;gram / mole&#39;)&gt;</span>

        
    </div>
    <a class="headerlink" href="#Scenario.mua"></a>
    
    

                            </div>
                            <div id="Scenario.rhoa" class="classattr">
                                <div class="attr variable">
            <span class="name">rhoa</span><span class="annotation">: pint.Quantity</span>        =
<span class="default_value">&lt;Quantity(2.95, &#39;gram / centimeter ** 3&#39;)&gt;</span>

        
    </div>
    <a class="headerlink" href="#Scenario.rhoa"></a>
    
    

                            </div>
                            <div id="Scenario.rhoc" class="classattr">
                                <div class="attr variable">
            <span class="name">rhoc</span><span class="annotation">: pint.Quantity</span>        =
<span class="default_value">&lt;Quantity(2.71, &#39;gram / centimeter ** 3&#39;)&gt;</span>

        
    </div>
    <a class="headerlink" href="#Scenario.rhoc"></a>
    
    

                            </div>
                            <div id="Scenario.rhot" class="classattr">
                                <div class="attr variable">
            <span class="name">rhot</span><span class="annotation">: pint.Quantity</span>        =
<span class="default_value">&lt;Quantity(2.8, &#39;gram / centimeter ** 3&#39;)&gt;</span>

        
    </div>
    <a class="headerlink" href="#Scenario.rhot"></a>
    
    

                            </div>
                            <div id="Scenario.rhow" class="classattr">
                                <div class="attr variable">
            <span class="name">rhow</span><span class="annotation">: pint.Quantity</span>        =
<span class="default_value">&lt;Quantity(1.023, &#39;gram / centimeter ** 3&#39;)&gt;</span>

        
    </div>
    <a class="headerlink" href="#Scenario.rhow"></a>
    
    

                            </div>
                            <div id="Scenario.D0ca" class="classattr">
                                <div class="attr variable">
            <span class="name">D0ca</span><span class="annotation">: pint.Quantity</span>        =
<span class="default_value">&lt;Quantity(131.9, &#39;centimeter ** 2 / year&#39;)&gt;</span>

        
    </div>
    <a class="headerlink" href="#Scenario.D0ca"></a>
    
    

                            </div>
                            <div id="Scenario.D0co3" class="classattr">
                                <div class="attr variable">
            <span class="name">D0co3</span><span class="annotation">: pint.Quantity</span>        =
<span class="default_value">&lt;Quantity(272.6, &#39;centimeter ** 2 / year&#39;)&gt;</span>

        
    </div>
    <a class="headerlink" href="#Scenario.D0co3"></a>
    
    

                            </div>
                            <div id="Scenario.Ka" class="classattr">
                                <div class="attr variable">
            <span class="name">Ka</span><span class="annotation">: pint.Quantity</span>        =
<span class="default_value">&lt;Quantity(6.45654229e-07, &#39;molar ** 2&#39;)&gt;</span>

        
    </div>
    <a class="headerlink" href="#Scenario.Ka"></a>
    
    

                            </div>
                            <div id="Scenario.Kc" class="classattr">
                                <div class="attr variable">
            <span class="name">Kc</span><span class="annotation">: pint.Quantity</span>        =
<span class="default_value">&lt;Quantity(4.26579519e-07, &#39;molar ** 2&#39;)&gt;</span>

        
    </div>
    <a class="headerlink" href="#Scenario.Kc"></a>
    
    

                            </div>
                            <div id="Scenario.beta" class="classattr">
                                <div class="attr variable">
            <span class="name">beta</span><span class="annotation">: pint.Quantity</span>        =
<span class="default_value">&lt;Quantity(0.1, &#39;centimeter / year&#39;)&gt;</span>

        
    </div>
    <a class="headerlink" href="#Scenario.beta"></a>
    
    

                            </div>
                            <div id="Scenario.b" class="classattr">
                                <div class="attr variable">
            <span class="name">b</span><span class="annotation">: pint.Quantity</span>        =
<span class="default_value">&lt;Quantity(5.0, &#39;1 / kilopascal&#39;)&gt;</span>

        
    </div>
    <a class="headerlink" href="#Scenario.b"></a>
    
    

                            </div>
                            <div id="Scenario.k1" class="classattr">
                                <div class="attr variable">
            <span class="name">k1</span><span class="annotation">: pint.Quantity</span>        =
<span class="default_value">&lt;Quantity(1.0, &#39;1 / year&#39;)&gt;</span>

        
    </div>
    <a class="headerlink" href="#Scenario.k1"></a>
    
    

                            </div>
                            <div id="Scenario.k2" class="classattr">
                                <div class="attr variable">
            <span class="name">k2</span><span class="annotation">: pint.Quantity</span>        =
<span class="default_value">&lt;Quantity(1.0, &#39;1 / year&#39;)&gt;</span>

        
    </div>
    <a class="headerlink" href="#Scenario.k2"></a>
    
    

                            </div>
                            <div id="Scenario.k3" class="classattr">
                                <div class="attr variable">
            <span class="name">k3</span><span class="annotation">: pint.Quantity</span>        =
<span class="default_value">&lt;Quantity(0.1, &#39;1 / year&#39;)&gt;</span>

        
    </div>
    <a class="headerlink" href="#Scenario.k3"></a>
    
    

                            </div>
                            <div id="Scenario.k4" class="classattr">
                                <div class="attr variable">
            <span class="name">k4</span><span class="annotation">: pint.Quantity</span>        =
<span class="default_value">&lt;Quantity(0.1, &#39;1 / year&#39;)&gt;</span>

        
    </div>
    <a class="headerlink" href="#Scenario.k4"></a>
    
    

                            </div>
                            <div id="Scenario.nn" class="classattr">
                                <div class="attr variable">
            <span class="name">nn</span><span class="annotation">: pint.Quantity</span>        =
<span class="default_value">&lt;Quantity(2.8, &#39;dimensionless&#39;)&gt;</span>

        
    </div>
    <a class="headerlink" href="#Scenario.nn"></a>
    
    

                            </div>
                            <div id="Scenario.m" class="classattr">
                                <div class="attr variable">
            <span class="name">m</span><span class="annotation">: pint.Quantity</span>        =
<span class="default_value">&lt;Quantity(2.48, &#39;dimensionless&#39;)&gt;</span>

        
    </div>
    <a class="headerlink" href="#Scenario.m"></a>
    
    

                            </div>
                            <div id="Scenario.S" class="classattr">
                                <div class="attr variable">
            <span class="name">S</span><span class="annotation">: pint.Quantity</span>        =
<span class="default_value">&lt;Quantity(0.1, &#39;centimeter / year&#39;)&gt;</span>

        
    </div>
    <a class="headerlink" href="#Scenario.S"></a>
    
    

                            </div>
                            <div id="Scenario.phiinf" class="classattr">
                                <div class="attr variable">
            <span class="name">phiinf</span><span class="annotation">: pint.Quantity</span>        =
<span class="default_value">&lt;Quantity(0.01, &#39;dimensionless&#39;)&gt;</span>

        
    </div>
    <a class="headerlink" href="#Scenario.phiinf"></a>
    
    

                            </div>
                            <div id="Scenario.phi0" class="classattr">
                                <div class="attr variable">
            <span class="name">phi0</span><span class="annotation">: pint.Quantity</span>        =
<span class="default_value">&lt;Quantity(0.8, &#39;dimensionless&#39;)&gt;</span>

        
    </div>
    <a class="headerlink" href="#Scenario.phi0"></a>
    
    

                            </div>
                            <div id="Scenario.ca0" class="classattr">
                                <div class="attr variable">
            <span class="name">ca0</span><span class="annotation">: pint.Quantity</span>        =
<span class="default_value">&lt;Quantity(0.000326, &#39;molar&#39;)&gt;</span>

        
    </div>
    <a class="headerlink" href="#Scenario.ca0"></a>
    
    

                            </div>
                            <div id="Scenario.co30" class="classattr">
                                <div class="attr variable">
            <span class="name">co30</span><span class="annotation">: pint.Quantity</span>        =
<span class="default_value">&lt;Quantity(0.000326, &#39;molar&#39;)&gt;</span>

        
    </div>
    <a class="headerlink" href="#Scenario.co30"></a>
    
    

                            </div>
                            <div id="Scenario.ccal0" class="classattr">
                                <div class="attr variable">
            <span class="name">ccal0</span><span class="annotation">: pint.Quantity</span>        =
<span class="default_value">&lt;Quantity(0.3, &#39;dimensionless&#39;)&gt;</span>

        
    </div>
    <a class="headerlink" href="#Scenario.ccal0"></a>
    
    

                            </div>
                            <div id="Scenario.cara0" class="classattr">
                                <div class="attr variable">
            <span class="name">cara0</span><span class="annotation">: pint.Quantity</span>        =
<span class="default_value">&lt;Quantity(0.6, &#39;dimensionless&#39;)&gt;</span>

        
    </div>
    <a class="headerlink" href="#Scenario.cara0"></a>
    
    

                            </div>
                            <div id="Scenario.xdis" class="classattr">
                                <div class="attr variable">
            <span class="name">xdis</span><span class="annotation">: pint.Quantity</span>        =
<span class="default_value">&lt;Quantity(50.0, &#39;centimeter&#39;)&gt;</span>

        
    </div>
    <a class="headerlink" href="#Scenario.xdis"></a>
    
    

                            </div>
                            <div id="Scenario.length" class="classattr">
                                <div class="attr variable">
            <span class="name">length</span><span class="annotation">: pint.Quantity</span>        =
<span class="default_value">&lt;Quantity(500.0, &#39;centimeter&#39;)&gt;</span>

        
    </div>
    <a class="headerlink" href="#Scenario.length"></a>
    
    

                            </div>
                            <div id="Scenario.Th" class="classattr">
                                <div class="attr variable">
            <span class="name">Th</span><span class="annotation">: pint.Quantity</span>        =
<span class="default_value">&lt;Quantity(100.0, &#39;centimeter&#39;)&gt;</span>

        
    </div>
    <a class="headerlink" href="#Scenario.Th"></a>
    
    

                            </div>
                            <div id="Scenario.phi00" class="classattr">
                                <div class="attr variable">
            <span class="name">phi00</span><span class="annotation">: pint.Quantity</span>        =
<span class="default_value">&lt;Quantity(0.8, &#39;dimensionless&#39;)&gt;</span>

        
    </div>
    <a class="headerlink" href="#Scenario.phi00"></a>
    
    

                            </div>
                            <div id="Scenario.ca00" class="classattr">
                                <div class="attr variable">
            <span class="name">ca00</span><span class="annotation">: pint.Quantity</span>        =
<span class="default_value">&lt;Quantity(0.000326, &#39;molar&#39;)&gt;</span>

        
    </div>
    <a class="headerlink" href="#Scenario.ca00"></a>
    
    

                            </div>
                            <div id="Scenario.co300" class="classattr">
                                <div class="attr variable">
            <span class="name">co300</span><span class="annotation">: pint.Quantity</span>        =
<span class="default_value">&lt;Quantity(0.000326, &#39;molar&#39;)&gt;</span>

        
    </div>
    <a class="headerlink" href="#Scenario.co300"></a>
    
    

                            </div>
                            <div id="Scenario.ccal00" class="classattr">
                                <div class="attr variable">
            <span class="name">ccal00</span><span class="annotation">: pint.Quantity</span>        =
<span class="default_value">&lt;Quantity(0.3, &#39;dimensionless&#39;)&gt;</span>

        
    </div>
    <a class="headerlink" href="#Scenario.ccal00"></a>
    
    

                            </div>
                            <div id="Scenario.cara00" class="classattr">
                                <div class="attr variable">
            <span class="name">cara00</span><span class="annotation">: pint.Quantity</span>        =
<span class="default_value">&lt;Quantity(0.6, &#39;dimensionless&#39;)&gt;</span>

        
    </div>
    <a class="headerlink" href="#Scenario.cara00"></a>
    
    

                            </div>
                </section>
                <section id="Map_Scenario">
                            <input id="Map_Scenario-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">Map_Scenario</span><span class="signature pdoc-code condensed">(<span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Map_Scenario-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Map_Scenario"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Map_Scenario-56"><a href="#Map_Scenario-56"><span class="linenos"> 56</span></a><span class="k">def</span> <span class="nf">Map_Scenario</span><span class="p">():</span>
</span><span id="Map_Scenario-57"><a href="#Map_Scenario-57"><span class="linenos"> 57</span></a><span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
</span><span id="Map_Scenario-58"><a href="#Map_Scenario-58"><span class="linenos"> 58</span></a><span class="sd">    Maps the Fortran &#39;Scenario&#39; parameters to the equivalent parameters in the</span>
</span><span id="Map_Scenario-59"><a href="#Map_Scenario-59"><span class="linenos"> 59</span></a><span class="sd">    Matlab and Python codes. These codes use slightly different parameter </span>
</span><span id="Map_Scenario-60"><a href="#Map_Scenario-60"><span class="linenos"> 60</span></a><span class="sd">    names. Besides the mapping, also a few numerical conversions are applied.</span>
</span><span id="Map_Scenario-61"><a href="#Map_Scenario-61"><span class="linenos"> 61</span></a><span class="sd">    To do these conversions, a number of FORTRAN parameters need to be passed on </span>
</span><span id="Map_Scenario-62"><a href="#Map_Scenario-62"><span class="linenos"> 62</span></a><span class="sd">    &quot;as is&quot;, i.e. unchanged.</span>
</span><span id="Map_Scenario-63"><a href="#Map_Scenario-63"><span class="linenos"> 63</span></a><span class="sd">    Units from Scenario are dropped, so only magnitudes (i.e. values) are </span>
</span><span id="Map_Scenario-64"><a href="#Map_Scenario-64"><span class="linenos"> 64</span></a><span class="sd">    retained.</span>
</span><span id="Map_Scenario-65"><a href="#Map_Scenario-65"><span class="linenos"> 65</span></a><span class="sd">    &#39;&#39;&#39;</span>
</span><span id="Map_Scenario-66"><a href="#Map_Scenario-66"><span class="linenos"> 66</span></a>    <span class="n">mapping</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;Ka&quot;</span><span class="p">:</span><span class="s2">&quot;KA&quot;</span><span class="p">,</span>
</span><span id="Map_Scenario-67"><a href="#Map_Scenario-67"><span class="linenos"> 67</span></a>               <span class="s2">&quot;Kc&quot;</span><span class="p">:</span><span class="s2">&quot;KC&quot;</span><span class="p">,</span> 
</span><span id="Map_Scenario-68"><a href="#Map_Scenario-68"><span class="linenos"> 68</span></a>               <span class="s2">&quot;cara0&quot;</span><span class="p">:</span> <span class="s2">&quot;CA0&quot;</span><span class="p">,</span> 
</span><span id="Map_Scenario-69"><a href="#Map_Scenario-69"><span class="linenos"> 69</span></a>               <span class="s2">&quot;cara00&quot;</span><span class="p">:</span> <span class="s2">&quot;CAIni&quot;</span><span class="p">,</span>
</span><span id="Map_Scenario-70"><a href="#Map_Scenario-70"><span class="linenos"> 70</span></a>               <span class="s2">&quot;ccal0&quot;</span><span class="p">:</span> <span class="s2">&quot;CC0&quot;</span><span class="p">,</span>
</span><span id="Map_Scenario-71"><a href="#Map_Scenario-71"><span class="linenos"> 71</span></a>               <span class="s2">&quot;ccal00&quot;</span><span class="p">:</span> <span class="s2">&quot;CCIni&quot;</span><span class="p">,</span>
</span><span id="Map_Scenario-72"><a href="#Map_Scenario-72"><span class="linenos"> 72</span></a>               <span class="s2">&quot;ca0&quot;</span><span class="p">:</span> <span class="s2">&quot;ca0&quot;</span><span class="p">,</span>
</span><span id="Map_Scenario-73"><a href="#Map_Scenario-73"><span class="linenos"> 73</span></a>               <span class="s2">&quot;ca00&quot;</span><span class="p">:</span> <span class="s2">&quot;ca00&quot;</span><span class="p">,</span>
</span><span id="Map_Scenario-74"><a href="#Map_Scenario-74"><span class="linenos"> 74</span></a>               <span class="s2">&quot;co30&quot;</span><span class="p">:</span> <span class="s2">&quot;co30&quot;</span><span class="p">,</span>
</span><span id="Map_Scenario-75"><a href="#Map_Scenario-75"><span class="linenos"> 75</span></a>               <span class="s2">&quot;co300&quot;</span><span class="p">:</span> <span class="s2">&quot;co300&quot;</span><span class="p">,</span>               
</span><span id="Map_Scenario-76"><a href="#Map_Scenario-76"><span class="linenos"> 76</span></a>               <span class="s2">&quot;phi0&quot;</span><span class="p">:</span> <span class="s2">&quot;Phi0&quot;</span><span class="p">,</span> 
</span><span id="Map_Scenario-77"><a href="#Map_Scenario-77"><span class="linenos"> 77</span></a>               <span class="s2">&quot;phi00&quot;</span><span class="p">:</span><span class="s2">&quot;PhiIni&quot;</span><span class="p">,</span> 
</span><span id="Map_Scenario-78"><a href="#Map_Scenario-78"><span class="linenos"> 78</span></a>               <span class="s2">&quot;xdis&quot;</span><span class="p">:</span> <span class="s2">&quot;ShallowLimit&quot;</span><span class="p">,</span>
</span><span id="Map_Scenario-79"><a href="#Map_Scenario-79"><span class="linenos"> 79</span></a>               <span class="s2">&quot;Th&quot;</span><span class="p">:</span> <span class="s2">&quot;Th&quot;</span><span class="p">,</span>
</span><span id="Map_Scenario-80"><a href="#Map_Scenario-80"><span class="linenos"> 80</span></a>               <span class="s2">&quot;S&quot;</span><span class="p">:</span> <span class="s2">&quot;sedimentationrate&quot;</span><span class="p">,</span>
</span><span id="Map_Scenario-81"><a href="#Map_Scenario-81"><span class="linenos"> 81</span></a>               <span class="s2">&quot;m&quot;</span><span class="p">:</span> <span class="s2">&quot;m1&quot;</span><span class="p">,</span>
</span><span id="Map_Scenario-82"><a href="#Map_Scenario-82"><span class="linenos"> 82</span></a>               <span class="s2">&quot;nn&quot;</span><span class="p">:</span> <span class="s2">&quot;n1&quot;</span><span class="p">,</span>
</span><span id="Map_Scenario-83"><a href="#Map_Scenario-83"><span class="linenos"> 83</span></a>               <span class="s2">&quot;rhoa&quot;</span><span class="p">:</span> <span class="s2">&quot;rhoa&quot;</span><span class="p">,</span>
</span><span id="Map_Scenario-84"><a href="#Map_Scenario-84"><span class="linenos"> 84</span></a>               <span class="s2">&quot;rhoc&quot;</span><span class="p">:</span> <span class="s2">&quot;rhoc&quot;</span><span class="p">,</span>
</span><span id="Map_Scenario-85"><a href="#Map_Scenario-85"><span class="linenos"> 85</span></a>               <span class="s2">&quot;rhot&quot;</span><span class="p">:</span> <span class="s2">&quot;rhot&quot;</span><span class="p">,</span>
</span><span id="Map_Scenario-86"><a href="#Map_Scenario-86"><span class="linenos"> 86</span></a>               <span class="s2">&quot;rhow&quot;</span><span class="p">:</span> <span class="s2">&quot;rhow&quot;</span><span class="p">,</span>
</span><span id="Map_Scenario-87"><a href="#Map_Scenario-87"><span class="linenos"> 87</span></a>               <span class="s2">&quot;beta&quot;</span><span class="p">:</span> <span class="s2">&quot;beta&quot;</span><span class="p">,</span>
</span><span id="Map_Scenario-88"><a href="#Map_Scenario-88"><span class="linenos"> 88</span></a>               <span class="s2">&quot;b&quot;</span><span class="p">:</span> <span class="s2">&quot;b&quot;</span><span class="p">,</span>
</span><span id="Map_Scenario-89"><a href="#Map_Scenario-89"><span class="linenos"> 89</span></a>               <span class="s2">&quot;D0ca&quot;</span><span class="p">:</span> <span class="s2">&quot;D0Ca&quot;</span><span class="p">,</span>
</span><span id="Map_Scenario-90"><a href="#Map_Scenario-90"><span class="linenos"> 90</span></a>               <span class="s2">&quot;k1&quot;</span><span class="p">:</span> <span class="s2">&quot;k1&quot;</span><span class="p">,</span>
</span><span id="Map_Scenario-91"><a href="#Map_Scenario-91"><span class="linenos"> 91</span></a>               <span class="s2">&quot;k2&quot;</span><span class="p">:</span> <span class="s2">&quot;k2&quot;</span><span class="p">,</span>
</span><span id="Map_Scenario-92"><a href="#Map_Scenario-92"><span class="linenos"> 92</span></a>               <span class="s2">&quot;k3&quot;</span><span class="p">:</span> <span class="s2">&quot;k3&quot;</span><span class="p">,</span>
</span><span id="Map_Scenario-93"><a href="#Map_Scenario-93"><span class="linenos"> 93</span></a>               <span class="s2">&quot;k4&quot;</span><span class="p">:</span> <span class="s2">&quot;k4&quot;</span><span class="p">,</span>
</span><span id="Map_Scenario-94"><a href="#Map_Scenario-94"><span class="linenos"> 94</span></a>               <span class="s2">&quot;mua&quot;</span><span class="p">:</span> <span class="s2">&quot;muA&quot;</span><span class="p">,</span>
</span><span id="Map_Scenario-95"><a href="#Map_Scenario-95"><span class="linenos"> 95</span></a>               <span class="s2">&quot;D0co3&quot;</span><span class="p">:</span> <span class="s2">&quot;DCO3&quot;</span><span class="p">,</span>  
</span><span id="Map_Scenario-96"><a href="#Map_Scenario-96"><span class="linenos"> 96</span></a>               <span class="s2">&quot;phiinf&quot;</span><span class="p">:</span> <span class="s2">&quot;PhiInfty&quot;</span><span class="p">,</span>
</span><span id="Map_Scenario-97"><a href="#Map_Scenario-97"><span class="linenos"> 97</span></a>               <span class="s2">&quot;length&quot;</span><span class="p">:</span> <span class="s2">&quot;max_depth&quot;</span>
</span><span id="Map_Scenario-98"><a href="#Map_Scenario-98"><span class="linenos"> 98</span></a>    <span class="p">}</span>
</span><span id="Map_Scenario-99"><a href="#Map_Scenario-99"><span class="linenos"> 99</span></a>
</span><span id="Map_Scenario-100"><a href="#Map_Scenario-100"><span class="linenos">100</span></a>    <span class="n">all_fields</span> <span class="o">=</span> <span class="n">fields</span><span class="p">(</span><span class="n">Scenario</span><span class="p">)</span>
</span><span id="Map_Scenario-101"><a href="#Map_Scenario-101"><span class="linenos">101</span></a>
</span><span id="Map_Scenario-102"><a href="#Map_Scenario-102"><span class="linenos">102</span></a>    <span class="n">allowed_fields</span> <span class="o">=</span> <span class="p">[</span><span class="n">field</span> <span class="k">for</span> <span class="n">field</span> <span class="ow">in</span> <span class="n">all_fields</span>
</span><span id="Map_Scenario-103"><a href="#Map_Scenario-103"><span class="linenos">103</span></a>                      <span class="k">if</span> <span class="n">field</span><span class="o">.</span><span class="n">name</span> <span class="ow">in</span> <span class="n">mapping</span><span class="p">]</span>
</span><span id="Map_Scenario-104"><a href="#Map_Scenario-104"><span class="linenos">104</span></a>    
</span><span id="Map_Scenario-105"><a href="#Map_Scenario-105"><span class="linenos">105</span></a>    <span class="n">derived_fields</span> <span class="o">=</span> <span class="p">[(</span><span class="n">mapping</span><span class="p">[</span><span class="n">field</span><span class="o">.</span><span class="n">name</span><span class="p">],</span> <span class="n">field</span><span class="o">.</span><span class="n">type</span><span class="p">,</span> <span class="n">field</span><span class="o">.</span><span class="n">default</span><span class="o">.</span><span class="n">magnitude</span><span class="p">)</span> 
</span><span id="Map_Scenario-106"><a href="#Map_Scenario-106"><span class="linenos">106</span></a>                      <span class="k">for</span> <span class="n">field</span> <span class="ow">in</span> <span class="n">allowed_fields</span><span class="p">]</span>
</span><span id="Map_Scenario-107"><a href="#Map_Scenario-107"><span class="linenos">107</span></a>                    
</span><span id="Map_Scenario-108"><a href="#Map_Scenario-108"><span class="linenos">108</span></a>    <span class="c1"># Here we append the fields that cannot be initialised directly from the</span>
</span><span id="Map_Scenario-109"><a href="#Map_Scenario-109"><span class="linenos">109</span></a>    <span class="c1"># Scenario dataclass.</span>
</span><span id="Map_Scenario-110"><a href="#Map_Scenario-110"><span class="linenos">110</span></a>    <span class="n">derived_fields</span><span class="o">.</span><span class="n">extend</span><span class="p">([(</span><span class="s2">&quot;cCa0&quot;</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span>
</span><span id="Map_Scenario-111"><a href="#Map_Scenario-111"><span class="linenos">111</span></a>                           <span class="p">(</span><span class="s2">&quot;cCaIni&quot;</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span>
</span><span id="Map_Scenario-112"><a href="#Map_Scenario-112"><span class="linenos">112</span></a>                           <span class="p">(</span><span class="s2">&quot;cCO30&quot;</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span>
</span><span id="Map_Scenario-113"><a href="#Map_Scenario-113"><span class="linenos">113</span></a>                           <span class="p">(</span><span class="s2">&quot;cCO3Ini&quot;</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span>
</span><span id="Map_Scenario-114"><a href="#Map_Scenario-114"><span class="linenos">114</span></a>                           <span class="p">(</span><span class="s2">&quot;DeepLimit&quot;</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span>
</span><span id="Map_Scenario-115"><a href="#Map_Scenario-115"><span class="linenos">115</span></a>                           <span class="p">(</span><span class="s2">&quot;rhos0&quot;</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span>
</span><span id="Map_Scenario-116"><a href="#Map_Scenario-116"><span class="linenos">116</span></a>                           <span class="p">(</span><span class="s2">&quot;rhos&quot;</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span>
</span><span id="Map_Scenario-117"><a href="#Map_Scenario-117"><span class="linenos">117</span></a>                           <span class="p">(</span><span class="s2">&quot;Xstar&quot;</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span>
</span><span id="Map_Scenario-118"><a href="#Map_Scenario-118"><span class="linenos">118</span></a>                           <span class="p">(</span><span class="s2">&quot;Tstar&quot;</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span>
</span><span id="Map_Scenario-119"><a href="#Map_Scenario-119"><span class="linenos">119</span></a>                           <span class="p">(</span><span class="s2">&quot;m2&quot;</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span>
</span><span id="Map_Scenario-120"><a href="#Map_Scenario-120"><span class="linenos">120</span></a>                           <span class="p">(</span><span class="s2">&quot;n2&quot;</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span>
</span><span id="Map_Scenario-121"><a href="#Map_Scenario-121"><span class="linenos">121</span></a>                           <span class="p">(</span><span class="s2">&quot;DCa&quot;</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span>
</span><span id="Map_Scenario-122"><a href="#Map_Scenario-122"><span class="linenos">122</span></a>                           <span class="p">(</span><span class="s2">&quot;PhiNR&quot;</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span>
</span><span id="Map_Scenario-123"><a href="#Map_Scenario-123"><span class="linenos">123</span></a>                           <span class="p">(</span><span class="s2">&quot;N&quot;</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="kc">None</span><span class="p">)])</span>
</span><span id="Map_Scenario-124"><a href="#Map_Scenario-124"><span class="linenos">124</span></a>
</span><span id="Map_Scenario-125"><a href="#Map_Scenario-125"><span class="linenos">125</span></a>    <span class="k">def</span> <span class="nf">post_init</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Map_Scenario-126"><a href="#Map_Scenario-126"><span class="linenos">126</span></a>        <span class="c1"># The Python parameters that need additional conversion</span>
</span><span id="Map_Scenario-127"><a href="#Map_Scenario-127"><span class="linenos">127</span></a>        <span class="c1"># are initialised here.   </span>
</span><span id="Map_Scenario-128"><a href="#Map_Scenario-128"><span class="linenos">128</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">cCa0</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ca0</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">KC</span><span class="p">)</span>
</span><span id="Map_Scenario-129"><a href="#Map_Scenario-129"><span class="linenos">129</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">cCaIni</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ca00</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">KC</span><span class="p">)</span>
</span><span id="Map_Scenario-130"><a href="#Map_Scenario-130"><span class="linenos">130</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">cCO30</span> <span class="o">=</span>  <span class="bp">self</span><span class="o">.</span><span class="n">co30</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">KC</span><span class="p">)</span>
</span><span id="Map_Scenario-131"><a href="#Map_Scenario-131"><span class="linenos">131</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">cCO3Ini</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">co300</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">KC</span><span class="p">)</span>
</span><span id="Map_Scenario-132"><a href="#Map_Scenario-132"><span class="linenos">132</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">DeepLimit</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ShallowLimit</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">Th</span>
</span><span id="Map_Scenario-133"><a href="#Map_Scenario-133"><span class="linenos">133</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">rhos0</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rhoa</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">CA0</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">rhoc</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">CC0</span> <span class="o">+</span> \
</span><span id="Map_Scenario-134"><a href="#Map_Scenario-134"><span class="linenos">134</span></a>                     <span class="bp">self</span><span class="o">.</span> <span class="n">rhot</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">CA0</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">CC0</span><span class="p">))</span>
</span><span id="Map_Scenario-135"><a href="#Map_Scenario-135"><span class="linenos">135</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">rhos</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rhos0</span>
</span><span id="Map_Scenario-136"><a href="#Map_Scenario-136"><span class="linenos">136</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">Xstar</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">D0Ca</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">sedimentationrate</span>
</span><span id="Map_Scenario-137"><a href="#Map_Scenario-137"><span class="linenos">137</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">Tstar</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Xstar</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">sedimentationrate</span>
</span><span id="Map_Scenario-138"><a href="#Map_Scenario-138"><span class="linenos">138</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">b</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">b</span><span class="o">/</span><span class="mf">1e4</span><span class="p">)</span> 
</span><span id="Map_Scenario-139"><a href="#Map_Scenario-139"><span class="linenos">139</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">m2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">m1</span>
</span><span id="Map_Scenario-140"><a href="#Map_Scenario-140"><span class="linenos">140</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">n2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">n1</span>
</span><span id="Map_Scenario-141"><a href="#Map_Scenario-141"><span class="linenos">141</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">DCa</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">D0Ca</span>
</span><span id="Map_Scenario-142"><a href="#Map_Scenario-142"><span class="linenos">142</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">PhiNR</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">PhiIni</span>
</span><span id="Map_Scenario-143"><a href="#Map_Scenario-143"><span class="linenos">143</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">N</span> <span class="o">=</span> <span class="mi">200</span>
</span><span id="Map_Scenario-144"><a href="#Map_Scenario-144"><span class="linenos">144</span></a>
</span><span id="Map_Scenario-145"><a href="#Map_Scenario-145"><span class="linenos">145</span></a>               
</span><span id="Map_Scenario-146"><a href="#Map_Scenario-146"><span class="linenos">146</span></a>    <span class="n">derived_dataclass</span> <span class="o">=</span> <span class="n">make_dataclass</span><span class="p">(</span><span class="s2">&quot;Mapped parameters&quot;</span><span class="p">,</span> <span class="n">derived_fields</span><span class="p">,</span>
</span><span id="Map_Scenario-147"><a href="#Map_Scenario-147"><span class="linenos">147</span></a>                                       <span class="n">namespace</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;__post_init__&quot;</span><span class="p">:</span> <span class="n">post_init</span><span class="p">})</span>
</span><span id="Map_Scenario-148"><a href="#Map_Scenario-148"><span class="linenos">148</span></a>
</span><span id="Map_Scenario-149"><a href="#Map_Scenario-149"><span class="linenos">149</span></a>    <span class="k">return</span> <span class="n">derived_dataclass</span><span class="p">()</span>
</span></pre></div>


            <div class="docstring"><p>Maps the Fortran 'Scenario' parameters to the equivalent parameters in the
Matlab and Python codes. These codes use slightly different parameter 
names. Besides the mapping, also a few numerical conversions are applied.
To do these conversions, a number of FORTRAN parameters need to be passed on 
"as is", i.e. unchanged.
Units from Scenario are dropped, so only magnitudes (i.e. values) are 
retained.</p>
</div>


                </section>
                <section id="jacobian_sparsity">
                            <input id="jacobian_sparsity-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">jacobian_sparsity</span><span class="signature pdoc-code condensed">(<span class="return-annotation">):</span></span>

                <label class="view-source-button" for="jacobian_sparsity-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#jacobian_sparsity"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="jacobian_sparsity-151"><a href="#jacobian_sparsity-151"><span class="linenos">151</span></a><span class="k">def</span> <span class="nf">jacobian_sparsity</span><span class="p">():</span>
</span><span id="jacobian_sparsity-152"><a href="#jacobian_sparsity-152"><span class="linenos">152</span></a><span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
</span><span id="jacobian_sparsity-153"><a href="#jacobian_sparsity-153"><span class="linenos">153</span></a><span class="sd">    It turns out the the Jacobian sparsity matrix, as provided by</span>
</span><span id="jacobian_sparsity-154"><a href="#jacobian_sparsity-154"><span class="linenos">154</span></a><span class="sd">    previous versions of this function was too strict. The diagonals</span>
</span><span id="jacobian_sparsity-155"><a href="#jacobian_sparsity-155"><span class="linenos">155</span></a><span class="sd">    had a width of 1, this implicitly assumes no dependencies of the</span>
</span><span id="jacobian_sparsity-156"><a href="#jacobian_sparsity-156"><span class="linenos">156</span></a><span class="sd">    Jacobian elements on fields at adjacent depths. A run with such</span>
</span><span id="jacobian_sparsity-157"><a href="#jacobian_sparsity-157"><span class="linenos">157</span></a><span class="sd">    a Jacobian sparsity matrix took a lot of compute power and time and</span>
</span><span id="jacobian_sparsity-158"><a href="#jacobian_sparsity-158"><span class="linenos">158</span></a><span class="sd">    ultimately halted without covering a single time step! A debugging </span>
</span><span id="jacobian_sparsity-159"><a href="#jacobian_sparsity-159"><span class="linenos">159</span></a><span class="sd">    session with breakpoints inside solve_ivp showed that the Jacobian </span>
</span><span id="jacobian_sparsity-160"><a href="#jacobian_sparsity-160"><span class="linenos">160</span></a><span class="sd">    matrix computed by `solve_ivp` (when neither the Jacobian nor the </span>
</span><span id="jacobian_sparsity-161"><a href="#jacobian_sparsity-161"><span class="linenos">161</span></a><span class="sd">    Jacobian sparsity matrix was provided) has non-zero elements not </span>
</span><span id="jacobian_sparsity-162"><a href="#jacobian_sparsity-162"><span class="linenos">162</span></a><span class="sd">    only on the diagonals but also on adjacent positions along the </span>
</span><span id="jacobian_sparsity-163"><a href="#jacobian_sparsity-163"><span class="linenos">163</span></a><span class="sd">    diagonals. This was confirmed by ChatGPT:</span>
</span><span id="jacobian_sparsity-164"><a href="#jacobian_sparsity-164"><span class="linenos">164</span></a><span class="sd">    &quot;It is indeed common for the Jacobian matrix of coupled partial </span>
</span><span id="jacobian_sparsity-165"><a href="#jacobian_sparsity-165"><span class="linenos">165</span></a><span class="sd">    differential equations (PDEs), such as advection-diffusion equations, </span>
</span><span id="jacobian_sparsity-166"><a href="#jacobian_sparsity-166"><span class="linenos">166</span></a><span class="sd">    to have non-zero elements beyond the main diagonal. This phenomenon, </span>
</span><span id="jacobian_sparsity-167"><a href="#jacobian_sparsity-167"><span class="linenos">167</span></a><span class="sd">    where adjacent elements in the Jacobian are non-zero, is often due </span>
</span><span id="jacobian_sparsity-168"><a href="#jacobian_sparsity-168"><span class="linenos">168</span></a><span class="sd">    to the spatial discretization of the differential equations.&quot;</span>
</span><span id="jacobian_sparsity-169"><a href="#jacobian_sparsity-169"><span class="linenos">169</span></a><span class="sd">    Likewise computing a functional Jacobian is only feasible for the</span>
</span><span id="jacobian_sparsity-170"><a href="#jacobian_sparsity-170"><span class="linenos">170</span></a><span class="sd">    diagonals, for positions near the diagonals it is very hard.</span>
</span><span id="jacobian_sparsity-171"><a href="#jacobian_sparsity-171"><span class="linenos">171</span></a>
</span><span id="jacobian_sparsity-172"><a href="#jacobian_sparsity-172"><span class="linenos">172</span></a><span class="sd">    Here we will choose diagonals of width 3.</span>
</span><span id="jacobian_sparsity-173"><a href="#jacobian_sparsity-173"><span class="linenos">173</span></a><span class="sd">    &#39;&#39;&#39;</span>
</span><span id="jacobian_sparsity-174"><a href="#jacobian_sparsity-174"><span class="linenos">174</span></a>
</span><span id="jacobian_sparsity-175"><a href="#jacobian_sparsity-175"><span class="linenos">175</span></a>    <span class="n">no_depths</span> <span class="o">=</span> <span class="n">Map_Scenario</span><span class="p">()</span><span class="o">.</span><span class="n">N</span>
</span><span id="jacobian_sparsity-176"><a href="#jacobian_sparsity-176"><span class="linenos">176</span></a>    <span class="c1"># Number of fields = 5, i.e. calcite, aragonite, concentrations of</span>
</span><span id="jacobian_sparsity-177"><a href="#jacobian_sparsity-177"><span class="linenos">177</span></a>    <span class="c1"># calcium and carbonate ions and the porosity.</span>
</span><span id="jacobian_sparsity-178"><a href="#jacobian_sparsity-178"><span class="linenos">178</span></a>    <span class="n">no_fields</span> <span class="o">=</span> <span class="mi">5</span>
</span><span id="jacobian_sparsity-179"><a href="#jacobian_sparsity-179"><span class="linenos">179</span></a>    <span class="n">n</span> <span class="o">=</span> <span class="n">no_fields</span> <span class="o">*</span> <span class="n">no_depths</span>
</span><span id="jacobian_sparsity-180"><a href="#jacobian_sparsity-180"><span class="linenos">180</span></a>    
</span><span id="jacobian_sparsity-181"><a href="#jacobian_sparsity-181"><span class="linenos">181</span></a>    <span class="n">diagonals</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="mi">3</span> <span class="o">*</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">no_fields</span> <span class="o">-</span> <span class="mi">1</span><span class="p">),</span> <span class="n">n</span><span class="p">))</span>
</span><span id="jacobian_sparsity-182"><a href="#jacobian_sparsity-182"><span class="linenos">182</span></a>
</span><span id="jacobian_sparsity-183"><a href="#jacobian_sparsity-183"><span class="linenos">183</span></a>    <span class="c1"># Construct the offsets.</span>
</span><span id="jacobian_sparsity-184"><a href="#jacobian_sparsity-184"><span class="linenos">184</span></a>    <span class="n">offsets</span> <span class="o">=</span> <span class="p">()</span>
</span><span id="jacobian_sparsity-185"><a href="#jacobian_sparsity-185"><span class="linenos">185</span></a>    <span class="k">for</span> <span class="n">offset</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="o">-</span><span class="n">n</span> <span class="o">+</span> <span class="n">no_depths</span><span class="p">,</span> <span class="n">n</span> <span class="o">-</span> <span class="n">no_depths</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">no_depths</span><span class="p">):</span> 
</span><span id="jacobian_sparsity-186"><a href="#jacobian_sparsity-186"><span class="linenos">186</span></a>        <span class="n">offsets</span> <span class="o">=</span> <span class="n">offsets</span> <span class="o">+</span> <span class="p">((</span><span class="n">offset</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">offset</span><span class="p">,</span> <span class="n">offset</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),)</span>
</span><span id="jacobian_sparsity-187"><a href="#jacobian_sparsity-187"><span class="linenos">187</span></a>    <span class="c1"># Turn offsets into a single tuple instead of a tuple of tuples.</span>
</span><span id="jacobian_sparsity-188"><a href="#jacobian_sparsity-188"><span class="linenos">188</span></a>    <span class="n">offsets</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">offsets</span><span class="p">,</span> <span class="p">())</span>
</span><span id="jacobian_sparsity-189"><a href="#jacobian_sparsity-189"><span class="linenos">189</span></a>    <span class="c1"># Check that we have as many offsets as diagonals:</span>
</span><span id="jacobian_sparsity-190"><a href="#jacobian_sparsity-190"><span class="linenos">190</span></a>    <span class="k">try</span><span class="p">:</span>
</span><span id="jacobian_sparsity-191"><a href="#jacobian_sparsity-191"><span class="linenos">191</span></a>        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">offsets</span><span class="p">)</span> <span class="o">==</span> <span class="n">diagonals</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="jacobian_sparsity-192"><a href="#jacobian_sparsity-192"><span class="linenos">192</span></a>    <span class="k">except</span> <span class="ne">AssertionError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="jacobian_sparsity-193"><a href="#jacobian_sparsity-193"><span class="linenos">193</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Setup of diagonals incorrect.&#39;</span><span class="p">)</span>
</span><span id="jacobian_sparsity-194"><a href="#jacobian_sparsity-194"><span class="linenos">194</span></a>    <span class="c1"># Construct the sparse matrix. </span>
</span><span id="jacobian_sparsity-195"><a href="#jacobian_sparsity-195"><span class="linenos">195</span></a>    <span class="n">raw_matrix</span> <span class="o">=</span> <span class="n">lil_matrix</span><span class="p">(</span><span class="n">dia_matrix</span><span class="p">((</span><span class="n">diagonals</span><span class="p">,</span> <span class="n">offsets</span><span class="p">),</span> <span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">n</span><span class="p">)))</span> 
</span><span id="jacobian_sparsity-196"><a href="#jacobian_sparsity-196"><span class="linenos">196</span></a>    <span class="c1"># Set the Jacobian elements to zero that correspond with the derivatives</span>
</span><span id="jacobian_sparsity-197"><a href="#jacobian_sparsity-197"><span class="linenos">197</span></a>    <span class="c1"># of the rhs of equations 40 and 41 wrt phi.</span>
</span><span id="jacobian_sparsity-198"><a href="#jacobian_sparsity-198"><span class="linenos">198</span></a>    <span class="n">raw_matrix</span><span class="p">[:</span><span class="mi">2</span> <span class="o">*</span> <span class="n">no_depths</span><span class="p">,</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">no_depths</span><span class="p">:]</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="jacobian_sparsity-199"><a href="#jacobian_sparsity-199"><span class="linenos">199</span></a>
</span><span id="jacobian_sparsity-200"><a href="#jacobian_sparsity-200"><span class="linenos">200</span></a>    <span class="k">return</span> <span class="n">csr_matrix</span><span class="p">(</span><span class="n">raw_matrix</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>It turns out the the Jacobian sparsity matrix, as provided by
previous versions of this function was too strict. The diagonals
had a width of 1, this implicitly assumes no dependencies of the
Jacobian elements on fields at adjacent depths. A run with such
a Jacobian sparsity matrix took a lot of compute power and time and
ultimately halted without covering a single time step! A debugging 
session with breakpoints inside solve_ivp showed that the Jacobian 
matrix computed by <code>solve_ivp</code> (when neither the Jacobian nor the 
Jacobian sparsity matrix was provided) has non-zero elements not 
only on the diagonals but also on adjacent positions along the 
diagonals. This was confirmed by ChatGPT:
"It is indeed common for the Jacobian matrix of coupled partial 
differential equations (PDEs), such as advection-diffusion equations, 
to have non-zero elements beyond the main diagonal. This phenomenon, 
where adjacent elements in the Jacobian are non-zero, is often due 
to the spatial discretization of the differential equations."
Likewise computing a functional Jacobian is only feasible for the
diagonals, for positions near the diagonals it is very hard.</p>

<p>Here we will choose diagonals of width 3.</p>
</div>


                </section>
                <section id="Solver">
                            <input id="Solver-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
                    <div class="decorator">@no_init_docs</div>
        <div class="decorator">@dataclass</div>

    <span class="def">class</span>
    <span class="name">Solver</span>:

                <label class="view-source-button" for="Solver-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Solver"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Solver-203"><a href="#Solver-203"><span class="linenos">203</span></a><span class="nd">@no_init_docs</span>
</span><span id="Solver-204"><a href="#Solver-204"><span class="linenos">204</span></a><span class="nd">@dataclass</span>
</span><span id="Solver-205"><a href="#Solver-205"><span class="linenos">205</span></a><span class="k">class</span> <span class="nc">Solver</span><span class="p">():</span>
</span><span id="Solver-206"><a href="#Solver-206"><span class="linenos">206</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Initialises all the parameters for the solver, i.e. parameters like time</span>
</span><span id="Solver-207"><a href="#Solver-207"><span class="linenos">207</span></a><span class="sd">    interval, time step and tolerance.</span>
</span><span id="Solver-208"><a href="#Solver-208"><span class="linenos">208</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="Solver-209"><a href="#Solver-209"><span class="linenos">209</span></a>    <span class="n">dt</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1.e-6</span>
</span><span id="Solver-210"><a href="#Solver-210"><span class="linenos">210</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot; Initial time step for the integration, in units of T* (dimensionless).</span>
</span><span id="Solver-211"><a href="#Solver-211"><span class="linenos">211</span></a><span class="sd">    If the time step is not adaptive, i.e. if &#39;adaptive = False&#39;, this time </span>
</span><span id="Solver-212"><a href="#Solver-212"><span class="linenos">212</span></a><span class="sd">    step will be applied throughout the integration. If None, a default value</span>
</span><span id="Solver-213"><a href="#Solver-213"><span class="linenos">213</span></a><span class="sd">    based on the stepper will be chosen.&quot;&quot;&quot;</span>
</span><span id="Solver-214"><a href="#Solver-214"><span class="linenos">214</span></a>    <span class="n">t_range</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="Solver-215"><a href="#Solver-215"><span class="linenos">215</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot; The time interval that the integration should cover in units of T*</span>
</span><span id="Solver-216"><a href="#Solver-216"><span class="linenos">216</span></a><span class="sd">    (dimensionless).&quot;&quot;&quot;</span>
</span><span id="Solver-217"><a href="#Solver-217"><span class="linenos">217</span></a>    <span class="n">solver</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;scipy&quot;</span>
</span><span id="Solver-218"><a href="#Solver-218"><span class="linenos">218</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;The type of solver to use.&quot;&quot;&quot;</span>
</span><span id="Solver-219"><a href="#Solver-219"><span class="linenos">219</span></a>    <span class="n">scheme</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;euler&quot;</span>
</span><span id="Solver-220"><a href="#Solver-220"><span class="linenos">220</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;The type of integration scheme to use. Beware that &#39;scheme&#39;</span>
</span><span id="Solver-221"><a href="#Solver-221"><span class="linenos">221</span></a><span class="sd">    will only be propagated if you have chosen py-pde&#39;s native</span>
</span><span id="Solver-222"><a href="#Solver-222"><span class="linenos">222</span></a><span class="sd">    &#39;explicit&#39; solver as &#39;solver&#39;.&quot;&quot;&quot;</span>
</span><span id="Solver-223"><a href="#Solver-223"><span class="linenos">223</span></a>    <span class="n">adaptive</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="Solver-224"><a href="#Solver-224"><span class="linenos">224</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Whether or not to use an adaptive time step. Beware that &#39;adaptive&#39; </span>
</span><span id="Solver-225"><a href="#Solver-225"><span class="linenos">225</span></a><span class="sd">    will only be propagated if you have chosen py-pde&#39;s native</span>
</span><span id="Solver-226"><a href="#Solver-226"><span class="linenos">226</span></a><span class="sd">    &#39;explicit&#39; solver as &#39;solver&#39;.&quot;&quot;&quot;</span>
</span><span id="Solver-227"><a href="#Solver-227"><span class="linenos">227</span></a>    <span class="n">method</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;LSODA&quot;</span>
</span><span id="Solver-228"><a href="#Solver-228"><span class="linenos">228</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;solve_ivp from scipy.integrate offers six methods. </span>
</span><span id="Solver-229"><a href="#Solver-229"><span class="linenos">229</span></a><span class="sd">    They can be set here.&quot;&quot;&quot;</span>
</span><span id="Solver-230"><a href="#Solver-230"><span class="linenos">230</span></a>    <span class="n">lband</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="Solver-231"><a href="#Solver-231"><span class="linenos">231</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot; Setting lband and uband for method=&quot;LSODA&quot; leads to tremendous</span>
</span><span id="Solver-232"><a href="#Solver-232"><span class="linenos">232</span></a><span class="sd">    performance increase. See Scipy&#39;s &#39;solve_ivp&#39; documentation for background.</span>
</span><span id="Solver-233"><a href="#Solver-233"><span class="linenos">233</span></a><span class="sd">    Consider it equivalent to providing a sparsity matrix for the &quot;Radau&quot; </span>
</span><span id="Solver-234"><a href="#Solver-234"><span class="linenos">234</span></a><span class="sd">    and &quot;BDF&quot; implicit methods.&quot;&quot;&quot;</span>
</span><span id="Solver-235"><a href="#Solver-235"><span class="linenos">235</span></a>    <span class="n">uband</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="Solver-236"><a href="#Solver-236"><span class="linenos">236</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot; Setting lband and uband for method=&quot;LSODA&quot; leads to tremendous</span>
</span><span id="Solver-237"><a href="#Solver-237"><span class="linenos">237</span></a><span class="sd">    performance increase. See Scipy&#39;s &#39;solve_ivp&#39; documentation for background.</span>
</span><span id="Solver-238"><a href="#Solver-238"><span class="linenos">238</span></a><span class="sd">    Consider it equivalent to providing a sparsity matrix for the &quot;Radau&quot; </span>
</span><span id="Solver-239"><a href="#Solver-239"><span class="linenos">239</span></a><span class="sd">    and &quot;BDF&quot; implicit methods.&quot;&quot;&quot;</span>
</span><span id="Solver-240"><a href="#Solver-240"><span class="linenos">240</span></a>    <span class="n">backend</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;numba&quot;</span>
</span><span id="Solver-241"><a href="#Solver-241"><span class="linenos">241</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Options are &#39;numpy and &#39;numba&#39;. Choosing &#39;numba&#39; means that the </span>
</span><span id="Solver-242"><a href="#Solver-242"><span class="linenos">242</span></a><span class="sd">    computations of the right-hand sides of the partial differential equations</span>
</span><span id="Solver-243"><a href="#Solver-243"><span class="linenos">243</span></a><span class="sd">    for the five fields that we are integrating are compiled. This option is </span>
</span><span id="Solver-244"><a href="#Solver-244"><span class="linenos">244</span></a><span class="sd">    almost always faster than &#39;numpy&#39;, which uses the Python interpreter to </span>
</span><span id="Solver-245"><a href="#Solver-245"><span class="linenos">245</span></a><span class="sd">    launch (compiled) Numpy routines. However, the &#39;numba&#39; option comes with</span>
</span><span id="Solver-246"><a href="#Solver-246"><span class="linenos">246</span></a><span class="sd">    limitations with respect to the Python and Numpy routines that can be </span>
</span><span id="Solver-247"><a href="#Solver-247"><span class="linenos">247</span></a><span class="sd">    deployed. See the Numba documentation for a list of supported Numpy </span>
</span><span id="Solver-248"><a href="#Solver-248"><span class="linenos">248</span></a><span class="sd">    features.</span>
</span><span id="Solver-249"><a href="#Solver-249"><span class="linenos">249</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="Solver-250"><a href="#Solver-250"><span class="linenos">250</span></a>    <span class="n">ret_info</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="Solver-251"><a href="#Solver-251"><span class="linenos">251</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Flag determining whether diagnostic information about the solver </span>
</span><span id="Solver-252"><a href="#Solver-252"><span class="linenos">252</span></a><span class="sd">    process should be returned. &quot;&quot;&quot;</span>
</span><span id="Solver-253"><a href="#Solver-253"><span class="linenos">253</span></a>
</span><span id="Solver-254"><a href="#Solver-254"><span class="linenos">254</span></a>    <span class="k">def</span> <span class="nf">__post_init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Solver-255"><a href="#Solver-255"><span class="linenos">255</span></a><span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
</span><span id="Solver-256"><a href="#Solver-256"><span class="linenos">256</span></a><span class="sd">        Filter out solver settings that are mutually incompatible.</span>
</span><span id="Solver-257"><a href="#Solver-257"><span class="linenos">257</span></a><span class="sd">        &#39;&#39;&#39;</span>
</span><span id="Solver-258"><a href="#Solver-258"><span class="linenos">258</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="Solver-259"><a href="#Solver-259"><span class="linenos">259</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">solver</span> <span class="o">!=</span> <span class="s2">&quot;scipy&quot;</span><span class="p">:</span>
</span><span id="Solver-260"><a href="#Solver-260"><span class="linenos">260</span></a>                <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">__dataclass_fields__</span><span class="p">[</span><span class="s2">&quot;method&quot;</span><span class="p">]</span>
</span><span id="Solver-261"><a href="#Solver-261"><span class="linenos">261</span></a>                <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">__dataclass_fields__</span><span class="p">[</span><span class="s2">&quot;lband&quot;</span><span class="p">]</span>
</span><span id="Solver-262"><a href="#Solver-262"><span class="linenos">262</span></a>                <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">__dataclass_fields__</span><span class="p">[</span><span class="s2">&quot;uband&quot;</span><span class="p">]</span>
</span><span id="Solver-263"><a href="#Solver-263"><span class="linenos">263</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="Solver-264"><a href="#Solver-264"><span class="linenos">264</span></a>                <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">__dataclass_fields__</span><span class="p">[</span><span class="s2">&quot;scheme&quot;</span><span class="p">]</span>
</span><span id="Solver-265"><a href="#Solver-265"><span class="linenos">265</span></a>                <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">__dataclass_fields__</span><span class="p">[</span><span class="s2">&quot;adaptive&quot;</span><span class="p">]</span>
</span><span id="Solver-266"><a href="#Solver-266"><span class="linenos">266</span></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">method</span> <span class="o">!=</span> <span class="s2">&quot;LSODA&quot;</span><span class="p">:</span>
</span><span id="Solver-267"><a href="#Solver-267"><span class="linenos">267</span></a>                    <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">__dataclass_fields__</span><span class="p">[</span><span class="s2">&quot;lband&quot;</span><span class="p">]</span>
</span><span id="Solver-268"><a href="#Solver-268"><span class="linenos">268</span></a>                    <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">__dataclass_fields__</span><span class="p">[</span><span class="s2">&quot;uband&quot;</span><span class="p">]</span>
</span><span id="Solver-269"><a href="#Solver-269"><span class="linenos">269</span></a>        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
</span><span id="Solver-270"><a href="#Solver-270"><span class="linenos">270</span></a>            <span class="k">pass</span>
</span></pre></div>


            <div class="docstring"><p>Initialises all the parameters for the solver, i.e. parameters like time
interval, time step and tolerance.</p>
</div>


                            <div id="Solver.dt" class="classattr">
                                <div class="attr variable">
            <span class="name">dt</span><span class="annotation">: float</span>        =
<span class="default_value">1e-06</span>

        
    </div>
    <a class="headerlink" href="#Solver.dt"></a>
    
            <div class="docstring"><p>Initial time step for the integration, in units of T* (dimensionless).
If the time step is not adaptive, i.e. if 'adaptive = False', this time 
step will be applied throughout the integration. If None, a default value
based on the stepper will be chosen.</p>
</div>


                            </div>
                            <div id="Solver.t_range" class="classattr">
                                <div class="attr variable">
            <span class="name">t_range</span><span class="annotation">: float</span>        =
<span class="default_value">1</span>

        
    </div>
    <a class="headerlink" href="#Solver.t_range"></a>
    
            <div class="docstring"><p>The time interval that the integration should cover in units of T*
(dimensionless).</p>
</div>


                            </div>
                            <div id="Solver.solver" class="classattr">
                                <div class="attr variable">
            <span class="name">solver</span><span class="annotation">: str</span>        =
<span class="default_value">&#39;scipy&#39;</span>

        
    </div>
    <a class="headerlink" href="#Solver.solver"></a>
    
            <div class="docstring"><p>The type of solver to use.</p>
</div>


                            </div>
                            <div id="Solver.scheme" class="classattr">
                                <div class="attr variable">
            <span class="name">scheme</span><span class="annotation">: str</span>        =
<span class="default_value">&#39;euler&#39;</span>

        
    </div>
    <a class="headerlink" href="#Solver.scheme"></a>
    
            <div class="docstring"><p>The type of integration scheme to use. Beware that 'scheme'
will only be propagated if you have chosen py-pde's native
'explicit' solver as 'solver'.</p>
</div>


                            </div>
                            <div id="Solver.adaptive" class="classattr">
                                <div class="attr variable">
            <span class="name">adaptive</span><span class="annotation">: bool</span>        =
<span class="default_value">True</span>

        
    </div>
    <a class="headerlink" href="#Solver.adaptive"></a>
    
            <div class="docstring"><p>Whether or not to use an adaptive time step. Beware that 'adaptive' 
will only be propagated if you have chosen py-pde's native
'explicit' solver as 'solver'.</p>
</div>


                            </div>
                            <div id="Solver.method" class="classattr">
                                <div class="attr variable">
            <span class="name">method</span><span class="annotation">: str</span>        =
<span class="default_value">&#39;LSODA&#39;</span>

        
    </div>
    <a class="headerlink" href="#Solver.method"></a>
    
            <div class="docstring"><p>solve_ivp from scipy.integrate offers six methods. 
They can be set here.</p>
</div>


                            </div>
                            <div id="Solver.lband" class="classattr">
                                <div class="attr variable">
            <span class="name">lband</span><span class="annotation">: int</span>        =
<span class="default_value">1</span>

        
    </div>
    <a class="headerlink" href="#Solver.lband"></a>
    
            <div class="docstring"><p>Setting lband and uband for method="LSODA" leads to tremendous
performance increase. See Scipy's 'solve_ivp' documentation for background.
Consider it equivalent to providing a sparsity matrix for the "Radau" 
and "BDF" implicit methods.</p>
</div>


                            </div>
                            <div id="Solver.uband" class="classattr">
                                <div class="attr variable">
            <span class="name">uband</span><span class="annotation">: int</span>        =
<span class="default_value">1</span>

        
    </div>
    <a class="headerlink" href="#Solver.uband"></a>
    
            <div class="docstring"><p>Setting lband and uband for method="LSODA" leads to tremendous
performance increase. See Scipy's 'solve_ivp' documentation for background.
Consider it equivalent to providing a sparsity matrix for the "Radau" 
and "BDF" implicit methods.</p>
</div>


                            </div>
                            <div id="Solver.backend" class="classattr">
                                <div class="attr variable">
            <span class="name">backend</span><span class="annotation">: str</span>        =
<span class="default_value">&#39;numba&#39;</span>

        
    </div>
    <a class="headerlink" href="#Solver.backend"></a>
    
            <div class="docstring"><p>Options are 'numpy and 'numba'. Choosing 'numba' means that the 
computations of the right-hand sides of the partial differential equations
for the five fields that we are integrating are compiled. This option is 
almost always faster than 'numpy', which uses the Python interpreter to 
launch (compiled) Numpy routines. However, the 'numba' option comes with
limitations with respect to the Python and Numpy routines that can be 
deployed. See the Numba documentation for a list of supported Numpy 
features.</p>
</div>


                            </div>
                            <div id="Solver.ret_info" class="classattr">
                                <div class="attr variable">
            <span class="name">ret_info</span><span class="annotation">: bool</span>        =
<span class="default_value">True</span>

        
    </div>
    <a class="headerlink" href="#Solver.ret_info"></a>
    
            <div class="docstring"><p>Flag determining whether diagnostic information about the solver 
process should be returned.</p>
</div>


                            </div>
                </section>
                <section id="Tracker">
                            <input id="Tracker-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
                    <div class="decorator">@dataclass</div>

    <span class="def">class</span>
    <span class="name">Tracker</span>:

                <label class="view-source-button" for="Tracker-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Tracker"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Tracker-273"><a href="#Tracker-273"><span class="linenos">273</span></a><span class="nd">@dataclass</span>
</span><span id="Tracker-274"><a href="#Tracker-274"><span class="linenos">274</span></a><span class="k">class</span> <span class="nc">Tracker</span><span class="p">:</span>
</span><span id="Tracker-275"><a href="#Tracker-275"><span class="linenos">275</span></a><span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
</span><span id="Tracker-276"><a href="#Tracker-276"><span class="linenos">276</span></a><span class="sd">    Initialises all the tracking parameters, such as tracker interval.</span>
</span><span id="Tracker-277"><a href="#Tracker-277"><span class="linenos">277</span></a><span class="sd">    Also indicates the quantities to be tracked, as boolean values.</span>
</span><span id="Tracker-278"><a href="#Tracker-278"><span class="linenos">278</span></a><span class="sd">    &#39;&#39;&#39;</span>
</span><span id="Tracker-279"><a href="#Tracker-279"><span class="linenos">279</span></a>    <span class="n">progress_tracker_interval</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">Solver</span><span class="p">()</span><span class="o">.</span><span class="n">t_range</span> <span class="o">/</span> <span class="mi">1_000</span>
</span><span id="Tracker-280"><a href="#Tracker-280"><span class="linenos">280</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;This determines how often the progress bar, showing the </span>
</span><span id="Tracker-281"><a href="#Tracker-281"><span class="linenos">281</span></a><span class="sd">    integration progress, is updated. It is expressed in integration</span>
</span><span id="Tracker-282"><a href="#Tracker-282"><span class="linenos">282</span></a><span class="sd">    units, i.e. in units of T*.&quot;&quot;&quot;</span>
</span><span id="Tracker-283"><a href="#Tracker-283"><span class="linenos">283</span></a>    <span class="n">live_plotting</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="Tracker-284"><a href="#Tracker-284"><span class="linenos">284</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;It is possible to see how the distributions over depth, of the five</span>
</span><span id="Tracker-285"><a href="#Tracker-285"><span class="linenos">285</span></a><span class="sd">    fields that we are integrating, evolve as integration progresses.&quot;&quot;&quot;</span>
</span><span id="Tracker-286"><a href="#Tracker-286"><span class="linenos">286</span></a>    <span class="n">plotting_interval</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;0:05&#39;</span>
</span><span id="Tracker-287"><a href="#Tracker-287"><span class="linenos">287</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Attribute of the LivePlotTracker class that determines the interruption</span>
</span><span id="Tracker-288"><a href="#Tracker-288"><span class="linenos">288</span></a><span class="sd">    of the simulation. A single number determines an interval (measured in the </span>
</span><span id="Tracker-289"><a href="#Tracker-289"><span class="linenos">289</span></a><span class="sd">    simulation time unit) of regular interruption. A string is interpreted as a</span>
</span><span id="Tracker-290"><a href="#Tracker-290"><span class="linenos">290</span></a><span class="sd">    duration in real time assuming the format ‘hh:mm:ss’. A list of numbers is </span>
</span><span id="Tracker-291"><a href="#Tracker-291"><span class="linenos">291</span></a><span class="sd">    taken as explicit simulation time points.&quot;&quot;&quot;</span>
</span><span id="Tracker-292"><a href="#Tracker-292"><span class="linenos">292</span></a>    <span class="n">data_tracker_interval</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.01</span>
</span><span id="Tracker-293"><a href="#Tracker-293"><span class="linenos">293</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Attribute of the DataTracker class that determines the interruption</span>
</span><span id="Tracker-294"><a href="#Tracker-294"><span class="linenos">294</span></a><span class="sd">    of the simulation. A single number determines an interval (measured in the </span>
</span><span id="Tracker-295"><a href="#Tracker-295"><span class="linenos">295</span></a><span class="sd">    simulation time unit) of regular interruption. A string is interpreted as a</span>
</span><span id="Tracker-296"><a href="#Tracker-296"><span class="linenos">296</span></a><span class="sd">    duration in real time assuming the format ‘hh:mm:ss’. A list of numbers is </span>
</span><span id="Tracker-297"><a href="#Tracker-297"><span class="linenos">297</span></a><span class="sd">    taken as explicit simulation time points.&quot;&quot;&quot;</span>
</span><span id="Tracker-298"><a href="#Tracker-298"><span class="linenos">298</span></a>    <span class="n">track_U_at_bottom</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="Tracker-299"><a href="#Tracker-299"><span class="linenos">299</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Whether to track solid matrix advection velocity U at the bottom of the</span>
</span><span id="Tracker-300"><a href="#Tracker-300"><span class="linenos">300</span></a><span class="sd">    grid and store it as a dataset &#39;U at bottom&#39; in a separate group &#39;U&#39; </span>
</span><span id="Tracker-301"><a href="#Tracker-301"><span class="linenos">301</span></a><span class="sd">    within the hdf5 file containing all stored results.&quot;&quot;&quot;</span>
</span></pre></div>


            <div class="docstring"><p>Initialises all the tracking parameters, such as tracker interval.
Also indicates the quantities to be tracked, as boolean values.</p>
</div>


                            <div id="Tracker.__init__" class="classattr">
                                <div class="attr function">
            
        <span class="name">Tracker</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">progress_tracker_interval</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.001</span>,</span><span class="param">	<span class="n">live_plotting</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>,</span><span class="param">	<span class="n">plotting_interval</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;0:05&#39;</span>,</span><span class="param">	<span class="n">data_tracker_interval</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.01</span>,</span><span class="param">	<span class="n">track_U_at_bottom</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span></span>)</span>

        
    </div>
    <a class="headerlink" href="#Tracker.__init__"></a>
    
    

                            </div>
                            <div id="Tracker.progress_tracker_interval" class="classattr">
                                <div class="attr variable">
            <span class="name">progress_tracker_interval</span><span class="annotation">: float</span>        =
<span class="default_value">0.001</span>

        
    </div>
    <a class="headerlink" href="#Tracker.progress_tracker_interval"></a>
    
            <div class="docstring"><p>This determines how often the progress bar, showing the 
integration progress, is updated. It is expressed in integration
units, i.e. in units of T*.</p>
</div>


                            </div>
                            <div id="Tracker.live_plotting" class="classattr">
                                <div class="attr variable">
            <span class="name">live_plotting</span><span class="annotation">: bool</span>        =
<span class="default_value">True</span>

        
    </div>
    <a class="headerlink" href="#Tracker.live_plotting"></a>
    
            <div class="docstring"><p>It is possible to see how the distributions over depth, of the five
fields that we are integrating, evolve as integration progresses.</p>
</div>


                            </div>
                            <div id="Tracker.plotting_interval" class="classattr">
                                <div class="attr variable">
            <span class="name">plotting_interval</span><span class="annotation">: str</span>        =
<span class="default_value">&#39;0:05&#39;</span>

        
    </div>
    <a class="headerlink" href="#Tracker.plotting_interval"></a>
    
            <div class="docstring"><p>Attribute of the LivePlotTracker class that determines the interruption
of the simulation. A single number determines an interval (measured in the 
simulation time unit) of regular interruption. A string is interpreted as a
duration in real time assuming the format ‘hh:mm:ss’. A list of numbers is 
taken as explicit simulation time points.</p>
</div>


                            </div>
                            <div id="Tracker.data_tracker_interval" class="classattr">
                                <div class="attr variable">
            <span class="name">data_tracker_interval</span><span class="annotation">: float</span>        =
<span class="default_value">0.01</span>

        
    </div>
    <a class="headerlink" href="#Tracker.data_tracker_interval"></a>
    
            <div class="docstring"><p>Attribute of the DataTracker class that determines the interruption
of the simulation. A single number determines an interval (measured in the 
simulation time unit) of regular interruption. A string is interpreted as a
duration in real time assuming the format ‘hh:mm:ss’. A list of numbers is 
taken as explicit simulation time points.</p>
</div>


                            </div>
                            <div id="Tracker.track_U_at_bottom" class="classattr">
                                <div class="attr variable">
            <span class="name">track_U_at_bottom</span><span class="annotation">: bool</span>        =
<span class="default_value">False</span>

        
    </div>
    <a class="headerlink" href="#Tracker.track_U_at_bottom"></a>
    
            <div class="docstring"><p>Whether to track solid matrix advection velocity U at the bottom of the
grid and store it as a dataset 'U at bottom' in a separate group 'U' 
within the hdf5 file containing all stored results.</p>
</div>


                            </div>
                </section>
    </main>
</body>
</html>